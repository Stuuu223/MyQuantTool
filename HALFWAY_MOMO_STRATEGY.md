# 主板10cm半路推背策略 v1 - 开发计划

> 创建日期: 2026-02-08
> 策略类型: 主板10cm半路推背
> 核心特征: 高涨停率（59-85%）、高盈利率（97-100%）、高收益（+7-9%）

---

## 核心突破

### 真正的"半路推背"条件（一行定义）

```python
# 入场条件
主板10cm + 当日涨幅8-10% + 主力净流入/成交额 ≥2% + 热点行业
```

### 数据验证结果

**BAND_2（8-10%涨幅 + 2-5%占比）**：
- 样本数：132个（全部主板10cm）
- 有效样本：32个
- 涨停率：59.4%
- 盈利率：96.9%
- 平均收益：+7.32%

**BAND_3（8-10%涨幅 + ≥5%占比）**：
- 样本数：18个（全部主板10cm）
- 有效样本：13个
- 涨停率：84.6%
- 盈利率：100%
- 平均收益：+8.71%

### 板块过滤效果

**BAND_2 + 热点行业过滤**：
- 涨停率：59.4% → 62.5%
- 盈利率：96.9% → 100%
- 平均收益：+7.32% → +7.59%

**BAND_3 + 热点行业过滤**：
- 涨停率：84.6% → 80.0%
- 盈利率：100% → 100%
- 平均收益：+8.71% → +8.32%

---

## Momentum Band 体系

### 定义

基于涨幅和资金占比组合的分类体系，已在快照生成逻辑中实现。

### 段位划分

| Band | 条件 | 样本特征 | 次日表现 | 池位 |
|------|------|----------|----------|------|
| BAND_0 | 占比<2% 或 涨幅<5% | 噪声 | - | 黑名单 |
| BAND_1 | 5-8%涨幅 + 2-5%占比 | 保守小肉 | 100%盈利，+1.45% | 观察池 |
| BAND_2 | 8-10%涨幅 + 2-5%占比 | 半路推背主战区 | 59.4%涨停，+7.32% | 机会池 |
| BAND_3 | 8-10%涨幅 + ≥5%占比 | 推背加强版 | 84.6%涨停，+8.71% | 机会池 |

### 样本纯净性验证

- 所有BAND_2/BAND_3样本都是主板10cm，无20cm污染
- 创业板/科创板8-10%涨幅的样本资金占比都<2%，被自动过滤到BAND_0
- "≥2%占比"是20cm垃圾情绪票的天然防火墙

---

## 开发任务清单

### 主线：主板10cm半路推背v1

#### ✅ 已完成

1. **资金刻度升级**
   - 从"绝对金额"改为"占成交额比例"
   - 三档：<2%、2-5%、≥5%
   - 回测验证：收益-6.17% → -0.43%

2. **Momentum Band体系实现**
   - 已写入 `tasks/batch_rebuild_snapshots.py`
   - 21个交易日快照重新生成
   - 验证结果完全一致

3. **样本纯净性验证**
   - 拆分主板10cm和20cm样本
   - 确认无20cm污染
   - 创业板/科创板自动过滤

4. **板块过滤验证**
   - 计算行业热度（涨幅前30%）
   - 验证过滤效果
   - BAND_2盈利率提升到100%

#### 🔄 进行中

**1. 板块/行业过滤（当前任务）**

**目标**：将板块过滤逻辑推到核心系统

**实现方案**：
```python
# 在 FullMarketScanner 中添加行业热度计算
def calculate_sector_heat(snapshot):
    # 计算每个行业当日平均涨幅
    # 取涨幅前30%作为热点行业
    # 只保留热点行业的BAND_2/BAND_3
    pass
```

**验证数据**：
- BAND_2 + 热点行业：62.5%涨停率，100%盈利率，+7.59%平均收益
- BAND_3 + 热点行业：80.0%涨停率，100%盈利率，+8.32%平均收益

**文件修改**：
- `logic/full_market_scanner.py` - 添加行业热度计算逻辑
- `tasks/batch_rebuild_snapshots.py` - 确保快照包含行业热度标签

#### ⏳ 待完成

**2. 风险截断**

**单票风控**：
```python
# 止损规则
止损触发 = 成本价回撤 ≥5-6%

# 时间止损
时间止损触发 = 持有时间 ≥3-5日 且 累计收益 <5%
```

**仓位控制**：
```python
# 单票仓位
单票仓位上限 = 总资金 × 20-25%

# 总持仓
最大持仓数量 = 3只
```

**文件修改**：
- `logic/backtest_framework.py` - 添加止损和仓位控制逻辑
- `tasks/run_event_driven_monitor.py` - 实盘风控规则

**3. 推到核心系统**

**修改 `logic/full_market_scanner.py`**：
```python
# 在决策树中添加momentum_band判断
def _calculate_decision_tag(self, momentum_band, ...):
    if momentum_band in ["BAND_2", "BAND_3"]:
        if industry in hot_sectors:
            return "HALFWAY_MOMO"
    return ...
```

**修改 `tasks/run_event_driven_monitor.py`**：
```python
# 在事件监控中添加半路推背信号
def monitor_halfway_momo(self):
    # 监控BAND_2/BAND_3股票
    # 热点行业过滤
    # 触发交易信号
    pass
```

**4. 回测验证**

**目标**：验证完整策略的收益率和风险

**回测参数**：
- 时间范围：2026-01-09 ~ 2026-02-06（21个交易日）
- 策略：BAND_2/BAND_3 + 热点行业 + 风控
- 仓位：单票20%，最大3只

**关键指标**：
- 总收益率
- 最大回撤
- 胜率
- 平均持仓天数

---

### 支线：20cm游击模式（未来）

#### 典型案例
- 德恩精工：卖飞50%
- 志特新材：卖飞280%

#### 特征推测
- 涨停幅度：20%
- 重点区间：10-20%
- 关键指标：换手率、连板结构、分时缩量/放量
- 资金占比：可能<2%（与主板10cm不同）

#### 策略定位
- 小仓位：≤10%
- 短周期：≤3日
- 高回撤容忍度：≥-10%
- 作为主板主策略之外的"边路爆发"

#### 开发时机
- 等主板10cm主战策略跑顺后
- 收集更多20cm案例数据
- 单独设计20cm涨幅区间和逻辑

---

## 架构层对齐

### 每次动手前必问三件事

1. **这次改动影响哪里？**
   - [ ] 实时扫描（FullMarketScanner）
   - [ ] 实时监控/执行（EventDrivenMonitor）
   - [ ] 回测/快照分析

2. **新字段是否在研究层+实时层都对齐？**
   - [ ] momentum_band（已对齐）
   - [ ] industry_heat（待对齐）
   - [ ] 其他字段（待定义）

3. **策略标签是否清晰？**
   - [ ] 主板10cm主战
   - [ ] 20cm游击
   - [ ] 保守小肉
   - 不混在一锅

### 紧箍咒

**任何新规则最终要落在两处：**
- `logic/full_market_scanner.py`（核心心脏）
- `tasks/run_event_driven_monitor.py`（核心大脑）

**不要只在回测里打转！**

---

## 开发优先级

### P0（最高优先级）
1. 板块/行业过滤逻辑推到核心系统
2. 风险截断（止损+仓位控制）
3. 完整回测验证

### P1（高优先级）
1. FullMarketScanner集成momentum_band
2. EventDrivenMonitor集成半路推背信号
3. 实盘测试

### P2（中优先级）
1. 20cm游击模式研究
2. 保守小肉子策略
3. 多策略组合优化

---

## 验证清单

### 代码修改检查

- [ ] momentum_band逻辑已写入 `tasks/batch_rebuild_snapshots.py`
- [ ] momentum_band逻辑已写入 `logic/full_market_scanner.py`
- [ ] 行业热度逻辑已写入 `logic/full_market_scanner.py`
- [ ] 风控逻辑已写入 `tasks/run_event_driven_monitor.py`
- [ ] 回测逻辑已写入 `logic/backtest_framework.py`

### 数据一致性检查

- [ ] 研究层快照数据包含momentum_band
- [ ] 实时层快照数据包含momentum_band
- [ ] 研究层和实时层计算逻辑一致
- [ ] 行业热度定义一致

### 性能检查

- [ ] 实时扫描性能测试（<5秒）
- [ ] 事件监控性能测试（<1秒）
- [ ] 内存占用测试（<2GB）

---

## 参考文档

- [CORE_ARCHITECTURE.md](CORE_ARCHITECTURE.md) - 核心架构
- [TASK_PLAN.md](TASK_PLAN.md) - 任务计划
- [TASK_PROGRESS.md](TASK_PROGRESS.md) - 任务进度

---

## 联系方式

如有问题，请参考以下资源：
- 项目目录：`E:\MyQuantTool`
- 核心系统：`logic/full_market_scanner.py`
- 事件监控：`tasks/run_event_driven_monitor.py`
- 快照生成：`tasks/batch_rebuild_snapshots.py`

---

**最后更新：2026-02-08**
**状态：开发中（主线：主板10cm半路推背v1）**