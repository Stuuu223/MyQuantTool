# ä¸‰æ¼æ–—æ‰«æç³»ç»Ÿ - ä½¿ç”¨æŒ‡å—

**ç‰ˆæœ¬**: V1.0
**æ—¥æœŸ**: 2026-02-05
**ä½œè€…**: iFlow CLI

---

## ğŸ“‹ ç›®å½•

1. [ç³»ç»Ÿæ¦‚è¿°](#ç³»ç»Ÿæ¦‚è¿°)
2. [æ¶æ„è®¾è®¡](#æ¶æ„è®¾è®¡)
3. [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
4. [é…ç½®è¯´æ˜](#é…ç½®è¯´æ˜)
5. [ä½¿ç”¨æ–¹æ³•](#ä½¿ç”¨æ–¹æ³•)
6. [API å‚è€ƒ](#api-å‚è€ƒ)
7. [æ•…éšœæ’æŸ¥](#æ•…éšœæ’æŸ¥)

---

## ç³»ç»Ÿæ¦‚è¿°

ä¸‰æ¼æ–—æ‰«æç³»ç»Ÿæ˜¯ä¸€ä¸ªæ™ºèƒ½åŒ–çš„è‚¡ç¥¨ç­›é€‰å’Œç›‘æ§ç³»ç»Ÿï¼Œé€šè¿‡ä¸‰çº§ç­›é€‰æ¼æ–—å’Œå®æ—¶ç›‘æ§ï¼Œå¸®åŠ©ç”¨æˆ·è¯†åˆ«æ½œåœ¨çš„äº¤æ˜“æœºä¼šã€‚

### æ ¸å¿ƒåŠŸèƒ½

- **æ¼æ–—1: ç›˜åç­›é€‰ (Level 1-3)**
  - Level 1: åŸºç¡€è¿‡æ»¤ (ä»·æ ¼ã€æˆäº¤é‡ã€æ¢æ‰‹ç‡)
  - Level 2: èµ„é‡‘æµå‘åˆ†æ (DDEã€ä¸»åŠ›èµ„é‡‘)
  - Level 3: é£é™©è¯„ä¼° (è¯±å¤šæ£€æµ‹ã€èµ„é‡‘æ€§è´¨)

- **æ¼æ–—2: ç›˜ä¸­è§¦å‘ (Level 4)**
  - VWAP çªç ´æ£€æµ‹
  - æ‰«å•çˆ†é‡æ£€æµ‹
  - ç«ä»·çˆ†é‡æ£€æµ‹

- **ä¿¡å·ç®¡ç†**
  - ä¿¡å·å»é‡ (é¿å…é‡å¤è§¦å‘)
  - ä¿¡å·é€šçŸ¥ (UIã€æ—¥å¿—ã€é‚®ä»¶)
  - ä¿¡å·ç»Ÿè®¡

### ç³»ç»Ÿç‰¹ç‚¹

âœ… **æ¸è¿›å¼ç­›é€‰**: ä»å…¨å¸‚åœºâ†’ç­›é€‰æ± â†’è§‚å¯Ÿæ± ï¼Œé€å±‚è¿‡æ»¤
âœ… **å®æ—¶ç›‘æ§**: åŸºäºTickæ•°æ®çš„å®æ—¶ä¿¡å·æ£€æµ‹
âœ… **é£é™©æ§åˆ¶**: å¤šå±‚é£é™©è¯„ä¼°ï¼Œé¿å…ä¹°å…¥é—®é¢˜è‚¡
âœ… **å¯é…ç½®åŒ–**: æ‰€æœ‰å‚æ•°éƒ½å¯é€šè¿‡é…ç½®æ–‡ä»¶è°ƒæ•´
âœ… **ç§æœ‰åŒ–**: å®Œå…¨æœ¬åœ°è¿è¡Œï¼Œæ•°æ®å®‰å…¨å¯æ§

---

## æ¶æ„è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ä¸‰æ¼æ–—æ‰«æç³»ç»Ÿæ¶æ„                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  ğŸ“Š æ¼æ–—1: ç›˜åç­›é€‰ (Level 1-3)                                 â”‚
â”‚  â”œâ”€ Level 1: åŸºç¡€è¿‡æ»¤ (ä»·æ ¼/æˆäº¤é‡/æŠ€æœ¯æŒ‡æ ‡)                    â”‚
â”‚  â”œâ”€ Level 2: èµ„é‡‘æµå‘åˆ†æ (DDE/ä¸»åŠ›èµ„é‡‘/æ¿å—çƒ­åº¦)                â”‚
â”‚  â””â”€ Level 3: é£é™©è¯„ä¼° (è¯±å¤šæ£€æµ‹/èµ„é‡‘æ€§è´¨/é£é™©è¯„åˆ†)               â”‚
â”‚                                                                 â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚
â”‚                                                                 â”‚
â”‚  ğŸ¯ è§‚å¯Ÿæ±  (Watchlist Pool)                                     â”‚
â”‚  â”œâ”€ æ‰‹åŠ¨ç»´æŠ¤ (30-50åª)                                          â”‚
â”‚  â”œâ”€ ç›˜å‰è¡¥å…… (AkShareå¿«ç…§)                                      â”‚
â”‚  â””â”€ åŠ¨æ€è°ƒæ•´ (æ ¹æ®ç­›é€‰ç»“æœ)                                      â”‚
â”‚                                                                 â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚
â”‚                                                                 â”‚
â”‚  âš¡ æ¼æ–—2: ç›˜ä¸­è§¦å‘ (Level 4)                                    â”‚
â”‚  â”œâ”€ Tickå®æ—¶ç›‘æ§ (VWAPçªç ´/æ‰«å•/ç«ä»·çˆ†é‡)                        â”‚
â”‚  â”œâ”€ ä¿¡å·å»é‡ (é¿å…é‡å¤è§¦å‘)                                      â”‚
â”‚  â””â”€ è‡ªåŠ¨é€šçŸ¥ (UIå¼¹çª—/æ—¥å¿—/é‚®ä»¶)                                  â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ•°æ®æµ

```
[å…¨å¸‚åœº5000åª]
    â†“
[Level 1 åŸºç¡€è¿‡æ»¤]
    â†“ (çº¦1000åª)
[Level 2 èµ„é‡‘æµå‘åˆ†æ]
    â†“ (çº¦100åª)
[Level 3 é£é™©è¯„ä¼°]
    â†“ (çº¦30åª)
[è§‚å¯Ÿæ± ]
    â†“
[Level 4 ç›˜ä¸­ç›‘æ§]
    â†“
[ä¿¡å·è§¦å‘]
    â†“
[äº¤æ˜“æ‰§è¡Œ]
```

---

## å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–

ç³»ç»Ÿä¾èµ–å·²åŒ…å«åœ¨ `requirements.txt` ä¸­ï¼Œç¡®ä¿å·²å®‰è£…ï¼š

```bash
pip install -r requirements.txt
```

### 2. åˆå§‹åŒ–é…ç½®

é…ç½®æ–‡ä»¶å·²è‡ªåŠ¨åˆ›å»ºåœ¨ `config/` ç›®å½•ï¼š

- `config/watchlist_pool.json` - è§‚å¯Ÿæ± é…ç½®
- `config/signal_config.json` - ä¿¡å·é…ç½®

### 3. æ·»åŠ è‚¡ç¥¨åˆ°è§‚å¯Ÿæ± 

**æ–¹å¼1: å‘½ä»¤è¡Œ**

```bash
python tasks/run_triple_funnel_scan.py --mode add --code 000001 --name å¹³å®‰é“¶è¡Œ --reason æµ‹è¯•ç”¨
```

**æ–¹å¼2: UIç•Œé¢**

```bash
streamlit run ui/triple_funnel_tab.py
```

### 4. è¿è¡Œç›˜åæ‰«æ

```bash
python tasks/run_triple_funnel_scan.py --mode post-market
```

### 5. è¿è¡Œç›˜ä¸­ç›‘æ§

```bash
python tasks/run_triple_funnel_scan.py --mode intraday
```

---

## é…ç½®è¯´æ˜

### è§‚å¯Ÿæ± é…ç½® (watchlist_pool.json)

```json
{
  "stocks": [
    {
      "code": "000001",
      "name": "å¹³å®‰é“¶è¡Œ",
      "reason": "æµ‹è¯•ç”¨",
      "added_at": "2026-02-05T00:00:00",
      "last_updated": "2026-02-05T00:00:00",
      "level1_result": null,
      "level2_result": null,
      "level3_result": null
    }
  ],
  "created_at": "2026-02-05",
  "updated_at": "2026-02-05"
}
```

### ä¿¡å·é…ç½® (signal_config.json)

```json
{
  "deduplication": {
    "time_window_minutes": 5,
    "price_threshold_pct": 0.5,
    "cooldown_period_minutes": {
      "VWAP_BREAKOUT": 10,
      "VOLUME_SURGE": 5,
      "AUCTION_SPIKE": 3
    }
  },
  "notification": {
    "channels": ["UI_POPUP", "LOG"],
    "email": {
      "enabled": false,
      "smtp_server": "",
      "smtp_port": 587,
      "from_addr": "",
      "to_addrs": [],
      "username": "",
      "password": ""
    }
  }
}
```

#### å»é‡é…ç½®

- `time_window_minutes`: æ—¶é—´çª—å£ (åˆ†é’Ÿ) - åŒä¸€è‚¡ç¥¨åŒä¸€ä¿¡å·ç±»å‹åœ¨Nåˆ†é’Ÿå†…åªè§¦å‘ä¸€æ¬¡
- `price_threshold_pct`: ä»·æ ¼é˜ˆå€¼ (0.5%) - ä»·æ ¼å˜åŒ–è¶…è¿‡é˜ˆå€¼æ‰è§¦å‘æ–°ä¿¡å·
- `cooldown_period_minutes`: å†·å´æœŸ (åˆ†é’Ÿ) - é«˜é¢‘ä¿¡å·è®¾ç½®å†·å´æœŸ

#### é€šçŸ¥é…ç½®

- `channels`: é€šçŸ¥æ¸ é“ - ["UI_POPUP", "LOG", "EMAIL", "WECHAT", "DINGTALK"]
- `email`: é‚®ä»¶é€šçŸ¥é…ç½® (å¯é€‰)

---

## ä½¿ç”¨æ–¹æ³•

### å‘½ä»¤è¡Œç•Œé¢

#### ç›˜åæ‰«æ

```bash
# åŸºæœ¬ç”¨æ³•
python tasks/run_triple_funnel_scan.py --mode post-market

# é™åˆ¶æ‰«ææ•°é‡
python tasks/run_triple_funnel_scan.py --mode post-market --max-stocks 50
```

#### ç›˜ä¸­ç›‘æ§

```bash
# åŸºæœ¬ç”¨æ³•
python tasks/run_triple_funnel_scan.py --mode intraday

# è‡ªå®šä¹‰ç›‘æ§é—´éš”
python tasks/run_triple_funnel_scan.py --mode intraday --interval 5
```

#### è§‚å¯Ÿæ± ç®¡ç†

```bash
# æ·»åŠ è‚¡ç¥¨
python tasks/run_triple_funnel_scan.py --mode add --code 000001 --name å¹³å®‰é“¶è¡Œ --reason æµ‹è¯•ç”¨

# ç§»é™¤è‚¡ç¥¨
python tasks/run_triple_funnel_scan.py --mode remove --code 000001

# æŸ¥çœ‹è§‚å¯Ÿæ± 
python tasks/run_triple_funnel_scan.py --mode watchlist
```

#### ä¿¡å·æŸ¥çœ‹

```bash
# æŸ¥çœ‹æœ€è¿‘çš„ä¿¡å·
python tasks/run_triple_funnel_scan.py --mode signals
```

### UI ç•Œé¢

#### å¯åŠ¨ UI

```bash
streamlit run ui/triple_funnel_tab.py
```

#### åŠŸèƒ½æ¨¡å—

1. **è§‚å¯Ÿæ± ç®¡ç†**
   - æ·»åŠ /ç§»é™¤è‚¡ç¥¨
   - æŸ¥çœ‹ç­›é€‰ç»“æœ
   - æŸ¥çœ‹é£é™©è¯„åˆ†

2. **ç›˜åæ‰«æ**
   - è¿è¡Œ Level 1-3 ç­›é€‰
   - æŸ¥çœ‹é€šè¿‡ç­›é€‰çš„è‚¡ç¥¨
   - æŸ¥çœ‹æœªé€šè¿‡çš„åŸå› 

3. **ç›˜ä¸­ç›‘æ§**
   - å®æ—¶ç›‘æ§è‚¡ç¥¨
   - æ˜¾ç¤ºä¿¡å·é€šçŸ¥
   - æŸ¥çœ‹å®æ—¶ä»·æ ¼

4. **ä¿¡å·å†å²**
   - æŸ¥çœ‹æœ€è¿‘çš„ä¿¡å·
   - ç­›é€‰ä¿¡å·
   - æŸ¥çœ‹ä¿¡å·è¯¦æƒ…

---

## API å‚è€ƒ

### TripleFunnelScanner

```python
from logic.triple_funnel_scanner import TripleFunnelScanner

# åˆ›å»ºæ‰«æå™¨
scanner = TripleFunnelScanner()

# è¿è¡Œç›˜åæ‰«æ
passed = scanner.run_post_market_scan(max_stocks=100)

# è¿è¡Œç›˜ä¸­ç›‘æ§
signals = scanner.run_intraday_monitor(interval=3)
```

### SignalManager

```python
from logic.signal_manager import get_signal_manager
from logic.triple_funnel_scanner import TradingSignal, SignalType, RiskLevel

# è·å–ä¿¡å·ç®¡ç†å™¨
signal_manager = get_signal_manager()

# å¤„ç†ä¿¡å·
triggered = signal_manager.process_signal(signal)

# è·å–æœ€è¿‘çš„ä¿¡å·
signals = signal_manager.get_recent_signals(hours=24)

# è·å–ä¿¡å·ç»Ÿè®¡
stats = signal_manager.get_signal_stats()
```

### WatchlistManager

```python
from logic.triple_funnel_scanner import WatchlistManager

# åˆ›å»ºè§‚å¯Ÿæ± ç®¡ç†å™¨
manager = WatchlistManager()

# æ·»åŠ è‚¡ç¥¨
manager.add("000001", "å¹³å®‰é“¶è¡Œ", "æµ‹è¯•ç”¨")

# ç§»é™¤è‚¡ç¥¨
manager.remove("000001")

# è·å–æ‰€æœ‰è‚¡ç¥¨
items = manager.get_all()

# è·å–æ‰€æœ‰ä»£ç 
codes = manager.get_codes()
```

---

## æ•…éšœæ’æŸ¥

### é—®é¢˜1: ç›˜åæ‰«æè¿”å›ç©ºç»“æœ

**åŸå› **: è§‚å¯Ÿæ± ä¸ºç©ºæˆ–æ•°æ®è·å–å¤±è´¥

**è§£å†³æ–¹æ¡ˆ**:
1. æ£€æŸ¥è§‚å¯Ÿæ± æ˜¯å¦æœ‰è‚¡ç¥¨: `python tasks/run_triple_funnel_scan.py --mode watchlist`
2. æ·»åŠ è‚¡ç¥¨åˆ°è§‚å¯Ÿæ± 
3. æ£€æŸ¥ç½‘ç»œè¿æ¥
4. æ£€æŸ¥æ•°æ®æºé…ç½®

### é—®é¢˜2: ç›˜ä¸­ç›‘æ§æ— ä¿¡å·

**åŸå› **:
1. ä¸åœ¨äº¤æ˜“æ—¶é—´
2. ç›‘æ§è‚¡ç¥¨ä¸ç¬¦åˆè§¦å‘æ¡ä»¶
3. æ•°æ®è·å–å¤±è´¥

**è§£å†³æ–¹æ¡ˆ**:
1. ç¡®è®¤å½“å‰æ˜¯äº¤æ˜“æ—¶é—´
2. æ£€æŸ¥ç›‘æ§åˆ—è¡¨
3. æŸ¥çœ‹æ—¥å¿—è·å–è¯¦ç»†ä¿¡æ¯

### é—®é¢˜3: ä¿¡å·é‡å¤è§¦å‘

**åŸå› **: å»é‡é…ç½®ä¸åˆé€‚

**è§£å†³æ–¹æ¡ˆ**:
1. è°ƒæ•´ `config/signal_config.json` ä¸­çš„å»é‡å‚æ•°
2. å¢åŠ  `time_window_minutes`
3. å¢åŠ  `price_threshold_pct`

### é—®é¢˜4: UI æ— æ³•æ˜¾ç¤º

**åŸå› **: Streamlit æœªå®‰è£…æˆ–ç‰ˆæœ¬ä¸å…¼å®¹

**è§£å†³æ–¹æ¡ˆ**:
```bash
pip install --upgrade streamlit
```

### é—®é¢˜5: æ•°æ®è·å–å¤±è´¥

**åŸå› **:
1. ç½‘ç»œé—®é¢˜
2. ä»£ç†è®¾ç½®é—®é¢˜
3. æ•°æ®æºæœåŠ¡å¼‚å¸¸

**è§£å†³æ–¹æ¡ˆ**:
1. æ£€æŸ¥ç½‘ç»œè¿æ¥
2. ç¡®è®¤å·²ç¦ç”¨ä»£ç† (ç³»ç»Ÿä¼šè‡ªåŠ¨å¤„ç†)
3. æ£€æŸ¥æ•°æ®æºæœåŠ¡çŠ¶æ€

---

## æµ‹è¯•

è¿è¡Œæµ‹è¯•å¥—ä»¶:

```bash
python tests/test_triple_funnel.py
```

æµ‹è¯•å†…å®¹åŒ…æ‹¬:
- Level 1 è¿‡æ»¤å™¨
- Level 2 åˆ†æå™¨
- Level 3 é£é™©è¯„ä¼°å™¨
- è§‚å¯Ÿæ± ç®¡ç†å™¨
- ä¿¡å·å»é‡å™¨
- ä¿¡å·ç®¡ç†å™¨
- ä¸‰æ¼æ–—æ‰«æå™¨

---

## æœ€ä½³å®è·µ

### 1. è§‚å¯Ÿæ± ç®¡ç†

- **æ•°é‡æ§åˆ¶**: ä¿æŒè§‚å¯Ÿæ± åœ¨ 30-50 åªè‚¡ç¥¨
- **å®šæœŸæ¸…ç†**: ç§»é™¤é•¿æœŸä¸æ´»è·ƒçš„è‚¡ç¥¨
- **åˆ†æ•£é…ç½®**: ä¸è¦é›†ä¸­åœ¨å•ä¸€æ¿å—

### 2. ç›˜åæ‰«æ

- **æ—¶é—´é€‰æ‹©**: å»ºè®®åœ¨æ”¶ç›˜å 30 åˆ†é’Ÿè¿è¡Œ (15:30)
- **æ•°é‡é™åˆ¶**: é¿å…æ‰«æè¿‡å¤šè‚¡ç¥¨å½±å“æ€§èƒ½
- **ç»“æœåˆ†æ**: ä»”ç»†æŸ¥çœ‹æœªé€šè¿‡çš„åŸå› 

### 3. ç›˜ä¸­ç›‘æ§

- **ç›‘æ§é—´éš”**: å»ºè®®ä½¿ç”¨ 3-5 ç§’é—´éš”
- **äº¤æ˜“æ—¶é—´**: åªåœ¨äº¤æ˜“æ—¶é—´è¿è¡Œ
- **ä¿¡å·ç¡®è®¤**: é‡è¦ä¿¡å·å»ºè®®äººå·¥ç¡®è®¤åå†æ‰§è¡Œ

### 4. ä¿¡å·ç®¡ç†

- **å»é‡è®¾ç½®**: æ ¹æ®å®é™…éœ€æ±‚è°ƒæ•´å»é‡å‚æ•°
- **é€šçŸ¥æ¸ é“**: æ ¹æ®éœ€è¦å¯ç”¨ä¸åŒçš„é€šçŸ¥æ¸ é“
- **å†å²è®°å½•**: å®šæœŸæŸ¥çœ‹ä¿¡å·å†å²ï¼Œä¼˜åŒ–ç­–ç•¥

---

## æ›´æ–°æ—¥å¿—

### V1.0 (2026-02-05)

- âœ… å®ç°ä¸‰çº§ç­›é€‰æ¼æ–— (Level 1-3)
- âœ… å®ç°ç›˜ä¸­å®æ—¶ç›‘æ§ (Level 4)
- âœ… å®ç°ä¿¡å·å»é‡ç³»ç»Ÿ
- âœ… å®ç°ä¿¡å·é€šçŸ¥ç³»ç»Ÿ
- âœ… åˆ›å»ºè§‚å¯Ÿæ± ç®¡ç†
- âœ… åˆ›å»º UI ç•Œé¢
- âœ… åˆ›å»ºå‘½ä»¤è¡Œå·¥å…·
- âœ… åˆ›å»ºæµ‹è¯•å¥—ä»¶

---

## æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æŸ¥çœ‹:
- é¡¹ç›®æ–‡æ¡£: `docs/`
- æ—¥å¿—æ–‡ä»¶: `logs/`
- é…ç½®æ–‡ä»¶: `config/`

---

**ç¥æ‚¨ä½¿ç”¨æ„‰å¿«ï¼** ğŸš€