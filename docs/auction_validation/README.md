# 竞价诱多系统验证文档

## 📋 概述

本目录用于记录竞价诱多系统的真实环境验证结果，确保从"工程闭环"到"实战可用"的持续跟踪。

---

## 📊 验收标准

### 1. 工程闭环验收（日内链路）

**目标**：验证 `09:25 竞价 → 数据入库 → 数据质量标记 → 09:35 后诱多回放` 链路在生产环境畅通。

**验收项**：

| 检查项 | 标准 | 结果 |
|--------|------|------|
| 环境标记 | `data_source = production` | ☐ 通过 |
| 数据有效率 | `volume_ratio_valid = True` 比例 > 80% | ☐ 通过 |
| 告警机制 | 历史数据无效率 < 10% | ☐ 通过 |
| 诱多检出 | 检出率 1%-10% 之间 | ☐ 通过 |
| 人工复核 | 10只样本准确率 > 70% | ☐ 通过 |

---

### 2. 统计形状验证（策略维度）

**目标**：验证统计分布是否合理，符合真实市场特征。

#### 2.1 量比分布

**预期**：
- 绝大多数在 0.5-3 之间
- 长尾到 10-30
- 极端值（>100）数量 < 1%

**记录格式**：
```markdown
## 量比分布 - YYYY-MM-DD

| 区间 | 数量 | 占比 |
|------|------|------|
| 0-0.5 | N | X% |
| 0.5-1.0 | N | X% |
| 1.0-2.0 | N | X% |
| 2.0-5.0 | N | X% |
| 5.0-10.0 | N | X% |
| >10.0 | N | X% |

**判定**：☐ 合格 / ☐ 异常
```

#### 2.2 竞价涨跌幅分布

**预期**：
- 中位数接近 0（±0.5%内）
- 超过 ±5% 的 < 5%
- 超过 ±10% 的 < 1%

**记录格式**：
```markdown
## 竞价涨跌幅分布 - YYYY-MM-DD

| 区间 | 数量 | 占比 |
|------|------|------|
| <-10% | N | X% |
| -10%~-5% | N | X% |
| -5%~-2% | N | X% |
| -2%~+2% | N | X% |
| +2%~+5% | N | X% |
| +5%~+10% | N | X% |
| >+10% | N | X% |

中位数：X.XX%
**判定**：☐ 合格 / ☐ 异常
```

#### 2.3 诱多检出率稳定性

**预期**：
- 普通市况：检出率 1%-5%
- 激进市况：检出率 5%-10%
- 极端市况：检出率 >10% 或 <1%

**记录格式**：
```markdown
## 诱多检出率 - YYYY-MM-DD

市场环境：☐ 普涨 / ☐ 普跌 / ☐ 震荡 / ☐ 其他

| 指标 | 数值 |
|------|------|
| 样本总数 | N |
| 诱多候选数 | M |
| 检出率 | X.XX% |
| 有效数据率 | X.XX% |

**判定**：☐ 合格 / ☐ 异常
```

---

## 📝 每日验证报告模板

创建文件：`YYYYMMDD.md`

```markdown
# 竞价诱多系统验证报告 - YYYY-MM-DD

## 📌 基本信息

| 字段 | 值 |
|------|-----|
| 日期 | YYYY-MM-DD |
| 市场环境 | ☐ 普涨 / ☐ 普跌 / ☐ 震荡 / ☐ 其他 |
| 采集时间 | HH:MM:SS |
| 采集耗时 | X.X 秒 |

---

## 📊 数据质量

### 2.1 基础统计

| 指标 | 数值 |
|------|------|
| 样本总数 | N |
| 有效数据数 | M |
| 数据有效率 | X.XX% |
| 数据来源 | production / simulated |

### 2.2 量比分布

（参考上面的记录格式）

### 2.3 竞价涨跌幅分布

（参考上面的记录格式）

---

## 🎯 诱多检出

### 3.1 检出统计

| 指标 | 数值 |
|------|------|
| 诱多候选数 | M |
| 检出率 | X.XX% |
| 高开诱多 | N |
| 低开诱多 | N |

### 3.2 诱多候选列表（Top 20）

| 代码 | 名称 | 竞价价 | 涨跌幅% | 量比 | 类型 |
|------|------|--------|---------|------|------|
| XXXXXX.XX | XXX | XX.XX | X.XX | X.XX | XXX |

### 3.3 人工复核样本

| 代码 | 名称 | 判定 | 说明 |
|------|------|------|------|
| XXXXXX.XX | XXX | ☐ 诱多 / ☐ 一般 / ☐ 误判 | XXX |
| ... | ... | ... | ... |

**准确率**：X/10 = XX%

---

## ⚠️ 异常告警

- [ ] 历史数据无效率 > 50%
- [ ] 历史数据无效率 > 90%
- [ ] 量比异常（>1000）
- [ ] 涨跌幅异常（>50%）
- [ ] 其他异常

---

## 📝 备注

（记录当日特殊情况、市场事件、系统问题等）

---

## ✅ 验收结论

**工程闭环**：☐ 通过 / ☐ 不通过
**统计形状**：☐ 合格 / ☐ 异常
**综合判定**：☐ 可用 / ☐ 需调整 / ☐ 暂停使用

---

## 📌 历史趋势

（持续跟踪关键指标的变化）

| 日期 | 有效率 | 检出率 | 中位数 | 判定 |
|------|--------|--------|--------|------|
| MM-DD | XX% | XX% | X.XX% | ☐ |
| ... | ... | ... | ... | ... |
```

---

## 🔧 使用指南

### 运行每日验证脚本

```bash
# 自动生成今日报告
python tools/generate_auction_daily_report.py

# 指定日期
python tools/generate_auction_daily_report.py --date 2026-02-11

# 输出格式
python tools/generate_auction_daily_report.py --format markdown
python tools/generate_auction_daily_report.py --format json
```

### 运行日内链路验收

```bash
# 09:24-09:26 采集竞价
python tasks/collect_auction_snapshot.py --date YYYY-MM-DD

# 09:35-09:45 诱多回放
python tasks/replay_auction_snapshot.py --date YYYY-MM-DD --detect --top 100
```

---

## 📈 持续改进

### 已知问题

1. QMT历史接口在模拟环境返回空DataFrame（已标记为simulated）
2. 买单/卖单数量字段暂不可用（硬设为0）
3. 量比阈值需要在真实数据上重新标定

### 改进计划

- [ ] 接入真实QMT生产环境
- [ ] 量比阈值自动调优
- [ ] 增加多源数据交叉验证
- [ ] 增加订单流维度分析

---

**版本**：V9.3.6 + 数据质量保障系统
**最后更新**：2026-02-11
**负责人**：量化CTO