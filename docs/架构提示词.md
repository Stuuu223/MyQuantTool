# 架构提示词 - 避免大型重构的最佳实践

## 🎯 核心原则

在开始编码前，先规划好架构，避免后期需要大规模重构。

---

## 📋 项目初始化阶段

### 提示词 1：项目结构规划

```
你是一个资深软件架构师。请帮我规划一个 [项目类型] 的项目结构。

要求：
1. 遵循最佳实践的项目目录结构
2. 考虑可扩展性和可维护性
3. 适合 [技术栈]
4. 包含所有必要的目录和文件

请提供：
- 完整的目录树
- 每个目录/文件的用途说明
- 模块划分原则
- 依赖关系说明
```

### 提示词 2：模块化设计

```
你是一个资深软件架构师。我需要设计一个 [功能描述] 的应用。

请提供：
1. 模块划分方案（每个模块的职责）
2. 模块间的依赖关系
3. 接口设计（如果需要）
4. 数据流设计

要求：
- 高内聚低耦合
- 单一职责原则
- 易于测试和维护
```

---

## 🔨 开发阶段

### 提示词 3：增量开发

```
你是一个资深软件开发者。我需要开发 [功能描述]。

请采用增量开发的方式：
1. 先创建目录结构和基础文件
2. 然后实现核心功能模块
3. 最后实现 UI 和集成

每一步都要：
- 创建独立的模块文件
- 保持每个文件在 300 行以内
- 添加完整的类型注解和文档字符串
- 确保模块间通过清晰的接口通信

请按步骤实施，每完成一步再进行下一步。
```

### 提示词 4：分文件实现

```
你是一个资深软件开发者。我需要实现 [功能描述]。

请将功能拆分为多个文件：
1. 每个文件只负责一个独立的功能模块
2. 每个文件不超过 300 行代码
3. 文件名要清晰表达其职责
4. 模块间通过导入和函数调用通信

请提供：
- 文件列表和职责说明
- 每个文件的接口设计
- 模块间的调用关系
```

---

## 🏗️ 架构设计阶段

### 提示词 5：分层架构

```
你是一个资深软件架构师。请为 [项目类型] 设计分层架构。

请提供：
1. 表现层（UI/接口）
2. 业务逻辑层
3. 数据访问层
4. 工具/通用层

每层的职责：
- 包含哪些模块
- 模块间的调用规则
- 数据流向
```

### 提示词 6：依赖管理

```
你是一个资深软件架构师。请为 [项目类型] 设计依赖管理方案。

请提供：
1. 模块依赖关系图
2. 避免循环依赖的原则
3. 接口设计原则
4. 如何降低耦合度
```

---

## 📝 代码组织原则

### 提示词 7：文件大小控制

```
你是一个代码审查专家。请审查以下代码文件 [文件路径]。

检查：
1. 文件是否超过 300 行
2. 是否可以拆分为多个小文件
3. 每个函数是否超过 50 行
4. 是否有重复代码

如果需要优化，请提供：
- 拆分方案
- 新文件的结构
- 模块间的接口设计
```

### 提示词 8：职责分离

```
你是一个代码审查专家。请审查 [文件路径] 的代码。

检查：
1. 是否遵循单一职责原则
2. 是否有多个不相关的功能混在一起
3. 是否可以提取为独立模块

请提供：
- 职责分析
- 拆分建议
- 新模块的接口设计
```

---

## 🎨 UI/前端架构

### 提示词 9：UI 模块化

```
你是一个前端架构师。我需要开发一个 [UI 类型] 的应用。

请设计模块化的 UI 架构：
1. 每个 Tab/Page 作为独立模块
2. 共享组件提取到 components 目录
3. 状态管理方案
4. 路由设计

请提供：
- 目录结构
- 组件划分
- 状态管理方案
```

### 提示词 10：组件复用

```
你是一个前端架构师。请审查 [UI 代码] 的组件设计。

检查：
1. 是否有重复的 UI 代码
2. 是否可以提取为可复用组件
3. 组件的 props 设计是否合理

请提供：
- 可复用组件列表
- 组件的接口设计
- 优化后的代码结构
```

---

## 🔧 重构指导

### 提示词 11：安全重构

```
你是一个资深软件开发者。我需要重构 [文件路径]，该文件有 [行数] 行。

请制定安全的重构计划：
1. 先分析文件结构和职责
2. 提供重构步骤（不要直接修改代码）
3. 每一步的风险评估
4. 测试策略

要求：
- 逐步重构，每次只修改一个模块
- 每次修改后都能运行和测试
- 保持向后兼容
```

### 提示词 12：测试驱动重构

```
你是一个资深软件开发者。我需要重构 [文件路径]。

请采用测试驱动的方式重构：
1. 先为现有代码编写测试
2. 然后逐步重构，确保测试始终通过
3. 每次重构一个功能模块

请提供：
- 测试策略
- 重构步骤
- 每一步的验证方法
```

---

## 🚀 新项目启动

### 提示词 13：项目脚手架

```
你是一个资深软件架构师。我要创建一个 [项目类型] 项目。

请提供完整的项目脚手架：
1. 目录结构（包含所有必要的目录和文件）
2. 每个目录的 README 说明
3. 配置文件模板
4. 初始代码框架

要求：
- 遵循最佳实践
- 模块化设计
- 易于扩展
```

### 提示词 14：技术选型

```
你是一个资深软件架构师。我要开发 [项目描述]。

请帮我选择技术栈：
1. 后端框架（如果需要）
2. 前端框架（如果需要）
3. 数据库方案
4. 缓存方案
5. 部署方案

请提供：
- 每个选项的优缺点
- 推荐方案及理由
- 技术栈兼容性分析
```

---

## 📊 代码质量保证

### 提示词 15：代码审查清单

```
你是一个代码审查专家。请审查 [文件路径] 的代码。

检查清单：
1. 文件大小（不超过 300 行）
2. 函数大小（不超过 50 行）
3. 类型注解完整性
4. 文档字符串完整性
5. 错误处理是否完善
6. 是否有重复代码
7. 命名规范是否一致
8. 是否遵循单一职责原则

请提供：
- 发现的问题列表
- 优化建议
- 优先级排序
```

### 提示词 16：架构评估

```
你是一个代码审查专家。请评估 [项目路径] 的架构。

评估维度：
1. 模块化程度
2. 耦合度
3. 可扩展性
4. 可维护性
5. 代码组织

请提供：
- 评分（1-10分）
- 优点列表
- 问题列表
- 改进建议
```

---

## 🎓 最佳实践总结

### 关键原则

1. **先设计后编码**
   - 在写代码前，先规划好架构
   - 创建清晰的目录结构
   - 定义模块职责和接口

2. **小文件原则**
   - 每个文件不超过 300 行
   - 每个函数不超过 50 行
   - 单一职责原则

3. **模块化设计**
   - 每个功能独立成一个模块
   - 模块间通过接口通信
   - 避免循环依赖

4. **增量开发**
   - 先创建基础架构
   - 然后逐步添加功能
   - 每一步都能运行和测试

5. **文档先行**
   - 先写文档字符串
   - 再写类型注解
   - 最后写实现代码

### 避免的陷阱

1. **避免巨型文件**
   - ❌ 不要在一个文件中写所有代码
   - ✅ 拆分为多个小文件
   - ✅ 每个文件职责单一

2. **避免紧耦合**
   - ❌ 模块间直接依赖具体实现
   - ✅ 通过接口通信
   - ✅ 依赖注入

3. **避免重复代码**
   - ❌ 复制粘贴代码
   - ✅ 提取为函数或组件
   - ✅ 使用继承或组合

4. **避免过度设计**
   - ❌ 过度抽象和封装
   - ✅ 适度的抽象
   ✅ YAGNI 原则

### 推荐的工作流

1. **规划阶段**
   - 使用提示词 1-6 设计架构
   - 创建目录结构
   - 定义接口

2. **开发阶段**
   - 使用提示词 7-10 指导开发
   - 增量开发
   - 持续重构

3. **审查阶段**
   - 使用提示词 15-16 审查代码
   - 及时发现问题
   - 持续优化

---

## 💡 实用技巧

### 技巧 1：先写接口

```
在实现功能前，先定义接口：

# 1. 定义接口
def process_data(data: pd.DataFrame) -> Dict[str, Any]:
    """处理数据的接口"""
    pass

# 2. 实现功能
def process_data(data: pd.DataFrame) -> Dict[str, Any]:
    # 实际实现
    pass
```

### 技巧 2：使用类型提示

```
# 在函数签名中明确类型
def calculate_metrics(data: pd.DataFrame) -> Dict[str, float]:
    """计算指标"""
    pass
```

### 技巧 3：文档字符串先行

```
# 先写文档字符串，再写代码
def complex_function(param1: str, param2: int) -> bool:
    """
    函数的详细说明
    
    Args:
        param1: 参数1的说明
        param2: 参数2的说明
        
    Returns:
        返回值的说明
        
    Raises:
        ValueError: 参数无效时
    """
    # 实现代码
    pass
```

### 技巧 4：测试驱动

```
# 先写测试，再写实现
def test_function():
    assert function() == expected

def function():
    # 实现代码
    pass
```

---

## 📚 学习资源

### 推荐阅读

1. 《代码整洁之道》- Robert C. Martin
2. 《架构整洁之道》- Robert C. Martin
3. 《设计模式》- GoF
4. 《重构：改善既有代码的设计》- Martin Fowler

### 关键概念

1. **SOLID 原则**
   - 单一职责原则
   - 开闭原则
   - 里氏替换原则
   - 接口隔离原则
   - 依赖倒置原则

2. **DRY 原则**
   - Don't Repeat Yourself
   - 避免重复代码

3. **KISS 原则**
   - Keep It Simple, Stupid
   - 保持简单

4. **YAGNI 原则**
   - You Aren't Gonna Need It
   - 不要过度设计

---

## 🎯 快速参考

### 项目结构模板

```
project_name/
├── main.py              # 入口文件（< 200行）
├── config.py            # 配置管理
├── requirements.txt     # 依赖管理
├── ui/                  # UI 模块
│   ├── __init__.py
│   ├── page1.py        # 页面1 (< 300行)
│   ├── page2.py        # 页面2 (< 300行)
│   └── components/     # 共享组件
├── logic/               # 业务逻辑
│   ├── __init__.py
│   ├── module1.py      # 模块1 (< 300行)
│   └── module2.py      # 模块2 (< 300行)
├── utils/               # 工具函数
│   ├── __init__.py
│   ├── logger.py       # 日志
│   └── validators.py   # 验证
├── data/               # 数据目录
├── logs/               # 日志目录
└── tests/              # 测试目录
```

### 文件大小限制

- 入口文件：< 200 行
- 业务模块：< 300 行
- 函数：< 50 行
- 类：< 300 行

### 代码组织原则

1. 一个文件一个模块
2. 一个函数一个职责
3. 一个类一个概念
4. 清晰的命名和结构

---

## 🔥 实战建议

### 在开始编码前

1. **问自己 3 个问题**：
   - 这个功能需要哪些模块？
   - 模块间如何通信？
   - 如何避免循环依赖？

2. **画出架构图**：
   - 模块关系图
   - 数据流图
   - 调用链图

3. **创建目录结构**：
   - 先创建所有目录
   - 再创建基础文件
   - 最后实现功能

### 在编码过程中

1. **持续检查**：
   - 文件是否超过 300 行？
   - 函数是否超过 50 行？
   - 是否有重复代码？

2. **及时重构**：
   - 发现问题立即重构
   - 不要等到最后
   - 保持代码整洁

3. **编写测试**：
   - 先写测试
   - 再写实现
   - 确保测试通过

### 在完成后

1. **代码审查**：
   - 检查文件大小
   - 检查代码质量
   - 检查架构设计

2. **文档更新**：
   - 更新 README
   - 更新架构文档
   - 更新 API 文档

3. **持续优化**：
   - 收集反馈
   - 持续改进
   - 保持代码质量

---

## 📝 总结

**核心要点**：
1. 先设计后编码
2. 小文件原则
3. 模块化设计
4. 增量开发
5. 持续重构

**避免的陷阱**：
1. 巨型文件
2. 紧耦合
3. 重复代码
4. 过度设计

**推荐流程**：
1. 规划架构
2. 创建结构
3. 实现功能
4. 代码审查
5. 持续优化

记住：**好的架构是设计出来的，不是重构出来的！**

---

**文档版本**: v1.0  
**创建日期**: 2026-01-05  
**最后更新**: 2026-01-05  
**维护者**: MyQuantTool Team