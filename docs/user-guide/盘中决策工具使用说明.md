# 盘中决策工具使用说明

## 概述

本工具提供盘中实时监控和决策支持，包含两个核心模块：

1. **intraday_monitor.py** - 盘中实时监控器
2. **intraday_decision.py** - 盘中决策工具

## 安装位置

- `logic/intraday_monitor.py` - 盘中监控器
- `tools/intraday_decision.py` - 决策工具

## 快速开始

### 1. 盘中监控器 (IntraDayMonitor)

```python
from logic.intraday_monitor import IntraDayMonitor

monitor = IntraDayMonitor()

# 检查是否交易时间
is_trading = monitor.is_trading_time()
print(f"是否交易时间: {is_trading}")

# 获取交易时间信息
time_info = monitor.get_trading_time_info()
print(f"交易时段: {time_info['trading_period']}")
print(f"距收盘: {time_info['minutes_to_close']} 分钟")

# 获取盘中快照
snapshot = monitor.get_intraday_snapshot('300033')
if snapshot['success']:
    print(f"价格: {snapshot['price']}")
    print(f"涨跌幅: {snapshot['pct_change']}%")
    print(f"信号: {snapshot['signal']}")

# 对比昨日数据
comparison = monitor.compare_with_yesterday('300033', yesterday_file)
if comparison['success']:
    print(f"价格变化: {comparison['comparison']['price_change_pct']}%")
    print(f"趋势变化: {comparison['comparison']['flow_5d_trend']}")
```

### 2. 盘中决策工具 (IntraDayDecisionTool)

```python
from tools.intraday_decision import IntraDayDecisionTool

tool = IntraDayDecisionTool()

# 空仓测试
decision = tool.make_decision(
    stock_code='300033',
    yesterday_file='data/stock_analysis/300033/300033_20260203_125013_90days_enhanced.json',
    current_position=0.0,
    entry_price=None
)

print(f"决策: {decision['decision']}")
print(f"理由: {decision['reason']}")

# 打印详细报告
tool.print_decision_report(decision)

# 有持仓测试
decision = tool.make_decision(
    stock_code='300033',
    yesterday_file='data/stock_analysis/300033/300033_20260203_125013_90days_enhanced.json',
    current_position=1.0,  # 100%仓位
    entry_price=26.50
)

print(f"决策: {decision['decision']}")
print(f"置信度: {decision['confidence']:.0%}")
```

## 决策类型

决策工具会返回以下决策类型：

- **SELL** - 建议卖出
- **HOLD** - 建议持有
- **BUY** - 建议买入
- **WAIT** - 建议等待

## 决策依据

决策基于以下因素：

1. **实时数据**（通过QMT获取）
   - 当前价格和涨跌幅
   - 买卖盘压力
   - 瞬时信号

2. **历史数据**（从昨日分析结果加载）
   - 90天资金流向
   - 资金性质（游资/机构）
   - 诱多风险评分
   - 5日趋势

3. **持仓状态**
   - 当前仓位
   - 入场价格
   - 盈亏比例

## 风险等级

- **LOW** - 风险较低
- **MEDIUM** - 风险中等
- **HIGH** - 风险较高

## 使用场景

### 场景1: 空仓观察
```python
# 你没有持有该股票，想看看是否值得买入
decision = tool.make_decision(
    stock_code='300033',
    yesterday_file='...',
    current_position=0.0,
    entry_price=None
)
```

### 场景2: 持仓止损/止盈
```python
# 你持有该股票，想看看是否需要卖出
decision = tool.make_decision(
    stock_code='300033',
    yesterday_file='...',
    current_position=1.0,  # 满仓
    entry_price=26.50
)
```

### 场景3: 分批操作
```python
# 你持有部分仓位，想看看是否需要加减仓
decision = tool.make_decision(
    stock_code='300033',
    yesterday_file='...',
    current_position=0.5,  # 50%仓位
    entry_price=26.50
)
```

## 注意事项

1. **交易时间限制**
   - 实时数据仅在交易时间（09:30-11:30, 13:00-15:00）可用
   - 非交易时间无法获取实时快照

2. **数据依赖**
   - 需要QMT数据源可用
   - 需要昨日分析结果JSON文件

3. **仅供参考**
   - 本工具仅提供决策参考，不构成投资建议
   - 请结合实际情况独立判断

## 测试

运行测试脚本验证工具功能：

```bash
python temp\test_intraday_tools_temp_20260203.py
```

## 文件结构

```
E:\MyQuantTool\
├── logic\
│   └── intraday_monitor.py  # 盘中监控器
├── tools\
│   └── intraday_decision.py  # 决策工具
└── temp\
    └── test_intraday_tools_temp_20260203.py  # 测试脚本
```

## 更新日志

- 2026-02-03: 初始版本
  - 实现盘中实时监控
  - 实现决策支持
  - 添加交易时间检测
  - 添加历史数据对比