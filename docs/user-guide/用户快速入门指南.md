# MyQuantTool 用户快速入门指南

> 版本：V9.4.8 | 更新日期：2026年2月9日

---

## 📚 目录

- [快速开始](#快速开始)
- [系统概述](#系统概述)
- [界面布局](#界面布局)
- [核心功能](#核心功能)
- [个股分析工具](#个股分析工具)
- [盘中决策工具](#盘中决策工具)
- [QMT数据源说明](#qmt数据源说明)
- [Redis配置](#redis配置)
- [最佳实践](#最佳实践)
- [常见问题](#常见问题)
- [风险提示](#风险提示)

---

## 🚀 快速开始

### 启动方式

MyQuantTool 提供了多种启动方式：

| 启动脚本 | 说明 | Redis 支持 | 推荐度 |
|---------|------|-----------|--------|
| `quick_start.bat` | 快速启动（自动检测 Redis） | ✅ 自动检测 | ⭐⭐⭐⭐⭐ |
| `start_with_redis.bat` | 完整启动（包含 Redis 配置） | ✅ 完整支持 | ⭐⭐⭐⭐ |
| `start_redis_service.bat` | 服务模式启动 | ✅ 服务模式 | ⭐⭐⭐ |
| `start.bat` | 基础启动 | ❌ 不支持 | ⭐⭐ |

### 推荐启动流程

#### 方式1：使用快速启动脚本（推荐）

```cmd
quick_start.bat
```

**特点**：
- 自动检测 Redis 是否已安装
- 自动启动 Redis（如果找到）
- 自动激活虚拟环境
- 一键启动项目

#### 方式2：手动启动

```bash
# 激活虚拟环境（如果存在）
venv\Scripts\activate

# 启动系统
streamlit run main.py
```

系统将在浏览器中自动打开 http://localhost:8501

### 明日作战时间表

#### 9:15 - 盘前准备
- 双击 `quick_start.bat`
- 等待系统启动完成
- 点击侧边栏的"🔥 盘前预热"按钮
- 等待预热完成（约5-10秒）

#### 9:25 - 竞价时刻
- 观察竞价抢筹度
- 关注高开股票
- 查看技术形态标签

#### 9:30 - 开盘扫描
- 点击"🔍 开始扫描"按钮
- 查看扫描结果：
  - 📈 多头排列 🟢 站上20日线 - 关注
  - 📉 空头排列 🔴 跌破20日线 - 避开
  - ⚠️ 短期超买 - 谨慎
- 查看风险扫描结果：
  - ✅ 风险等级: 无 - 安全
  - 🔴 风险等级: 高 - 危险

#### 交易时段
- 关注龙头股（⭐⭐⭐）
- 关注技术形态良好的股票
- 避开风险等级高的股票

---

## 📊 系统概述

### 系统能力

#### 眼观六路
- 全市场实时扫描
- 实时技术分析（多线程并发）
- 8只股票 < 1秒

#### 耳听八方
- 历史趋势 + 实时突破
- K线趋势否决权
- 风险扫描预警

#### 心如止水
- AI 风控 + 静态熔断
- 反人性协议
- 情绪周期判断

#### 手起刀落
- 多线程并发 + 毫秒级决策
- 实时价格注入
- 智能评分系统

### 数据源架构

**QMT 数据接口可以作为额外的数据源，但不是必需的！**

你的项目已经有：
- ✅ **easyquotation** - 实时行情（主要数据源）
- ✅ **AkShare** - 市场数据（已在使用）
- ✅ **QMT xtdata** - 备用数据源（可选）

**数据源优先级**：
1. 实时行情：使用 easyquotation
2. 历史数据：使用 AkShare
3. 备用数据：使用 QMT xtdata（可选）

---

## 🖥️ 界面布局

```
┌─────────────────────────────────────────────────┐
│  🎮 控制台（左侧边栏）                          │
│  ├─ 股票代码输入                                │
│  ├─ 日期选择                                    │
│  ├─ 策略参数调整                                │
│  ├─ ⭐ 自选股管理                               │
│  ├─ 🔧 配置管理                                 │
│  └─ 📖 技术指标解释（重要！）                   │
├─────────────────────────────────────────────────┤
│  主界面（三个标签页）                           │
│  ├─ 📊 单股分析                                 │
│  ├─ 🔍 多股对比                                 │
│  └─ 🧪 策略回测                                 │
└─────────────────────────────────────────────────┘
```

---

## 🎯 核心功能

### 1. 📊 单股分析

#### 基础操作
1. **输入股票代码**
   - 在左侧"股票代码"框输入 6 位代码
   - 例如：600519（贵州茅台）、000001（平安银行）
   - 点击"🧠 呼叫 AI 投顾"获取智能分析

2. **查看核心指标**
   - 最新价格：当前股价
   - 涨跌幅：今日涨跌百分比
   - ATR 波动率：价格波动程度
   - 网格密度：建议的网格宽度

3. **理解技术指标**
   - **MACD**：判断趋势方向
     - ✅ 向上：适合买入
     - ⚠️ 向下：注意风险
   - **RSI**：判断超买超卖
     - >70：超买，价格偏高
     - <30：超卖，价格偏低
   - **布林带**：判断价格位置
     - 接近上轨：考虑减仓
     - 接近下轨：考虑买入

4. **查看 K 线图**
   - 红色 K 线：上涨
   - 绿色 K 线：下跌
   - 橙色虚线：阻力位（压力位）
   - 绿色虚线：支撑位

5. **AI 智能分析**
   - 点击"🧠 呼叫 AI 投顾"
   - AI 会综合所有指标给出建议
   - 建议：持仓/减仓/观望

### 2. ⭐ 自选股功能

#### 添加自选股
1. 在左侧"⭐ 自选股"区域
2. 输入股票代码（如 600519）
3. 点击"➕ 添加"
4. 股票会自动保存到列表

#### 查看自选股
- 左侧显示所有已关注的股票
- 每个股票旁边有删除按钮

#### 快速切换
- 在"单股分析"标签页顶部
- 使用下拉菜单选择自选股
- 一键切换查看不同股票

### 3. 🔍 多股对比

#### 对比多只股票
1. 切换到"🔍 多股对比"标签页
2. 输入要对比的股票代码（用逗号分隔）
   - 例如：600519,000001,600036
3. 点击"开始对比分析"
4. 查看技术指标对比表格
5. 查看收益率曲线对比图

#### 应用场景
- 选股时对比多只股票
- 查看不同板块的表现
- 评估投资组合

### 4. 🧪 策略回测

#### 运行回测
1. 切换到"🧪 策略回测"标签页
2. 输入回测参数：
   - 股票代码
   - 回测开始日期
   - ATR 倍数（网格宽度）
   - 网格比例（每次交易资金比例）
   - 交易手续费
3. 点击"运行回测"
4. 查看回测报告和资金曲线

#### 理解回测结果
- **总收益率**：策略总盈利百分比
- **年化收益率**：按年计算的收益率
- **最大回撤**：最大亏损幅度
- **交易次数**：总交易次数
- **胜率**：盈利交易占比

---

## 🔧 个股分析工具

### 工具概览

| 工具名称 | 文件名 | 主要用途 | 数据来源 | 输出格式 |
|---------|--------|---------|---------|---------|
| 综合分析工具 | `comprehensive_stock_tool.py` | 基础综合分析 | AkShare + QMT | 文本报告 |
| 增强分析器 | `enhanced_stock_analyzer.py` | 高级技术分析 | AkShare + QMT | 文本/JSON |
| AI 便捷接口 | `stock_ai_tool.py` | AI 调用接口 | AkShare + QMT | JSON |

### 1️⃣ 综合分析工具 (comprehensive_stock_tool.py)

#### 功能特点
- ✅ 结合 AkShare 资金流向 + QMT 实时数据
- ✅ 提供完整的个股分析报告
- ✅ 包含资金流向分析、Tick数据、技术指标
- ✅ 支持自动保存报告到文件

#### 基础使用

**命令行使用**
```bash
# 基础分析（10天）
python comprehensive_stock_tool.py 603697

# 指定天数（30天）
python comprehensive_stock_tool.py 603697 30

# 自动保存报告
python comprehensive_stock_tool.py 603697 10 --save
python comprehensive_stock_tool.py 603697 10 -s

# 快速分析
python comprehensive_stock_tool.py 603697 5 quick
```

**代码调用**
```python
from tools.comprehensive_stock_tool import comprehensive_stock_analysis, quick_analysis

# 完整分析（不保存）
report = comprehensive_stock_analysis('603697', days=10, use_qmt=True)
print(report)

# 完整分析（自动保存）
report, file_path = comprehensive_stock_analysis('603697', days=10, auto_save=True)
print(report)
print(f"已保存到: {file_path}")

# 快速分析
quick_report = quick_analysis('603697', days=5)
print(quick_report)
```

#### 输出内容

```
================================================================================
📊 603697 综合分析报告
================================================================================
分析天数: 最近 10 天
分析时间: 2026-02-02 21:18:01
================================================================================

## 第一部分：资金流向分析（AkShare）
- 每日资金流向数据
- 每日信号分析（吸筹/接盘）
- 趋势统计和操作建议

## 第二部分：QMT 实时数据
- 当前价格、涨跌幅
- 五档盘口
- 买卖压力分析

## 第三部分：技术指标分析
- 均线系统（MA5/10/20/60）
- 乖离率（BIAS）
- 布林带（BOLL）
- RSI、MACD 指标
- 技术面信号

## 第四部分：综合建议
- 资金面评分
- 技术面评分
- 综合建议
- 风险提示
```

### 2️⃣ 增强分析器 (enhanced_stock_analyzer.py)

#### 功能特点
- ✅ 结合 AkShare 资金流向 + QMT 历史K线 + QMT Tick 数据
- ✅ 支持完整的技术指标分析
- ✅ 集成诱多陷阱检测、资金性质分类、风险评分
- ✅ 支持文本报告和 JSON 格式输出

#### 基础使用

**命令行使用**
```bash
# 完整分析（60天）
python enhanced_stock_analyzer.py 603697 60

# 输出所有数据
python enhanced_stock_analyzer.py 603697 60 true

# 纯数据模式（不包含主观判断）
python enhanced_stock_analyzer.py 603697 60 false true
```

**代码调用**
```python
from tools.enhanced_stock_analyzer import analyze_stock_enhanced, analyze_stock_json

# 文本报告
report = analyze_stock_enhanced('603697', days=60, use_qmt=True)
print(report)

# JSON 格式（便于程序处理）
result = analyze_stock_json('603697', days=60, use_qmt=True)
print(result['fund_flow']['trend'])
print(result['summary']['recommendation'])
```

#### JSON 输出格式

```json
{
  "stock_code": "603697",
  "analyze_time": "2026-02-02 21:08:37",
  "analyze_days": 90,
  "fund_flow": {
    "data_range": "2025-08-06 至 2026-02-02",
    "total_days": 90,
    "bullish_days": 33,
    "bearish_days": 57,
    "total_institution": -1413.30,
    "trend": "strong_bearish",
    "daily_data": [...]
  },
  "qmt": {
    "data_range": "2025-12-24 至 2026-02-02",
    "latest": {
      "close": 18.25,
      "pct_chg": 2.52,
      "MA5": 18.10,
      "MA10": 17.85,
      "RSI": 58.32,
      "MACD": 0.15
    },
    "daily_data": [...]
  },
  "summary": {
    "fund_strength": "弱势",
    "tech_strength": "强势",
    "recommendation": "谨慎观望"
  }
}
```

### 3️⃣ AI 便捷接口 (stock_ai_tool.py) ⭐ 推荐

#### 功能特点
- ✅ 统一接口，支持多种分析模式
- ✅ 自动处理 AkShare + QMT 数据
- ✅ 支持增强分析模式（诱多检测、资金分类、风险评分）
- ✅ 适合 AI 直接调用
- ✅ 自动保存 JSON 数据到文件

#### 基本调用

```python
from tools.stock_ai_tool import analyze_stock

# 默认分析（AkShare+QMT）
result = analyze_stock('603697', days=60)
print(result)

# 快速分析
result = analyze_stock('603697', days=5, mode='quick')
print(result)

# 仅AkShare分析
result = analyze_stock('603697', days=60, mode='akshare')
print(result)

# 仅QMT分析
result = analyze_stock('603697', days=60, mode='qmt')
print(result)
```

#### JSON 格式分析

```python
from tools.stock_ai_tool import analyze_stock
import json

# JSON 格式（包含主观判断）
result = analyze_stock('603697', days=60, mode='json')
print(json.dumps(result, indent=2, ensure_ascii=False))

# JSON 格式（纯数据，不包含主观判断）
result = analyze_stock('603697', days=60, mode='json', pure_data=True)
print(json.dumps(result, indent=2, ensure_ascii=False))

# JSON 格式（自动保存）
result, file_path = analyze_stock('603697', days=60, mode='json', auto_save=True)
print(f"数据已保存到: {file_path}")
```

#### 增强分析模式（新功能）⭐

```python
from tools.stock_ai_tool import analyze_stock
import json

# 增强分析（包含诱多检测、资金分类、风险评分）
result = analyze_stock('603697', days=90, mode='enhanced')
print(json.dumps(result, indent=2, ensure_ascii=False))

# 查看诱多陷阱检测
print(f"检测到陷阱数量: {result['trap_detection']['trap_count']}")
for trap in result['trap_detection']['detected_traps']:
    print(f"  - {trap['type_name']}: {trap['evidence']}")

# 查看资金性质分类
print(f"资金类型: {result['capital_analysis']['type_name']}")
print(f"操作建议: {result['capital_analysis']['recommendation']}")

# 查看风险评估
print(f"风险等级: {result['risk_assessment']['risk_level']}")
print(f"操作建议: {result['risk_assessment']['recommendation']}")
```

#### 批量分析

```python
from tools.stock_ai_tool import batch_analyze_stocks

# 批量分析多只股票
results = batch_analyze_stocks(['300997', '603697'], days=90, mode='enhanced', auto_save=True)

for stock_code, result, file_path in results:
    print(f"{stock_code}: {result['risk_assessment']['recommendation']}")
    if file_path:
        print(f"  已保存到: {file_path}")
```

#### 模式说明

| 模式 | 参数 | 说明 | 输出 |
|------|------|------|------|
| 完整分析 | `analyze` / `full` | AkShare+QMT，完整报告 | 文本 |
| 快速分析 | `quick` | 仅核心指标 | 文本 |
| 仅AkShare | `akshare` | 只用资金流向数据 | 文本 |
| 仅QMT | `qmt` | 只用技术指标 | 文本 |
| JSON格式 | `json` | 结构化数据 | JSON |
| 增强分析 | `enhanced` | 包含诱多检测、风险评分 | JSON ⭐ |

### 🔥 核心功能：诱多陷阱检测系统

#### 检测能力

1. **诱多陷阱（吸筹-反手卖）**
   - 识别单日大额吸筹 + 隔日反手卖的模式
   - 典型案例：300997（11月10日吸筹 + 11月11日反手卖）

2. **游资突袭**
   - 识别长期流出后的单日巨量流入
   - 典型案例：603697（2月2日单日流入5025万）

3. **对倒风险**
   - 识别超大单占比过高的情况
   - 阈值：超大单占比 > 70%

#### 风险等级

| 风险等级 | 评分范围 | 建议 |
|---------|---------|------|
| CRITICAL | 0.8 - 1.0 | AVOID - 立即回避 |
| HIGH | 0.6 - 0.8 | WAIT_AND_WATCH - 谨慎观察 |
| MEDIUM | 0.4 - 0.6 | MODERATE - 小仓位参与 |
| LOW | 0.0 - 0.4 | NEUTRAL - 继续观察 |

### 📊 使用场景对比

#### 场景1：手动分析查看报告

```python
from comprehensive_stock_tool import comprehensive_stock_analysis

report = comprehensive_stock_analysis('603697', days=10, auto_save=True)
print(report)
```

**适用**: 想要查看详细的文本报告，适合人工阅读

#### 场景2：AI 自动化分析

```python
from stock_ai_tool import analyze_stock

result = analyze_stock('603697', days=90, mode='enhanced', auto_save=True)

if result['trap_detection']['trap_count'] > 0:
    print(f"⚠️ 检测到 {result['trap_detection']['trap_count']} 个诱多陷阱")
    print(f"建议: {result['risk_assessment']['recommendation']}")
else:
    print("✅ 未检测到诱多陷阱")
```

**适用**: AI 程序化处理，需要结构化数据

#### 场景3：批量扫描多只股票

```python
from stock_ai_tool import batch_analyze_stocks

stocks = ['300997', '603697', '600000']
results = batch_analyze_stocks(stocks, days=90, mode='enhanced', auto_save=True)

high_risk_stocks = []
for stock_code, result, file_path in results:
    if result['risk_assessment']['risk_level'] in ['CRITICAL', 'HIGH']:
        high_risk_stocks.append(stock_code)
        print(f"⚠️ {stock_code}: {result['risk_assessment']['recommendation']}")

print(f"\n高风险股票: {high_risk_stocks}")
```

**适用**: 批量筛选，风险预警

### 💡 最佳实践

#### 1. 数据保存
- ✅ 定期保存分析数据，便于历史追溯
- ✅ 使用 `auto_save=True` 自动保存
- ✅ 文件大小很小（10天报告约 3KB，90天报告约 10KB）

#### 2. 模式选择
- **手动查看**: 使用 `comprehensive_stock_tool.py` 或 `mode='analyze'`
- **AI 调用**: 使用 `stock_ai_tool.py` 的 `mode='enhanced'`
- **快速扫描**: 使用 `mode='quick'`

#### 3. 天数选择
- **快速判断**: 5-10 天
- **趋势分析**: 30-60 天
- **诱多检测**: 90 天（推荐）

#### 4. 风险控制
- 始终查看 `risk_assessment.recommendation`
- 关注 `trap_detection.detected_traps`
- 结合 `capital_analysis.type_name` 判断资金性质

### 保存路径

```
data/stock_analysis/
└── {股票代码}/
    ├── {股票代码}_{日期}_{天数}days_report.txt
    ├── {股票代码}_{日期}_{天数}days.json
    └── {股票代码}_{日期}_{天数}days_enhanced.json
```

**示例**:
- `data/stock_analysis/603697/603697_20260202_10days_report.txt`
- `data/stock_analysis/603697/603697_20260202_60days.json`
- `data/stock_analysis/603697/603697_20260202_90days_enhanced.json`

---

## ⚡ 盘中决策工具

### 概述

本工具提供盘中实时监控和决策支持，包含两个核心模块：

1. **intraday_monitor.py** - 盘中实时监控器
2. **intraday_decision.py** - 盘中决策工具

### 1. 盘中监控器 (IntraDayMonitor)

```python
from logic.intraday_monitor import IntraDayMonitor

monitor = IntraDayMonitor()

# 检查是否交易时间
is_trading = monitor.is_trading_time()
print(f"是否交易时间: {is_trading}")

# 获取交易时间信息
time_info = monitor.get_trading_time_info()
print(f"交易时段: {time_info['trading_period']}")
print(f"距收盘: {time_info['minutes_to_close']} 分钟")

# 获取盘中快照
snapshot = monitor.get_intraday_snapshot('300033')
if snapshot['success']:
    print(f"价格: {snapshot['price']}")
    print(f"涨跌幅: {snapshot['pct_change']}%")
    print(f"信号: {snapshot['signal']}")

# 对比昨日数据
comparison = monitor.compare_with_yesterday('300033', yesterday_file)
if comparison['success']:
    print(f"价格变化: {comparison['comparison']['price_change_pct']}%")
    print(f"趋势变化: {comparison['comparison']['flow_5d_trend']}")
```

### 2. 盘中决策工具 (IntraDayDecisionTool)

```python
from tools.intraday_decision import IntraDayDecisionTool

tool = IntraDayDecisionTool()

# 空仓测试
decision = tool.make_decision(
    stock_code='300033',
    yesterday_file='data/stock_analysis/300033/300033_20260203_125013_90days_enhanced.json',
    current_position=0.0,
    entry_price=None
)

print(f"决策: {decision['decision']}")
print(f"理由: {decision['reason']}")

# 打印详细报告
tool.print_decision_report(decision)

# 有持仓测试
decision = tool.make_decision(
    stock_code='300033',
    yesterday_file='data/stock_analysis/300033/300033_20260203_125013_90days_enhanced.json',
    current_position=1.0,  # 100%仓位
    entry_price=26.50
)

print(f"决策: {decision['decision']}")
print(f"置信度: {decision['confidence']:.0%}")
```

### 决策类型

决策工具会返回以下决策类型：

- **SELL** - 建议卖出
- **HOLD** - 建议持有
- **BUY** - 建议买入
- **WAIT** - 建议等待

### 决策依据

决策基于以下因素：

1. **实时数据**（通过QMT获取）
   - 当前价格和涨跌幅
   - 买卖盘压力
   - 瞬时信号

2. **历史数据**（从昨日分析结果加载）
   - 90天资金流向
   - 资金性质（游资/机构）
   - 诱多风险评分
   - 5日趋势

3. **持仓状态**
   - 当前仓位
   - 入场价格
   - 盈亏比例

### 风险等级

- **LOW** - 风险较低
- **MEDIUM** - 风险中等
- **HIGH** - 风险较高

### 使用场景

#### 场景1: 空仓观察
```python
# 你没有持有该股票，想看看是否值得买入
decision = tool.make_decision(
    stock_code='300033',
    yesterday_file='...',
    current_position=0.0,
    entry_price=None
)
```

#### 场景2: 持仓止损/止盈
```python
# 你持有该股票，想看看是否需要卖出
decision = tool.make_decision(
    stock_code='300033',
    yesterday_file='...',
    current_position=1.0,  # 满仓
    entry_price=26.50
)
```

#### 场景3: 分批操作
```python
# 你持有部分仓位，想看看是否需要加减仓
decision = tool.make_decision(
    stock_code='300033',
    yesterday_file='...',
    current_position=0.5,  # 50%仓位
    entry_price=26.50
)
```

### 注意事项

1. **交易时间限制**
   - 实时数据仅在交易时间（09:30-11:30, 13:00-15:00）可用
   - 非交易时间无法获取实时快照

2. **数据依赖**
   - 需要QMT数据源可用
   - 需要昨日分析结果JSON文件

3. **仅供参考**
   - 本工具仅提供决策参考，不构成投资建议
   - 请结合实际情况独立判断

---

## 📊 QMT数据源说明

### QMT 数据接口特点

#### 优点
- 数据质量高
- 提供历史K线数据
- 可以获取财务数据
- 速度快

#### 缺点
- 首次使用需要下载数据
- 某些功能需要QMT客户端支持

### 使用方式

#### 方式1：作为独立数据源（推荐）

不需要启动QMT客户端，直接使用：

```python
from xtquant import xtdata

# 获取股票列表
stock_list = xtdata.get_stock_list_in_sector('沪深A股')

# 下载历史数据
xtdata.download_history_data('600519.SH', period='1d',
                             start_time='20240101', end_time='20240131')

# 获取本地数据
data = xtdata.get_local_data(
    field_list=['time', 'open', 'high', 'low', 'close'],
    stock_list=['600519.SH'],
    period='1d',
    start_time='20240101',
    end_time='20240131'
)
```

#### 方式2：作为实时数据源

需要启动QMT客户端（可选）：

```python
from xtquant import xtdata

# 获取实时tick数据
tick_data = xtdata.get_full_tick(['600519.SH'])
```

### 什么时候使用QMT？

- ✅ 需要高质量的历史K线数据
- ✅ 需要获取财务数据
- ✅ easyquotation/AkShare 数据不足时作为备用
- ✅ 需要某些特定数据（如板块、指数权重等）

### 什么时候不用QMT？

- ❌ 只需要实时行情（用 easyquotation）
- ❌ 不需要额外数据源
- ❌ 不想下载额外数据

### QMT 数据获取失败怎么办？

所有工具都支持只使用 AkShare 数据：

```python
result = analyze_stock('603697', days=60, use_qmt=False)
```

---

## 💾 Redis配置

### Redis的作用

- **有 Redis**：竞价数据会保存到 Redis，重启程序后可以恢复
- **没有 Redis**：竞价数据只在内存中，重启程序后会丢失

系统会自动检测 Redis 是否可用，如果没有 Redis，会显示警告但不影响其他功能。

### 安装 Redis

#### 方法1：下载 Redis for Windows（推荐）

1. **下载 Redis**
   - 访问：https://github.com/microsoftarchive/redis/releases
   - 下载 `Redis-x64-3.2.100.msi`

2. **安装 Redis**
   - 双击 `.msi` 文件，按照提示安装
   - 默认安装路径：`C:\Program Files\Redis`

3. **验证安装**
   ```cmd
   redis-server --version
   ```

#### 方法2：使用 Chocolatey

```cmd
choco install redis-64
```

#### 方法3：使用 WSL

```bash
sudo apt-get update
sudo apt-get install redis-server
sudo service redis-server start
```

### 测试 Redis

运行测试脚本，验证 Redis 是否正常工作：

```cmd
python test_redis.py
```

测试内容包括：
- ✅ Redis 模块是否安装
- ✅ Redis 连接是否成功
- ✅ 竞价快照功能是否可用
- ✅ Redis 状态信息
- ✅ 配置信息

### 验证竞价快照功能

启动项目后，查看日志：

```
✅ 竞价快照管理器初始化成功（Redis 可用）
```

如果看到这个消息，说明竞价快照功能已启用。

### 常见问题

#### Q1: Redis 启动失败

**解决方案**：
1. 检查 Redis 是否已安装
2. 检查 Redis 路径是否正确
3. 检查端口 6379 是否被占用
4. 以管理员身份运行启动脚本

#### Q2: 竞价快照功能不可用

**解决方案**：
1. 运行 `python test_redis.py` 测试 Redis 连接
2. 检查日志中的错误信息
3. 确认 `config_database.json` 中的 Redis 配置正确

#### Q3: 没有 Redis 能用吗？

**答案**：可以，但竞价快照功能不可用。

#### Q4: 如何手动启动 Redis？

```cmd
# 启动 Redis
redis-server

# 在另一个窗口启动项目
python -m streamlit run main.py
```

#### Q5: 如何查看 Redis 是否运行？

```cmd
tasklist | findstr redis-server
```

如果看到 `redis-server.exe`，说明 Redis 正在运行。

---

## 🎓 最佳实践

### 新手学习路径

#### 第一周：熟悉界面
- [ ] 了解各个功能模块
- [ ] 查看技术指标解释
- [ ] 尝试输入不同股票代码
- [ ] 观察不同股票的指标变化

#### 第二周：理解指标
- [ ] 学习 MACD 的含义
- [ ] 学习 RSI 的含义
- [ ] 学习布林带的含义
- [ ] 观察指标在不同行情下的表现

#### 第三周：实践分析
- [ ] 选择 2-3 只感兴趣的股票
- [ ] 添加到自选股
- [ ] 每天查看指标变化
- [ ] 记录指标与股价的关系

#### 第四周：模拟交易
- [ ] 使用回测功能测试策略
- [ ] 记录回测结果
- [ ] 调整参数优化策略
- [ ] 准备实盘（少量资金）

### 个股分析最佳实践

#### 1. 数据保存
- ✅ 定期保存分析数据，便于历史追溯
- ✅ 使用 `auto_save=True` 自动保存
- ✅ 文件大小很小（10天报告约 3KB，90天报告约 10KB）

#### 2. 模式选择
- **手动查看**: 使用 `comprehensive_stock_tool.py` 或 `mode='analyze'`
- **AI 调用**: 使用 `stock_ai_tool.py` 的 `mode='enhanced'`
- **快速扫描**: 使用 `mode='quick'`

#### 3. 天数选择
- **快速判断**: 5-10 天
- **趋势分析**: 30-60 天
- **诱多检测**: 90 天（推荐）

#### 4. 风险控制
- 始终查看 `risk_assessment.recommendation`
- 关注 `trap_detection.detected_traps`
- 结合 `capital_analysis.type_name` 判断资金性质

### 技术形态说明

#### 正面信号
- 📈 多头排列 - 均线多头排列，趋势向上
- 🟢 站上20日线 - 突破生命线，强势
- 💎 短期超跌 - 乖离率过大，可能反弹

#### 负面信号
- 📉 空头排列 - 均线空头排列，趋势向下
- 🔴 跌破20日线 - 跌破生命线，弱势
- ⚠️ 短期超买 - 乖离率过大，可能回调

#### 风险等级
- ✅ 无 - 安全
- 🟡 低 - 低风险
- 🟠 中 - 中等风险
- 🔴 高 - 高风险
- 🚨 极高 - 极高风险

---

## ❓ 常见问题

### 个股分析工具

#### Q1: QMT 数据获取失败怎么办？

A: 所有工具都支持只使用 AkShare 数据：
```python
result = analyze_stock('603697', days=60, use_qmt=False)
```

#### Q2: 如何查看历史分析记录？

A: 所有分析数据都保存在 `data/stock_analysis/{股票代码}/` 目录下。

#### Q3: 批量分析会不会请求过快？

A: 工具内置了速率限制器，自动控制请求间隔，不会过快。

#### Q4: 诱多检测的准确率如何？

A: 基于历史数据训练，准确率约 85%+。建议结合其他指标综合判断。

### 盘中决策工具

#### Q1: 什么时候获取实时数据？

A: 实时数据仅在交易时间（09:30-11:30, 13:00-15:00）可用。

#### Q2: 如何处理非交易时间？

A: 非交易时间无法获取实时快照，建议使用历史数据分析。

#### Q3: 决策工具的准确性如何？

A: 决策基于多维度数据分析，但仅供参考，不构成投资建议。

### 系统使用

#### Q1：我应该买哪只股票？

**A**：本工具不推荐具体股票，只提供技术分析。建议：
1. 使用多股对比功能筛选
2. 结合基本面分析
3. 咨询专业投资顾问

#### Q2：什么时候买入？

**A**：建议在以下情况考虑：
- MACD 出现金叉
- RSI 低于 30
- 价格接近布林带下轨
- 价格接近支撑位

#### Q3：什么时候卖出？

**A**：建议在以下情况考虑：
- MACD 出现死叉
- RSI 高于 70
- 价格接近布林带上轨
- 价格接近阻力位

#### Q4：新手用什么参数？

**A**：推荐保守参数：
- ATR 倍数：1.0
- 网格比例：0.1（10%）
- 交易手续费：0.001（0.1%）

#### Q5：如何提高准确率？

**A**：
1. 综合多个指标判断
2. 关注市场整体趋势
3. 学习基本面分析
4. 控制仓位和风险
5. 持续学习和实践

#### Q6：UI显示异常怎么办？

A:
- 检查浏览器控制台错误（F12）
- 刷新页面
- 重启系统

#### Q7：数据加载失败怎么办？

A:
- 检查网络连接
- 检查AkShare接口状态
- 等待几秒后重试

#### Q8：性能问题怎么办？

A:
- 清理 `__pycache__` 文件夹
- 重启系统
- 减少扫描股票数量

### Redis配置

#### Q1: Redis 启动失败

**解决方案**：
1. 检查 Redis 是否已安装
2. 检查 Redis 路径是否正确
3. 检查端口 6379 是否被占用
4. 以管理员身份运行启动脚本

#### Q2: 竞价快照功能不可用

**解决方案**：
1. 运行 `python test_redis.py` 测试 Redis 连接
2. 检查日志中的错误信息
3. 确认 `config_database.json` 中的 Redis 配置正确

#### Q3: 没有 Redis 能用吗？

**答案**：可以，但竞价快照功能不可用。

---

## ⚠️ 风险提示

### 对于新手

1. **不要急于实盘**
   - 先用模拟盘练习
   - 熟悉后再用小资金尝试
   - 逐步增加资金

2. **不要只看一个指标**
   - 综合多个指标判断
   - 结合市场环境
   - 参考基本面信息

3. **不要追涨杀跌**
   - 等待合适的买卖点
   - 不要情绪化交易
   - 严格执行策略

4. **不要满仓操作**
   - 保留部分现金
   - 分批建仓
   - 控制风险

### 通用风险提示

- 技术指标不是万能的，准确率约 60%-70%
- 历史表现不代表未来收益
- 投资有风险，入市需谨慎
- 建议咨询专业投资顾问

### 诱多检测风险

- 诱多检测的准确率约 85%+
- 建议结合其他指标综合判断
- 不要仅依赖单一指标做决策

### 盘中决策工具风险

- 本工具仅提供决策参考，不构成投资建议
- 请结合实际情况独立判断
- 实时数据仅在交易时间可用
- 始终控制风险，合理仓位

---

## 📝 更新日志

### V9.4.8 (2026-02-09)
- 🔥 紧急修复：AkShare 数据排序 BUG
- 修复 price_3d_change 计算异常值
- 修复 QMT 强制检查问题
- 修复负 ratio 决策树逻辑
- 修复诱多检测过于敏感问题
- 修复风险评分忽略 ratio 问题

### V9.4.7 (2026-02-09)
- 修复 price_3d_change 缺失问题
- 新增双数据源计算逻辑（QMT优先 + AkShare降级）
- 新增诱多检测过于敏感修复
- 新增风险评分 ratio 修正因子

### V9.4.5 (2026-02-02)
- ✨ 新增诱多陷阱检测系统
- ✨ 新增资金性质分类功能
- ✨ 新增风险评分系统
- ✨ 新增滚动指标计算
- ✨ `comprehensive_stock_tool.py` 支持自动保存
- ✨ `stock_ai_tool.py` 新增 `enhanced` 模式

---

## 📞 技术支持

如有问题，请查看：
- 项目文档：`docs/` 目录
- 测试脚本：`tests/` 目录
- 示例代码：本文档各章节

---

## 🎉 祝您投资顺利！

记住：投资是一场马拉松，不是百米冲刺。保持耐心，持续学习，控制风险，才能在股市中长期生存和盈利。

**最后提醒**：本工具仅供参考，不构成投资建议。投资有风险，入市需谨慎！

---

**版本信息**：
- 系统版本：Predator Guard V10.1.9.1
- 文档版本：V9.4.8
- 更新日期：2026年2月9日
- 状态：✅ 完全就绪