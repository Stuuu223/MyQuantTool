# 研究线执行计划 - CTO定调版

**日期**: 2026-02-20  
**状态**: 整改验收通过，进入样本扩充阶段  
**红线**: 实盘strategy_params.json保持冻结

---

## 一、CTO决策摘要

### 1.1 已过关（可继续推进）
- ✅ Pipeline幂等性验证通过
- ✅ DataService统一数据访问
- ✅ 标签格式标准化（只存代码/日期/类型）
- ✅ 淳中科技等异常样本标记为verified=false并剔除

### 1.2 未过关（必须补完）
- ⏳ 旧脚本未全面收口（run_16stocks_replay.py等仍在直接访问数据）
- ⏳ 样本选择逻辑需优化（先确认Tick存在再贴标签）
- ⏳ ratio计算未整合进pipeline

### 1.3 下阶段目标
- 目标样本量: **30-40条verified=true案例**
- 时间窗口: **2026-01-01之后**（Tick数据充足）
- 覆盖分层: 高频+中频+低频

---

## 二、样本扩充计划

### 2.1 高频层补充（当前4只→目标8只）

**已验证（4只）**:
- 航天发展(000547): 4个案例 ✅
- 蓝色光标(300058): 2个案例 ✅  
- 平潭发展(000592): 2个案例 ✅
- 网宿科技(300017): 2个案例 ✅

**待补充（4只）**:
| 代码 | 名称 | 状态 | 行动 |
|------|------|------|------|
| 002792 | 通宇通讯 | 12月数据缺失 | 改为2026-01后日期 |
| 603778 | 国晟科技 | 12月数据缺失 | 改为2026-01后日期 |
| 301005 | 超捷股份 | 12月数据缺失 | 改为2026-01后日期 |
| 603516 | 淳中科技 | 除权异常 | 暂时剔除/等待修复 |

**补充策略**:
- 每只票找2个真起爆日 + 2个骗炮日
- 先通过DataService.verify_tick_exists()确认数据存在
- 再写入labels_v2

### 2.2 低频层补充（当前1只→目标3只）

**已验证（1只）**:
- 网宿科技(300017): 2个案例 ✅

**候选补充（2只）**:
- 永辉超市(601933): Tick数据待确认
- 岩山科技(002195): Tick数据待确认

**标准**:
- 选择"偶尔爆一次的大哥"
- 每只2-3个典型日
- 必须是2026年案例

### 2.3 中频层（视情况补充）

**候选**:
- 信维通信(300136)
- 利欧股份(002131)
- 浙文互联(600986)

**优先级**: 低频层补充完后视情况决定

---

## 三、技术整合计划

### 3.1 ratio计算整合进pipeline

**当前状态**:
- calculate_ratio_metrics.py 独立运行
- 从raw CSV计算ratio

**目标状态**:
```
run_research_pipeline.py
├── 步骤1: Tick回放 → 生成_raw.csv
├── 步骤2: ratio计算 → 生成_ratio.csv
├── 步骤3: 汇总统计 → 生成_summary.csv
└── 步骤4: 日志记录 → 生成.log
```

**实现方式**:
- 在pipeline内部调用RollingFlowCalculator
- 实时计算ratio，不依赖外部脚本
- 确保raw和ratio数据一致性

### 3.2 旧脚本清理

**待清理脚本**:
- [ ] tools/run_16stocks_replay.py
- [ ] tools/run_batch_wanzhu_replay.py  
- [ ] tools/run_single_wanzhu_replay.py
- [ ] tools/auto_select_cases.py（整合进pipeline）

**清理标准**:
- 所有数据访问必须通过DataService
- 所有路径必须通过config/data_paths.json
- 禁止直接xtdata.get_local_data调用

---

## 四、质量门禁

### 4.1 样本准入标准（必须全部满足）

1. **时间窗口**: 2026-01-01之后
2. **数据存在**: DataService.verify_tick_exists()返回True
3. **标签正确**: 
   - 真起爆: 当日涨幅>=7%且后续30分钟回撤<3%
   - 骗炮: 当日盘中>=7%但收盘<3%或回落>4%
4. **无除权异常**: preClose价格合理（排除淳中科技式跳变）
5. **手动确认**: 研究员肉眼确认"这确实是我心中的真起爆/骗炮"

### 4.2 verified标签管理

```json
{
  "verified": true,      // 满足全部标准，可进统计
  "verified": false,     // 存疑/异常，剔除统计
  "note": "除权异常"     // 说明原因
}
```

---

## 五、里程碑检查点

### 阶段1: 样本扩充（预计3-5天）
- [ ] 高频层补充至8只（每只2真2反）
- [ ] 低频层补充至3只
- [ ] 总verified案例数达到30-40条

### 阶段2: 技术整合（预计2-3天）
- [ ] ratio计算整合进pipeline
- [ ] 旧脚本全面清理
- [ ] 全仓库DataService收口

### 阶段3: 阈值验证（预计2-3天）
- [ ] 基于30+案例重新计算ratio分布
- [ ] 验证threshold=15/12/1.2的稳健性
- [ ] 分层统计高频/中频/低频差异

### 阶段4: 回测验证（待定）
- [ ] 历史多标的回测
- [ ] 行为回放验证
- [ ] 通过后方可考虑更新strategy_params.json

---

## 六、团队自检清单（每日必问）

**写新脚本前**:
1. 我是不是绕过了DataService/pipeline？
2. 我是不是硬编码了任何路径？

**贴新标签前**:
1. 这只票这个时间点的Tick数据真的存在吗？
2. 这个日期在2026-01-01之后吗？
3. 我肉眼确认过这是真起爆/骗炮吗？

**提交结果前**:
1. 如果下个月要重现这次结果，只用看一个配置文件和跑一个命令就够了吗？
2. 所有verified=true的案例都满足门禁标准吗？

---

## 七、风险与对策

| 风险 | 对策 |
|------|------|
| QMT Tick数据不完整 | 时间窗口固定在2026-01后，先verify再贴标签 |
| 除权除息导致价格异常 | 标记verified=false，剔除统计，单独记录 |
| 旧脚本未清理导致数据不一致 | 全面grep检查，强制收口DataService |
| 样本量不足导致阈值不稳健 | 坚持30-40条门槛，不够就继续补 |

---

**记录人**: AI项目总监  
**审核状态**: 待CTO确认  
**下次同步**: 样本扩充至30条时
