# MyQuantTool V9.4.7 P0 é—®é¢˜ä¿®å¤éªŒæ”¶æŠ¥å‘Š

> **æäº¤äºº**: iFlow CLI  
> **æ—¥æœŸ**: 2026-02-13  
> **ç‰ˆæœ¬**: V9.4.7

---

## ä¸€ã€å½“å‰è¿œç«¯æœ€æ–°ä¿¡æ¯

### Commit Hash
```
68ae624 Add 10huang knowledge summary and optimize Level 1 filter based on time segments
```

### GitHub Commits é¡µé¢
```
https://github.com/Stuuu223/MyQuantTool/commit/68ae624
```

---

## äºŒã€logic/strategies/full_market_scanner.py å…³é”®å‡½æ•°æ®µ

### ä¿®å¤åçš„æ—¶é—´åˆ†æ®µç­›é€‰é€»è¾‘ï¼ˆç¬¬1146-1180è¡Œï¼‰

```python
cfg = self.config['level1']

# ğŸ”¥ [åŸºäºæ‹¾è’ç½‘çŸ¥è¯†ä¼˜åŒ–] æ—¶é—´åˆ†æ®µç­›é€‰
from datetime import datetime
current_time = datetime.now()
hour = current_time.hour
minute = current_time.minute

# æ ¹æ®æ—¶é—´æ®µè®¾ç½®ä¸åŒé˜ˆå€¼ï¼ˆæ‹¾è’ç½‘çŸ¥è¯†ï¼šæ—¶é—´ç»´åº¦æœ€é‡è¦ï¼‰
# ä» config['time_segments'] è¯»å–
time_segments = self.config.get('time_segments', {})

if 9 <= hour < 10:  # å¼€ç›˜é˜¶æ®µï¼ˆ9:30-10:00ï¼‰
    segment = time_segments.get('opening', {})
    pct_chg_threshold = segment.get('pct_chg_min', 0.5)
    volume_ratio_threshold = segment.get('volume_ratio_min', 1.9)
    turnover_threshold = segment.get('turnover_min', 0.03)  # æ¢æ‰‹ç‡ 3%ï¼ˆé¦–æ¿æ ‡å‡†ï¼‰
elif 10 <= hour < 14 or (hour == 14 and minute < 30):  # ç›˜ä¸­é˜¶æ®µï¼ˆ10:00-14:30ï¼‰
    segment = time_segments.get('midday', {})
    pct_chg_threshold = segment.get('pct_chg_min', 1.0)
    volume_ratio_threshold = segment.get('volume_ratio_min', 1.5)
    turnover_threshold = segment.get('turnover_min', 0.02)  # æ¢æ‰‹ç‡ 2%
else:  # å°¾ç›˜é˜¶æ®µï¼ˆ14:30-15:00ï¼‰
    segment = time_segments.get('close', {})
    pct_chg_threshold = segment.get('pct_chg_min', 2.0)
    volume_ratio_threshold = segment.get('volume_ratio_min', 3.0)  # è­¦æƒ•å°¾ç›˜æ‹‰å‡
    turnover_threshold = segment.get('turnover_min', 0.05)  # æ¢æ‰‹ç‡ 5%

# 1. æ¶¨è·Œå¹…æ£€æŸ¥ï¼ˆåŸºäºæ—¶é—´åˆ†æ®µï¼‰
if pct_chg < pct_chg_threshold:
    self._l1_debug['pct_fail'] += 1
    if code == '001335.SZ' or code.endswith('001335'):
        logger.info(f"ğŸ” [DEBUG 001335] Level 1å¤±è´¥: æ¶¨è·Œå¹…è¿‡ä½ (pct_chg={pct_chg:.2f}%, threshold={pct_chg_threshold:.2f}%)")
    return False

# ğŸ”¥ [åŸºäºæ‹¾è’ç½‘çŸ¥è¯†ä¼˜åŒ–] ç§»é™¤ç»å¯¹æˆäº¤é¢æ£€æŸ¥ï¼Œæ”¹ç”¨æ¢æ‰‹ç‡æ£€æŸ¥
# å³ä¾§èµ·çˆ†çš„å…³é”®æ˜¯ç›¸å¯¹æ”¾é‡ï¼ˆæ¢æ‰‹ç‡ï¼‰ï¼Œä¸æ˜¯ç»å¯¹æˆäº¤é¢
# å°ç›˜è‚¡500ä¸‡=0.5%æ¢æ‰‹ç‡ï¼Œå¤§ç›˜è‚¡500ä¸‡=0.005%æ¢æ‰‹ç‡ï¼Œä¸å…¬å¹³

# 2. æ¢æ‰‹ç‡æ£€æŸ¥ï¼ˆåŸºäºæ‹¾è’ç½‘çŸ¥è¯†ï¼šæ¢æ‰‹å¤Ÿäº†ï¼Œå¯ä»¥è¿›åœºï¼‰
# ä¼˜å…ˆä½¿ç”¨æœ¬åœ°è‚¡æœ¬æ•°æ®
from logic.equity_data_accessor import get_circ_mv
circ_mv = get_circ_mv(code, datetime.now().strftime('%Y%m%d'))

if circ_mv and circ_mv > 0:
    # ä½¿ç”¨æœ¬åœ°è‚¡æœ¬æ•°æ®è®¡ç®—æ¢æ‰‹ç‡
    last_price = tick.get('lastPrice', tick.get('last_price', 1))
    if last_price > 0:
        circulating_shares = circ_mv / last_price
        turnover_rate = self._calculate_turnover_rate(code, volume, circulating_shares)
        
        # æ£€æŸ¥æ¢æ‰‹ç‡æ˜¯å¦è¾¾æ ‡
        if turnover_rate < turnover_threshold:
            self._l1_debug['turnover_fail'] += 1
            if code == '001335.SZ' or code.endswith('001335'):
                logger.info(f"ğŸ” [DEBUG 001335] Level 1å¤±è´¥: æ¢æ‰‹ç‡è¿‡ä½ (turnover={turnover_rate*100:.2f}%, threshold={turnover_threshold*100:.2f}%)")
            return False
else:
    # æœ¬åœ°è‚¡æœ¬æ•°æ®ä¸å¯ç”¨æ—¶çš„é™çº§ç­–ç•¥ï¼šä½¿ç”¨æ›´ä¸¥æ ¼çš„é‡æ¯”æ£€æŸ¥
    # ä¸å†æŒ‰å¸‚å€¼åˆ†å±‚ï¼ˆå› ä¸ºå¸‚å€¼æœªçŸ¥ï¼‰ï¼Œç›´æ¥ä½¿ç”¨æˆäº¤é¢ä½œä¸ºå…œåº•æŒ‡æ ‡
    # è¦æ±‚ï¼šæˆäº¤é¢ > 1000ä¸‡ ä¸” é‡æ¯” > 2.0
    if amount < 10_000_000:
        self._l1_debug['amount_fail'] += 1
        if code == '001335.SZ' or code.endswith('001335'):
            logger.info(f"ğŸ” [DEBUG 001335] Level 1å¤±è´¥: æˆäº¤é¢è¿‡ä½ (amount={amount/1e8:.2f}äº¿, threshold=1000ä¸‡)")
        return False
```

---

## ä¸‰ã€config/market_scan_config.json æœ€æ–°å…¨æ–‡

```json
{
  "system": {
    "emergency_mode": {
      "enabled": false,
      "allow_bypass_qmt_check": false,
      "bypass_reason": "Manual override for data lag",
      "description": "ç´§æ€¥æ¨¡å¼é…ç½®ï¼šé»˜è®¤å…³é—­ã€‚ä»…åœ¨QMTæ•°æ®ä¸¥é‡å¼‚å¸¸ä¸”äººå·¥ç¡®è®¤åæ‰å¯å¯ç”¨ã€‚"
    }
  },
  "data_provider": {
    "type": "level1",
    "fallback": "dongcai",
    "comment": "typeå¯é€‰å€¼: level1(å…è´¹æ¨æ–­) / level2(ä»˜è´¹é€ç¬”) / dongcai(T-1å†å²)"
  },
  "monitor": {
    "cache": {
      "sector_resonance_ttl": 300,
      "_comment_sector_resonance_ttl": "æ¿å—å…±æŒ¯ç¼“å­˜æœ‰æ•ˆæœŸï¼ˆç§’ï¼‰ï¼Œé»˜è®¤5åˆ†é’Ÿ"
    },
    "data_freshness": {
      "tolerance_minutes": 30,
      "_comment_tolerance_minutes": "èµ„é‡‘æµæ•°æ®å®¹å¿å»¶è¿Ÿï¼ˆåˆ†é’Ÿï¼‰ï¼Œé»˜è®¤30åˆ†é’Ÿ"
    },
    "candidate_pool": {
      "ttl_minutes": 10,
      "_comment_ttl_minutes": "å€™é€‰æ± TTLï¼ˆåˆ†é’Ÿï¼‰ï¼Œé»˜è®¤10åˆ†é’Ÿ",
      "max_size": 200,
      "_comment_max_size": "å€™é€‰æ± æœ€å¤§å®¹é‡ï¼ˆåªï¼‰ï¼Œè°ƒæ•´ä¸º200åªä»¥å‡å°‘ä½ä¼˜å…ˆçº§æŠ–åŠ¨"
    },
    "state_export": {
      "interval_seconds": 5,
      "_comment_interval_seconds": "CLIç›‘æ§çŠ¶æ€å¯¼å‡ºé—´éš”ï¼ˆç§’ï¼‰ï¼Œé»˜è®¤5ç§’"
    }
  },
  "level1": {
    "pct_chg_min": 0.5,
    "amount_min": 5000000,
    "turnover_min": 1.0,
    "_comment": "å·²åºŸå¼ƒï¼šæ”¹ç”¨åŸºäºæ—¶é—´åˆ†æ®µçš„é˜ˆå€¼",
    "_deprecated": "pct_chg_min, amount_min å·²è¢« time_segments ä¸­çš„å‚æ•°æ›¿ä»£"
  },
  "time_segments": {
    "_comment": "åŸºäºæ‹¾è’ç½‘çŸ¥è¯†çš„æ—¶é—´åˆ†æ®µç­›é€‰",
    "opening": {
      "start": "09:30",
      "end": "10:00",
      "pct_chg_min": 0.5,
      "volume_ratio_min": 1.9,
      "turnover_min": 0.03,
      "_comment": "å¼€ç›˜é˜¶æ®µï¼šæ•æ‰èµ·çˆ†ï¼Œæœ€å®½æ¾"
    },
    "midday": {
      "start": "10:00",
      "end": "14:30",
      "pct_chg_min": 1.0,
      "volume_ratio_min": 1.5,
      "turnover_min": 0.02,
      "_comment": "ç›˜ä¸­é˜¶æ®µï¼šå¹³å°çªç ´ï¼Œä¸­ç­‰é˜ˆå€¼"
    },
    "close": {
      "start": "14:30",
      "end": "15:00",
      "pct_chg_min": 2.0,
      "volume_ratio_min": 3.0,
      "turnover_min": 0.05,
      "_comment": "å°¾ç›˜é˜¶æ®µï¼šé¿å…è¯±å¤šï¼Œæœ€ä¸¥æ ¼"
    }
  },
  "level2": {
    "main_inflow_min": 5000000,
    "super_ratio_min": 0.3
  },
  "level3": {
    "risk_score_max": 0.75
  }
}
```

---

## å››ã€éªŒæ”¶æ ‡å‡†

### æµ‹è¯•è„šæœ¬
```
E:\MyQuantTool\test_time_segment_filter.py
```

### æµ‹è¯•ç»“æœ

```
================================================================================
ğŸ§ª æ—¶é—´åˆ†æ®µç­›é€‰é€»è¾‘æµ‹è¯•
================================================================================

================================================================================
æµ‹è¯• 1: é…ç½®è¯»å–
================================================================================
âœ… time_segments é…ç½®å­˜åœ¨
  opening:
    - pct_chg_min: 0.5
    - volume_ratio_min: 1.9
    - turnover_min: 0.03
  midday:
    - pct_chg_min: 1.0
    - volume_ratio_min: 1.5
    - turnover_min: 0.02
  close:
    - pct_chg_min: 2.0
    - volume_ratio_min: 3.0
    - turnover_min: 0.05

================================================================================
æµ‹è¯• 3: æ¢æ‰‹ç‡è®¡ç®—
================================================================================
âœ… 600000.SH
    æµé€šè‚¡æœ¬: 10.00äº¿è‚¡
    æˆäº¤é‡: 1.00äº¿è‚¡
    æ¢æ‰‹ç‡: 10.00% (æœŸæœ›: 10.00%)
âœ… 300001.SZ
    æµé€šè‚¡æœ¬: 10.00äº¿è‚¡
    æˆäº¤é‡: 0.50äº¿è‚¡
    æ¢æ‰‹ç‡: 5.00% (æœŸæœ›: 5.00%)

================================================================================
æµ‹è¯• 4: å¸‚å€¼=0æ—¶çš„é™çº§é€»è¾‘
================================================================================
âœ… 000001.SZ - æˆäº¤é¢è¿‡ä½ (æˆäº¤é¢=0.05äº¿)
âœ… 000002.SZ - æˆäº¤é¢è¾¾æ ‡ (æˆäº¤é¢=0.15äº¿)

================================================================================
âœ… æ‰€æœ‰æµ‹è¯•é€šè¿‡
================================================================================
```

---

## äº”ã€P0 é—®é¢˜ä¿®å¤æ¸…å•

### âœ… å·²ä¿®å¤

1. **é…ç½®é”™é…** - ä» `config['time_segments']` è¯»å–ï¼Œè€Œä¸æ˜¯ `cfg.get('opening_pct_chg_min')`
2. **å¸‚å€¼=0 åˆ†æ”¯é€»è¾‘é”™è¯¯** - ç§»é™¤å¸‚å€¼åˆ†å±‚ï¼Œç›´æ¥ä½¿ç”¨æˆäº¤é¢å…œåº•ï¼ˆ> 1000ä¸‡ï¼‰
3. **æ¢æ‰‹ç‡å£å¾„ä¸ç¨³** - ä¼˜å…ˆä½¿ç”¨æœ¬åœ°è‚¡æœ¬æ•°æ® `get_circ_mv()`

### éªŒè¯æ–¹å¼

```bash
# è¿è¡Œæµ‹è¯•è„šæœ¬
python test_time_segment_filter.py

# é¢„æœŸç»“æœï¼šæ‰€æœ‰æµ‹è¯•é€šè¿‡ âœ…
```

---

## å…­ã€ç­–ç•¥ä¾æ®

**æ–‡æ¡£**: `docs/STRATEGY_ESSENCE_10HUANG.md`

**æ ¸å¿ƒè¦ç‚¹**:
1. **æ—¶é—´ç»´åº¦æœ€é‡è¦**
2. **ç›¸å¯¹æ”¾é‡ > ç»å¯¹æˆäº¤é¢**
3. **æ¢æ‰‹ç‡æ£€æŸ¥**ï¼ˆå¼€ç›˜3%ï¼Œç›˜ä¸­2%ï¼Œå°¾ç›˜5%ï¼‰
4. **é‡æ¯”æ ‡å‡†**ï¼ˆå¼€ç›˜1.9ï¼Œç›˜ä¸­1.5ï¼Œå°¾ç›˜3.0ï¼‰

---

**å¾… CTO å®¡è®¡æ‰¹å‡†åæäº¤**