# 顽主票右侧起爆研究日志

**日期**: 2026-02-20  
**研究阶段**: Stage 1 - 小样本验证  
**负责人**: AI项目总监  
**状态**: 进行中

---

## 一、今日核心发现

### 1.1 Ratio阈值验证（关键突破）

**问题**: 传统"魔法数字"阈值（如35M）无法适应不同市值股票  
**解决方案**: 采用无量纲化Ratio指标

**验证结果**（基于24个案例）:

| 指标 | 真起爆(13个) | 骗炮(11个) | 差异 |
|------|-------------|-----------|------|
| max_ratio_stock | 21.45 (中位数16.62) | 13.72 (中位数11.01) | **+56%** |
| max_ratio_day | 19.15 (中位数13.57) | 11.72 (中位数10.40) | **+63%** |
| mean_sustain_ratio | 26.39 | 15.08 | +75% |

**核心洞察**:
- max_ratio_stock > 15 可覆盖77%的真起爆案例
- 真起爆的资金爆发力（相对自身历史）是骗炮的1.5-2倍

### 1.2 自适应阈值公式（CTO拍板）

```python
if (flow_5min_ratio_stock > 15 and      # 比自身历史中位数高15倍
    flow_5min_ratio_day > 12 and         # 在当日属于前8%爆发  
    sustain_ratio > 1.2):                # 15分钟流/5分钟流 > 1.2
    trigger_signal = True  # 真起爆概率高
```

---

## 二、样本验证进展

### 2.1 高频层8只（已完成）

| 股票 | 真起爆案例 | 骗炮案例 | 状态 |
|------|-----------|---------|------|
| 航天发展(000547) | 2个 | 2个 | ✅ 完成 |
| 蓝色光标(300058) | 2个 | 1个 | ✅ 完成 |
| 平潭发展(000592) | 1个 | 1个 | ✅ 完成 |
| 通宇通讯(002792) | 2个 | 2个 | ✅ 完成 |
| 国晟科技(603778) | 1个 | 2个 | ✅ 完成 |
| 超捷股份(301005) | 2个 | 1个 | ✅ 完成 |
| 淳中科技(603516) | 2个 | 2个 | ⚠️ 需修正昨收计算 |

**注**: 淳中科技部分案例涨幅异常（>400%），需重新校准昨收价

### 2.2 典型正反例对比

**网宿科技（最佳正反例）**:
- 真起爆(2026-01-26): max_ratio_stock=57.80, 涨幅+18.18%
- 骗炮(2026-02-13): max_ratio_stock=14.91, 涨幅+0.04%
- **差异**: 4.2倍

---

## 三、技术债务与整改

### 3.1 数据路径混乱（已整改）

**问题**: 反复查询QMT数据路径，混淆不同目录  
**整改措施**:
1. 创建 `config/data_paths.json` 统一记录
2. 创建 `logic/utils/data_path_resolver.py` 统一工具

**QMT数据路径**（唯一正确路径）:
```
E:\qmt\userdata_mini\datadir
├── sz/0/    # 深圳市场，133只股票
└── sh/0/    # 上海市场，16只股票
```

**文件命名规则**:
- tick文件: `{code}` （无扩展名，如 `300017`）
- 代码格式: `{code}.SZ` 或 `{code}.SH`

### 3.2 涨幅计算错误（已修正）

**问题**: 使用开盘价计算涨幅，而非昨收价  
**修正**: 所有涨幅计算必须使用 `pre_close` 作为基准

```python
# 错误
true_change = (price - open_price) / open_price

# 正确  
true_change = (price - pre_close) / pre_close
```

---

## 四、待解决问题

### 4.1 数据质量问题

- [ ] 淳中科技等案例昨收价校准
- [ ] 检查是否存在其他涨幅异常案例
- [ ] 完善昨收价自动获取机制（当前部分硬编码）

### 4.2 样本补充

- [ ] 中频层5只（信维通信、利欧股份等）
- [ ] 低频层3只（永辉超市数据缺失、岩山科技）
- [ ] 目标: 总计40-50个干净案例

### 4.3 策略集成

- [ ] 将Ratio阈值集成到HalfwayV2
- [ ] 替换原有魔法数字阈值
- [ ] 生成 `config/strategy_params.json`

---

## 五、关键文件清单

**研究脚本**:
- `tools/run_16stocks_replay.py` - 16只票批量回测
- `tools/calculate_ratio_metrics.py` - Ratio指标计算
- `tools/auto_select_cases.py` - 自动筛选正反例日期

**数据输出**:
- `data/wanzhu_data/samples/` - 原始资金画像（24个CSV）
- `data/wanzhu_data/samples_ratio/` - Ratio化数据
- `data/wanzhu_data/research_sample_config.json` - 样本配置

**配置与工具**:
- `config/data_paths.json` - QMT数据路径配置
- `logic/utils/data_path_resolver.py` - 路径解析工具
- `logic/rolling_metrics.py` - 多周期资金流计算

---

## 六、下一步计划

### 6.1 短期（1-2天）

1. 修正淳中科技等案例的昨收价计算
2. 清洗现有24个案例，剔除异常数据
3. 基于清洗后数据更新Ratio阈值

### 6.2 中期（3-5天）

1. 补充中频/低频层案例至40-50个
2. 分层统计高频/中频/低频的Ratio差异
3. 验证阈值在不同层级上的泛化性

### 6.3 长期（1-2周）

1. 将自适应阈值集成到策略服务
2. 生成可热加载的配置文件
3. 开始反哺实盘参数优化

---

## 七、重要结论

1. **Ratio化是正确方向**: 消除了市值差异，适应不同股票
2. **阈值初定**: ratio_stock>15, ratio_day>12, sustain>1.2
3. **数据路径已标准化**: 后续不再混淆
4. **当前处于**: 工具验证完成 → 深度研究起步阶段

---

**记录人**: AI项目总监  
**审核人**: 待CTO审核  
**下次更新**: 2026-02-21
