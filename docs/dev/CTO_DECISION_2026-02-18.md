# CTO 决策备忘录 - 2026-02-18

角色说明
- 本备忘录是对近期网宿/顽主/V12.1.0/Tick 链路相关讨论的 CTO 级决策总结。
- 团队报告只作参考，以本文件为最终执行依据。

---

## 1. V12.1.0 过滤器

### 1.1 顽主/网宿实验线

- backtest/t1_tick_backtester.py 中的 V12.1.0 三大过滤器（板块共振 / 动态阈值 / 竞价校验）标记为 EXPERIMENTAL。
- `self.enable_filters` 默认值必须为 `False`。
- 在以下场景中禁止启用：
  - 顽主榜单相关回测与实验；
  - 网宿等典型个股的 tick 回放实验。

### 1.2 未来处理

- 任意对 V12.1.0 过滤器的改动，只允许在独立实验脚本中进行。
- 在有明确回测证据证明其优于现有版本前，不得重新启用为默认过滤器。

---

## 2. Tick 数据链路

### 2.1 统一 Provider

- Tick 数据获取必须通过统一 Provider（后续文件名建议：`logic/data_providers/tick_provider.py`）。
- 新增代码禁止出现以下用法：
  - `from xtquant import xtdata`
  - `from xtquant import xtdatacenter as xtdc`
  - 直接访问 `QMT_DATA_DIR/datadir/...` 目录。

### 2.2 迁移策略

- 迁移优先级：
  1. 顽主相关：`scripts/download_wanzhu_tick_data.py` + 回测使用的 Tick 入口。
  2. 网宿 / 顽主实验中用到的 tick 回放脚本。
- TickProvider 最低要求：
  - 负责 xtdatacenter 初始化、Token、数据目录、listen 端口。
  - 提供 `ensure_history(code, start, end)` 与 `load_ticks(code, start, end)` 两个基础接口。
  - 能返回单票的可用 tick 日期范围（区分录制 vs 回灌）。

---

## 3. 硬编码阈值审计

### 3.1 审计清单

- 创建文件：`docs/dev/hardcoded_thresholds_audit.md`。
- 必须记录：
  - 文件路径 + 行号；
  - 具体阈值（数值及单位）；
  - 语义说明（该阈值在业务上的含义）；
  - 当前依据：经验公式 / 文档 / 无依据。

### 3.2 管理要求

- 未完成审计前，禁止在任何文档/报告中引用"硬编码总数"（如 311 处）之类无法核查的数字。
- 对标记为"无依据"的阈值，后续统一纳入"去硬编码专项"中优先处理。

---

## 4. 动态阈值 / ratio / 分位数

### 4.1 现有能力的复用

- 已存在的模块（例如 `logic/strategies/dynamic_threshold.py`）必须优先复用，禁止在新代码中重复定义资金阈值逻辑。
- 新增资金相关功能，必须采用：
  - `ratio = mainnetinflow / circulating_cap` 作为基础尺度；
  - 并通过动态阈值或配置文件配置阈值，而不是直接写常数。

### 4.2 新能力规划

- 分位数工具：
  - 由团队在 `logic/utils/` 下实现通用分位数计算工具（文件名建议：`percentile_utils.py`）。
  - 用于计算单票在当日市场/板块中的位置（如位于前 1% / 3%）。
- 自校准机制：
  - 暂列为 P2 规划，当前禁止在正式文档中承诺具体完成时间。
  - 任何自校准逻辑必须基于回测统计结果（如触发样本的后续胜率/收益）。

---

## 5. 热门样本回测流程

### 5.1 必跑样本集

- 热门样本最小集（如无特殊说明，回测必须至少覆盖这些）：
  - 网宿科技（300017.SZ）：包含 2026-01-26 涨停日及前后窗口。
  - 顽主榜单真实窗口：2026-02-04 至 2026-02-13，已映射代码的票。
  - 若干经典个股案例（如志特新材、欢乐家、有友食品），具体列表由老板指定。

### 5.2 统一入口脚本

- 新建统一入口脚本（建议路径）：`backtest/run_hot_cases_suite.py`。
- 功能：
  - 聚合上述热门样本的回测任务；
  - 输出至少包含：交易次数、胜率、收益率、最大回撤等核心统计。

### 5.3 流程要求

- 任何涉及核心策略或过滤逻辑的改动，在合入前必须提供一次最新的 hot_cases_suite 结果摘要。
- 未跑该 suite 的改动，不得进入全市场扫描或实盘环境。

---

## 6. 探索线程记录

### 6.1 目录与结构

- 创建目录：`docs/dev/exploration_log/`。
- 每条探索线程对应一个 CASE 文档，例如：
  - `20260218_wangsu_tick_and_halfway.md`
  - `20260218_v12_filter_postmortem.md`
  - `20260218_tick_pipeline_and_provider_plan.md`

### 6.2 CASE 模板要求

- 每个 CASE 至少包含：
  - 标题 + CASE ID；
  - Owner（负责人）；
  - Status（OPEN / FROZEN / CLOSED）；
  - 背景 & 目标（为什么做、要回答什么问题）；
  - 分日期记录的"当日进展 / 关键发现 / 决策动作"；
  - 未解决问题列表；
  - 相关代码与数据链接。

### 6.3 管理要求

- 所有中长期探索必须挂在 CASE 下，不允许只存在于聊天记录或零散文档中。
- Owner 对 CASE 的更新和收尾负责，Status 必须保持真实。

---

## 7. 报告与数字使用规范

- 禁止在报告中使用无法验证的精确数字（如"311 处硬编码""17 条铁律"）；
- 如需引用数量，必须附上：
  - 对应审计文件路径；
  - 或自动扫描脚本及其输出文件。
- 禁止对尚未实现的模块给出具体时间承诺（如"本月完成重构"），除非已有详细设计与排期。

---

本备忘录自 2026-02-18 起生效，后续更新以最新版本为准。