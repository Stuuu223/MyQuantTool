# 自动化脚本使用指南

**创建日期**：2026-02-12  
**版本**：V1.0

---

## 📚 脚本概览

本目录包含3个自动化脚本，用于简化日常交易流程：

| 脚本 | 功能 | 使用时间 | 优先级 |
|------|------|----------|----------|
| `auto_auction_at_0925.bat` | 竞价采集定时器 | 09:00-09:20 | 🔴 高 |
| `verify_auction_replay.bat` | 历史回放验证 | 任意时间 | 🟡 低 |
| `start_monitor_0930.bat` | 09:30监控启动 | 09:20-09:28 | 🔴 高 |

---

## 1️⃣ auto_auction_at_0925.bat

### 功能说明

自动等待到09:24:50，然后启动绞价快照采集脚本。

### 使用方法

```batch
# 方法1：双击运行（推荐）
1. 在 09:00-09:20 之间双击 scripts/auto_auction_at_0925.bat
2. 窗口自动等待到09:24:50
3. 自动启动采集脚本

# 方法2：命令行运行
cd E:\MyQuantTool
scripts\auto_auction_at_0925.bat
```

### 运行流程

```
09:00-09:20  用户双击启动脚本
     ↓
   等待循环  每5秒检查一次时间
     ↓
09:24:50     达到目标时间
     ↓
   激活虚拟环境 venv_qmt
     ↓
   运行 collect_auction_snapshot.py
     ↓
09:25:00     开始采集绞价快照
     ↓
09:25:30     采集完成（5190只股票）
     ↓
   保存日志到 logs/auction/
```

### 输出示例

```
========================================
绞价采集自动化启动器 V1.0
========================================

[INFO] 当前日期: 2026-02-12
[INFO] 目标时间: 09:24:50

[WAIT] 当前时间: 09:15:23 - 等待中...
[WAIT] 当前时间: 09:15:28 - 等待中...
...
[WAIT] 当前时间: 09:24:45 - 等待中...

========================================
[START] 启动绞价采集 - 09:24:50
========================================

[RUN] python tasks/collect_auction_snapshot.py --date 2026-02-12

✅ 批量采集完成 - 总数: 5190, 成功: 4900, 失败: 290
📊 绞价快照统计信息：
  高开股票: 387 (涨幅>3%)
  低开股票: 324 (跌幅>3%)
  放量股票: 52 (量比>2.0且有效)
  数据有效率: 95.2%

========================================
[DONE] 绞价采集完成 - 09:25:34
========================================

[INFO] 日志已保存到: logs/auction/2026-02-12.log
```

### 注意事项

⚠️ **关键提醒**：

1. **必须在 09:20 之前启动**
   - 如果 09:24:50 之后才启动，将立即执行采集
   - 可能错过 09:25:00 的最佳采集窗口

2. **QMT 必须提前启动**
   - 建议 09:15 之前启动 QMT 客户端
   - 确保账号已登录
   - 检查数据已下载完成

3. **日志保存**
   - 采集日志自动保存到 `logs/auction/YYYY-MM-DD.log`
   - 可用于回顾和排错

---

## 2️⃣ verify_auction_replay.bat

### 功能说明

回放历史绞价数据，验证采集功能是否正常。

### 使用方法

```batch
# 双击运行
1. 双击 scripts/verify_auction_replay.bat
2. 选择要回放的日期（输入1-6）
3. 查看回放报告
```

### 菜单选项

```
请选择要回放的日期：

1. 2026-02-11 (昨天)
2. 2026-02-10
3. 2026-02-09
4. 2026-02-08
5. 2026-02-07
6. 自定义日期

请输入选项 (1-6): 1
```

### 输出示例

```
========================================
历史绞价回放验证器 V1.0
========================================

========================================
[START] 开始回放 2026-02-11 的绞价数据
========================================

📊 2026-02-11 绞价快照回放报告

总数: 5190
高开股票: 387 (涨幅>3%)
低开股票: 324 (跌幅>3%)
放量股票: 52 (量比>2.0)

✅ Top 20 高开股票：
│ 股票代码 │ 股票名称 │ 绞价涨幅 │ 量比 │
├────────┼────────┼────────┼──────┤
│ 300997   │ 欢乐家   │   +8.54%  │ 3.2  │
│ 603697   │ 有友食品 │   +7.23%  │ 2.8  │
...

========================================
[DONE] 回放完成
========================================
```

### 使用场景

1. **功能验证**
   - 首次部署后验证采集功能
   - 检查数据完整性

2. **历史分析**
   - 回顾历史绞价数据
   - 对比不同日期的市场情况

3. **错误排查**
   - 当天采集失败时回放历史
   - 对比正常数据找出问题

---

## 3️⃣ start_monitor_0930.bat

### 功能说明

自动等待到09:30:00，然后启动CLI监控面板。

### 使用方法

```batch
# 方法1：双击运行（推荐）
1. 在 09:20-09:28 之间双击 scripts/start_monitor_0930.bat
2. 窗口自动等待到09:30:00
3. 自动启动CLI监控

# 方法2：命令行运行
cd E:\MyQuantTool
scripts\start_monitor_0930.bat
```

### 运行流程

```
09:20-09:28  用户双击启动脚本
     ↓
   等待循环  每5秒检查一次时间
     ↓
09:30:00     达到目标时间
     ↓
   激活虚拟环境 venv_qmt
     ↓
   运行 cli_monitor.py
     ↓
   显示CLI监控面板
     ↓
   实时监控至15:00
     ↓
   用户按 Ctrl+C 退出
```

### 监控面板示例

```
========================================
CLI监控自动启动器 V1.0
========================================

[INFO] 目标时间: 09:30:00
[INFO] 当前时间: 09:25:34

[WAIT] 当前时间: 09:25:34 - 等待中...
...
[WAIT] 当前时间: 09:29:55 - 等待中...

========================================
[START] 启动CLI监控 - 09:30:00
========================================

[INFO] 正在启动CLI监控面板...
[INFO] 监控内容：
  - 🛡️ 时机斧：板块雷达
  - 🎯 资格斧：狙击镜
  - 🚫 防守斧：拦截网

[TIP] 按 Ctrl+C 退出监控

┌─ 时机斧 - 板块雷达 ─────────────────┐
│ 板块名称   Leaders   Breadth   状态   │
│ 半导体      5         45%       🔥共振  │
│ AI应用      4         38%       🔥共振  │
└──────────────────────────────────┘
```

### 监控内容

| 模块 | 功能 | 描述 |
|------|------|------|
| **🛡️ 时机斧** | 板块雷达 | Leaders≥3 + Breadth≥35% |
| **🎯 资格斧** | 狙击镜 | 最终买入信号 |
| **🚫 防守斧** | 拦截网 | 补涨尾声/拉高出货 |

### 注意事项

⚠️ **关键提醒**：

1. **建议 09:25 之后启动**
   - 等待绞价采集完成后再启动
   - 确保绞价数据已入库

2. **监控时间范围**
   - 09:30 - 15:00 交易时间
   - 全程保持运行

3. **退出监控**
   - 按 `Ctrl+C` 退出
   - 或直接关闭窗口

---

## 📅 日常使用流程

### 完整盘前流程（推荐）

```
08:00 - 数据预热
  ↓
  E:\MyQuantTool\venv_qmt\Scripts\python.exe tasks/run_pre_market_warmup.py
  ↓
09:15 - QMT环境检查
  ↓
  E:\MyQuantTool\venv_qmt\Scripts\python.exe tools/check_qmt_environment.py
  ↓
09:15 - 启动绞价采集定时器
  ↓
  双击 scripts/auto_auction_at_0925.bat
  ↓
09:24:50 - 自动启动采集
  ↓
09:25:00 - 采集绞价快照
  ↓
09:25:30 - 采集完成
  ↓
09:25:35 - 启动监控定时器
  ↓
  双击 scripts/start_monitor_0930.bat
  ↓
09:30:00 - 自动启动监控
  ↓
15:00:00 - 交易结束，退出监控
```

### 简化流程（快速使用）

```
09:15 - 同时双击两个脚本
  ↓
  scripts/auto_auction_at_0925.bat
  scripts/start_monitor_0930.bat
  ↓
  两个窗口自动等待
  ↓
09:24:50 - 绞价采集自动启动
09:30:00 - 监控系统自动启动
```

---

## ❓ 常见问题

### Q1：脚本双击无法运行？

**A1**：检查以下项：
1. 项目路径是否为 `E:\MyQuantTool`
2. 虚拟环境是否存在：`E:\MyQuantTool\venv_qmt`
3. Python 是否已安装

### Q2：竞价采集无数据？

**A2**：可能原因：
1. **时间不对**：必须在 09:25:00±10秒 采集
2. **QMT未启动**：确保QMT客户端已运行
3. **账号未登录**：检查QMT登录状态

### Q3：监控面板无数据？

**A3**：可能原因：
1. **绞价数据未采集**：先运行绞价采集
2. **数据库为空**：检查 `data/auction_snapshots.db`
3. **Redis未启动**：如果使用Redis缓存，检查服务状态

### Q4：如何验证脚本功能？

**A4**：使用历史回放：
```batch
双击 scripts/verify_auction_replay.bat
选择一个历史日期
查看回放结果
```

---

## 📝 日志文件

所有脚本的日志都保存在 `logs/` 目录：

```
logs/
├── auction/              # 绞价采集日志
│   ├── 2026-02-12.log
│   ├── 2026-02-13.log
│   └── ...
├── monitor/              # 监控系统日志
│   ├── 2026-02-12.log
│   └── ...
└── prewarm/              # 数据预热日志
    ├── 2026-02-12.log
    └── ...
```

---

## 🛠️ 维护和更新

### 修改项目路径

如果你的项目路径不是 `E:\MyQuantTool`，需要修改所有脚本中的路径：

```batch
# 修改前
cd /d E:\MyQuantTool

# 修改后（例如）
cd /d D:\Trading\MyQuantTool
```

### 修改时间设置

如果需要调整启动时间：

```batch
# 绞价采集时间（默认09:24:50）
set /a TARGET_SECONDS=(9*3600)+(24*60)+50

# 改为09:24:00
set /a TARGET_SECONDS=(9*3600)+(24*60)+0

# 监控启动时间（默认09:30:00）
set /a TARGET_SECONDS=(9*3600)+(30*60)+0

# 改为09:28:00
set /a TARGET_SECONDS=(9*3600)+(28*60)+0
```

---

## ✅ 检查清单

在使用脚本之前，请确认：

- [ ] QMT客户端已安装
- [ ] Python 3.10 (64-bit) 已安装
- [ ] 虚拟环境 venv_qmt 已创建
- [ ] 项目路径为 E:\MyQuantTool
- [ ] 所有依赖已安装 (pip install -r requirements.txt)
- [ ] QMT账号已配置

---

**创建日期**：2026-02-12  
**最后更新**：2026-02-12  
**版本**：V1.0  
**维护人**：CTO
