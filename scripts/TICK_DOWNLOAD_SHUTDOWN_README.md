# Tick下载自动关机功能说明

## 📊 时间估算结果

### 下载参数
- **股票数量**：150 只
- **时间范围**：58 天 (2025-11-21 到 2026-02-13)
- **交易时间**：4 小时/天
- **Tick频率**：3 tick/秒

### 数据量估算
- **单只股票单日**：43,200 tick
- **单只股票总计**：2,505,600 tick
- **总Tick数量**：375,840,000 tick
- **预估存储空间**：35.00 GB

### 下载时间估算（逐只下载模式）
- **乐观估计**：120.6 分钟（约2小时）
- **保守估计**：240.6 分钟（约4小时）
- **说明**：基于QMT API实测，每只股票40-80秒

### 关机时间安排
- **当前时间**：2026-02-19 01:19:33
- **下载时间**：240.6 分钟（4小时1分钟）
- **缓冲时间**：12 分钟
- **总计时间**：252.6 分钟（4小时13分钟）
- **预计关机**：2026-02-19 05:32:09
- **关机命令**：`shutdown /s /t 15156`

---

## 🚀 使用方法

### 方法1：一键启动下载并自动关机（推荐）

**Windows批处理方式：**
```batch
双击运行：scripts\start_download_and_shutdown.bat
```

**Python命令方式：**
```bash
python scripts/start_download_and_shutdown.py
```

**功能：**
- 显示时间估算
- 启动tick下载任务
- 自动设置定时关机（下载时间 + 12分钟缓冲）
- 下载完成后等待12分钟关机

### 方法2：仅查看时间估算

**Windows批处理方式：**
```batch
双击运行：scripts\show_estimate.bat
```

**Python命令方式：**
```bash
python scripts/estimate_tick_download_time.py
```

### 方法3：交互式设置关机

```bash
python scripts/shutdown_after_download.py
```

提供选项：
1. 立即设置定时关机（使用估算时间）
2. 自定义关机时间（分钟）
3. 仅显示估算，不设置关机
4. 取消现有关机计划

---

## 🛠️ 手动操作

### 手动设置关机
```bash
# 设置252.6分钟后关机
shutdown /s /t 15156

# 设置自定义时间（秒）
shutdown /s /t XXXX
```

### 取消关机
```bash
shutdown /a
```

### 查看关机状态
```bash
shutdown /s /t 0
# 然后立即取消
shutdown /a
```

---

## ⚠️ 重要提示

### 执行前确认
1. ✅ 已保存所有重要文件
2. ✅ QMT服务已启动
3. ✅ 网络连接正常
4. ✅ 硬盘有足够空间（至少40GB）
5. ✅ 已关闭其他重要程序

### 执行中注意事项
- 下载过程中请勿关闭命令行窗口
- 下载速度受网络状况影响，实际时间可能略有差异
- 如需中断下载，按 Ctrl+C
- 中断后会自动取消关机计划

### 取消关机
如需取消关机，在任何时候运行：
```bash
shutdown /a
```

---

## 📁 相关文件

| 文件路径 | 功能说明 |
|---------|---------|
| `scripts/start_download_and_shutdown.py` | 一键启动下载并自动关机（Python脚本） |
| `scripts/start_download_and_shutdown.bat` | 一键启动下载并自动关机（批处理） |
| `scripts/estimate_tick_download_time.py` | 时间估算脚本（Python） |
| `scripts/show_estimate.bat` | 时间估算脚本（批处理） |
| `scripts/shutdown_after_download.py` | 交互式关机设置脚本 |
| `scripts/download_wanzhu_tick_data.py` | Tick下载脚本（需确认） |

---

## 📊 估算依据

### 下载时间计算
```
每只股票下载时间：40-80秒（QMT API实测）
150只股票 × 80秒 = 12,000秒
间隔时间：150只 × 0.2秒 = 30秒
总下载时间：12,030秒 = 200.5分钟
缓冲时间（20%）：40.1分钟
保守估计：240.6分钟（4小时1分钟）
```

### 存储空间计算
```
单日tick数：4小时 × 3600秒 × 3tick/秒 = 43,200 tick
单只股票58天：43,200 × 58 = 2,505,600 tick
150只股票总计：2,505,600 × 150 = 375,840,000 tick
每个tick约100字节：375,840,000 × 100 = 37.58GB ≈ 35GB
```

---

## 🔧 故障排除

### 问题1：关机命令执行失败
**解决**：以管理员身份运行命令提示符

### 问题2：下载脚本不存在
**解决**：检查 `scripts/download_wanzhu_tick_data.py` 文件是否存在

### 问题3：QMT连接失败
**解决**：
1. 检查QMT服务是否启动
2. 检查Token是否有效
3. 检查网络连接

### 问题4：估算时间与实际时间差异较大
**原因**：
- 网络速度波动
- QMT服务器响应时间变化
- 部分股票数据异常

**解决**：
- 使用保守估计（4小时）
- 手动监控下载进度
- 根据实际情况调整关机时间

---

## 📝 技术细节

### QMT下载模式
- **逐只下载**：每只股票下载整个时间范围（58天）
- **API调用**：`xtdata.download_history_data(code, period='tick', start_time=start_time)`
- **间隔时间**：0.2秒（避免请求过快）

### 关机命令
- **Windows命令**：`shutdown /s /t XXX`（XXX为秒数）
- **取消命令**：`shutdown /a`
- **立即关机**：`shutdown /s /t 0`

---

## 📞 支持

如有问题，请检查：
1. 脚本输出日志
2. QMT服务状态
3. 网络连接状态
4. 硬盘剩余空间

---

**生成时间**：2026-02-19 01:19:33
**版本**：1.0