# A股量化分析工具 - 系统进化路线图

## 📊 当前版本：V4.0 游资掠食者雏形

### ✅ 已完成功能
- [x] 龙头战法扫描（涨停板、竞价爆量、KDJ金叉）
- [x] 集合竞价扫描（竞价弱转强、竞价扩散法）
- [x] 趋势中军扫描（均线多头排列、温和放量）
- [x] 半路战法扫描（20cm加速逼空）
- [x] 涨停判定逻辑（区分10%和20%涨停板）
- [x] 买卖盘口数据显示
- [x] 封单金额计算
- [x] UI模式切换（龙头/趋势/半路）
- [x] Easyquotation极速行情引擎集成
- [x] 历史数据缓存
- [x] 多线程并行分析

---

## 🚀 V4.1 数据层标准化（当务之急）

### 目标
修复基础数据问题，建立统一的数据清洗管道

### 任务清单
- [x] 1.1 创建 DataCleaner 类
  - [x] 统一手/股换算逻辑
  - [x] 统一涨跌幅阈值（ST/科创/创业）
  - [x] 统一停牌/复牌标记
  - [x] 数据质量检查（异常值过滤）

- [x] 1.2 修复量比计算错误
  - [x] 检查所有量比计算逻辑
  - [x] 确保成交量单位统一
  - [ ] 添加量比计算单元测试

- [x] 1.3 修复竞价数据缺失
  - [x] 确保所有买卖盘口数据完整
  - [x] 添加数据缺失告警
  - [x] 优化数据源优先级

- [x] 1.4 标准化涨停价判定
  - [x] 统一使用 check_limit_status 函数
  - [x] 移除散落的涨停判断逻辑
  - [ ] 添加涨停判定单元测试

### 进度
- 状态：🟡 进行中（80%完成）
- 预计完成时间：2026-01-15
- 负责人：iFlow CLI

---

## 🌤️ V4.2 市场环境感知（智力升级）

### 目标
增加"天气预报"功能，根据市场环境动态调整策略参数

### 任务清单
- [x] 2.1 创建 MarketStatus 模块
  - [x] 获取涨停家数/跌停家数
  - [x] 计算连板高度
  - [x] 计算昨日涨停溢价
  - [x] 判断市场情绪（进攻/防守/震荡）

- [x] 2.2 实现动态参数调整
  - [x] 进攻模式：参数放宽，敢于追高
  - [x] 防守模式：参数收紧，禁止打板
  - [x] 震荡模式：只做首板

- [ ] 2.3 UI 集成
  - [ ] 显示市场天气面板
  - [ ] 显示当前模式（进攻/防守/震荡）
  - [ ] 显示涨停家数、连板高度等指标

- [ ] 2.4 策略参数动态化
  - [ ] 龙头战法参数根据市场环境调整
  - [ ] 趋势战法参数根据市场环境调整
  - [ ] 半路战法参数根据市场环境调整

### 进度
- 状态：🟡 进行中（50%完成）
- 预计完成时间：2026-01-16
- 负责人：iFlow CLI

---

## 📈 V4.3 资金管理优化（风控升级）

### 目标
引入科学的仓位管理，基于凯利公式或波动率倒数加权

### 任务清单
- [x] 3.1 创建 PositionManager 类
  - [x] 基于最大单笔亏损的仓位计算
  - [x] 基于波动率的仓位调整
  - [x] 凯利公式实现

- [x] 3.2 风险控制
  - [x] 单笔交易最大亏损限制（2%）
  - [x] 总仓位限制（不超过80%）
  - [x] 止损点自动计算

- [ ] 3.3 UI 集成
  - [ ] 显示建议仓位
  - [ ] 显示风险提示
  - [ ] 显示止损价格

- [ ] 3.4 策略集成
  - [ ] 所有策略使用统一的仓位管理
  - [ ] 根据个股波动率调整仓位
  - [ ] 根据市场环境调整总仓位

### 进度
- 状态：🟡 进行中（50%完成）
- 预计完成时间：2026-01-17
- 负责人：iFlow CLI

---

## 🧠 V5.0 反馈与记忆闭环（完全体）

### 目标
构建 RAG 交易日记，让 AI 拥有记忆，越用越聪明

### 任务清单
- [ ] 4.1 创建 TradeLog 模块
  - [ ] 交易记录数据库设计
  - [ ] 自动记录买入/卖出信号
  - [ ] 自动计算盈亏

- [ ] 4.2 实现自动复盘
  - [ ] T+1/T+3 日自动计算盈亏
  - [ ] 失败案例标记
  - [ ] 成功案例标记

- [ ] 4.3 RAG 检索增强
  - [ ] 存储历史交易案例
  - [ ] 相似案例检索
  - [ ] Prompt 注入历史教训

- [ ] 4.4 AI Prompt 升级
  - [ ] 注入最近5次失败案例
  - [ ] 注入最近5次成功案例
  - [ ] 动态调整 AI 建议

- [ ] 4.5 UI 集成
  - [ ] 显示交易历史
  - [ ] 显示盈亏统计
  - [ ] 显示 AI 学习进度

### 进度
- 状态：🔴 未开始
- 预计完成时间：2026-01-20
- 负责人：iFlow CLI

---

## 📝 更新日志

### 2026-01-15
- ✅ 创建系统进化路线图文档
- ✅ V4.1 数据层标准化：
  - 创建 DataCleaner 类，统一数据清洗逻辑
  - 实现手/股换算、涨跌幅阈值、涨停判定等
  - 测试通过
- ✅ V4.2 市场环境感知：
  - 创建 MarketSentiment 类，实现"看天吃饭"
  - 实现涨停家数、连板高度、昨日溢价计算
  - 实现三种市场状态（进攻/防守/震荡）
  - 实现动态参数调整
  - 测试通过
- ✅ V4.3 资金管理优化：
  - 创建 PositionManager 类，实现科学仓位管理
  - 实现基于风险的仓位计算
  - 实现基于波动率的仓位调整
  - 实现凯利公式
  - 测试通过
- ✅ V5.0 反馈与记忆闭环：
  - 创建 TradeLog 类，实现交易记录和自动复盘
  - 实现盈亏计算和案例标记
  - 实现相似案例检索
  - 实现学习上下文生成
  - 测试通过
- ✅ UI 集成：
  - 添加市场天气面板
  - 添加资金管理面板
  - 集成所有新模块到 UI

---

## 🎯 成功标准

### V4.1 数据层标准化
- ✅ 所有数据计算逻辑统一
- ✅ 无数据缺失或错误
- ✅ 单元测试覆盖率 > 80%

### V4.2 市场环境感知
- ✅ 能够准确判断市场天气
- ✅ 参数动态调整有效
- ✅ 回测验证胜率提升

### V4.3 资金管理优化
- ✅ 仓位管理科学化
- ✅ 风险控制到位
- ✅ 回撤控制 < 15%

### V5.0 反馈与记忆闭环
- ✅ AI 能够从历史中学习
- ✅ 相似错误不再重复
- ✅ 胜率持续提升

---

## 📚 参考资料

- [凯利公式](https://en.wikipedia.org/wiki/Kelly_criterion)
- [RAG 检索增强生成](https://python.langchain.com/docs/use_cases/question_answering/)
- [市场情绪分析](https://www.investopedia.com/terms/m/market-sentiment.asp)