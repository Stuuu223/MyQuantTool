# V10.1.2 å‡çº§æ€»ç»“ - Visual Commandï¼ˆè§†è§‰æŒ‡æŒ¥ï¼‰ç»ˆæå¾®è°ƒ

## ğŸ“Š å‡çº§æ¦‚è¿°

V10.1.2 ç‰ˆæœ¬æ˜¯åœ¨ V10.1.1 åŸºç¡€ä¸Šçš„ç»ˆæå¾®è°ƒï¼Œè§£å†³äº†ä¸¤ä¸ªå…³é”®é—®é¢˜ï¼š
1. **æ•°æ®ç»´æŠ¤éšæ‚£**ï¼šConcept Map çš„"ä¿é²œæœŸ"é—®é¢˜
2. **AI è”æƒ³èƒ½åŠ›**ï¼šä»"æ•°äººå¤´"åˆ°"çœ‹æƒé‡"çš„æ·±åŒ–

**V10.1.2 æ ¸å¿ƒæ”¹è¿›ï¼š**
- âœ… æ·»åŠ æ¦‚å¿µåº“è¿‡æœŸæé†’æœºåˆ¶ï¼ˆè¶…è¿‡7å¤©æ˜¾ç¤ºè­¦å‘Šï¼‰
- âœ… å‡çº§ä¸»çº¿æŒ–æ˜è¿”å›ç»“æ„ï¼Œè¿”å› (åå­—, åˆ†æ•°) è€Œä¸åªæ˜¯åå­—
- âœ… ä¼˜åŒ– AI Contextï¼ŒåŒ…å«ä¸»çº¿èšç„¦åº¦ä¿¡æ¯
- âœ… UI é›†æˆè¿‡æœŸè­¦å‘Šæ˜¾ç¤º

## ğŸ¯ V10.1.2 æ ¸å¿ƒæ”¹è¿›

### 1. æ¦‚å¿µåº“è¿‡æœŸæé†’æœºåˆ¶

**é—®é¢˜è¯Šæ–­ï¼š**
- A è‚¡æ¯å¤©éƒ½åœ¨å˜ï¼šæ–°è‚¡ä¸Šå¸‚ã€æ–°æ¦‚å¿µçˆ†å‘
- æ¦‚å¿µæ˜ å°„è¡¨ï¼ˆconcept_map.jsonï¼‰éœ€è¦å®šæœŸæ›´æ–°
- å¦‚æœæ•°æ®è¿‡æœŸï¼Œç³»ç»Ÿä¼šæ˜¾ç¤º"æ— æ¦‚å¿µ"ï¼Œå¯¼è‡´ AI æ¼æ‰æœ€å¼ºé£å£

**è§£å†³æ–¹æ¡ˆï¼š**
- åœ¨ `_load_concept_map()` æ–¹æ³•ä¸­æ·»åŠ æ–‡ä»¶é¾„æœŸæ£€æŸ¥
- å¦‚æœè¶…è¿‡ 7 å¤©ï¼Œæ˜¾ç¤ºè­¦å‘Šå¹¶æ ‡è®° `concept_map_expired = True`
- åœ¨ UI ä¸­æ˜¾ç¤ºè­¦å‘Šä¿¡æ¯ï¼Œæé†’ç”¨æˆ·è¿è¡Œ `python scripts/generate_concept_map.py` æ›´æ–°

**ä»£ç å®ç°ï¼š**
```python
def _load_concept_map(self) -> Dict:
    import os
    import json
    import time
    
    concept_map_path = "data/concept_map.json"
    
    if os.path.exists(concept_map_path):
        try:
            # æ£€æŸ¥æ–‡ä»¶é¾„æœŸ
            file_time = os.path.getmtime(concept_map_path)
            days_old = (time.time() - file_time) / (24 * 3600)
            
            if days_old > 7:
                self.concept_map_expired = True
                logger.warning(f"âš ï¸ [è­¦å‘Š] æ¦‚å¿µåº“å·²è¿‡æœŸ {int(days_old)} å¤©ï¼å»ºè®®è¿è¡Œ `python scripts/generate_concept_map.py` æ›´æ–°ã€‚")
            else:
                self.concept_map_expired = False
            
            with open(concept_map_path, 'r', encoding='utf-8') as f:
                concept_map = json.load(f)
            logger.info(f"âœ… åŠ è½½æ¦‚å¿µæ˜ å°„è¡¨æˆåŠŸï¼Œè¦†ç›– {len(concept_map)} åªè‚¡ç¥¨ï¼ˆ{int(days_old)} å¤©å‰æ›´æ–°ï¼‰")
            return concept_map
        except Exception as e:
            logger.warning(f"è¯»å–æ¦‚å¿µæ˜ å°„è¡¨å¤±è´¥: {e}")
    
    self.concept_map_expired = True
    logger.warning("âš ï¸ æ¦‚å¿µæ˜ å°„è¡¨ä¸å­˜åœ¨ï¼Œå°†ä½¿ç”¨åç§°æ¨æ–­æ³•")
    return {}
```

**UI æ˜¾ç¤ºï¼š**
```python
# ğŸ†• V10.1.2ï¼šæ˜¾ç¤ºæ¦‚å¿µåº“è¿‡æœŸè­¦å‘Š
if market_sentiment.concept_map_expired:
    st.warning("âš ï¸ æ¦‚å¿µåº“å·²è¿‡æœŸè¶…è¿‡7å¤©ï¼Œå»ºè®®è¿è¡Œ `python scripts/generate_concept_map.py` æ›´æ–°")
```

### 2. AI è”æƒ³èƒ½åŠ›ï¼šä¸»çº¿èšç„¦åº¦åˆ†æ

**é—®é¢˜è¯Šæ–­ï¼š**
- AI çœ‹åˆ°ä¸»çº¿æ˜¯ `['ç™¾å…ƒè‚¡', 'æ–°èƒ½æºè½¦', 'å°ç±³æ±½è½¦']`ï¼Œä¸çŸ¥é“è¿™æ˜¯"ä¸€ä»¶äº‹"ï¼ˆæ±½è½¦äº§ä¸šé“¾ï¼‰
- å¦‚æœä¸»çº¿æ˜¯ `['ä½ç©ºç»æµ', 'æˆ¿åœ°äº§', 'èŠ¯ç‰‡']`ï¼ŒAI ä¸çŸ¥é“è¿™æ˜¯"ç”µé£æ‰‡è¡Œæƒ…"ï¼ˆè½®åŠ¨å¿«ï¼Œæ²¡åˆåŠ›ï¼‰

**è§£å†³æ–¹æ¡ˆï¼š**
- å‡çº§ `_analyze_hot_themes()` è¿”å›ç»“æ„ï¼Œè¿”å› `(åå­—, åˆ†æ•°)` è€Œä¸åªæ˜¯åå­—
- åœ¨ `generate_ai_context()` ä¸­ï¼Œæ ¹æ®åˆ†æ•°åˆ¤æ–­ä¸»çº¿èšç„¦åº¦
- æ ¼å¼åŒ–æˆ AI æ˜“è¯»çš„å­—ç¬¦ä¸²ï¼ŒåŒ…å«åˆ†æ•°å’Œèšç„¦åº¦

**ä¸»çº¿èšç„¦åº¦åˆ¤æ–­é€»è¾‘ï¼š**
```python
# åˆ¤æ–­ä¸»çº¿èšç„¦åº¦
if len(hot_themes_detailed) >= 2:
    top_score = hot_themes_detailed[0][1]
    second_score = hot_themes_detailed[1][1]
    score_gap = top_score - second_score
    
    # åˆ†æ•°å·®è·å°ä¸”åˆ†æ•°é«˜ â†’ åˆåŠ›å¼º
    if score_gap < 10 and top_score >= 30:
        focus_level = "ä¸»çº¿æ˜ç¡®ï¼ŒåˆåŠ›å¼º"
    # åˆ†æ•°å·®è·å¤§ â†’ å•ä¸€ä¸»çº¿
    elif score_gap >= 20:
        focus_level = "å•ä¸€ä¸»çº¿ï¼Œèšç„¦åº¦é«˜"
    # åˆ†æ•°ä½ä¸”åˆ†æ•£ â†’ åˆåŠ›å¼±
    elif top_score < 20:
        focus_level = "ä¸»çº¿åˆ†æ•£ï¼ŒåˆåŠ›å¼±"
    else:
        focus_level = "ä¸»çº¿ä¸€èˆ¬"
else:
    focus_level = "ä¸»çº¿ä¸æ˜ç¡®"
```

**AI Context æ ¼å¼åŒ–ï¼š**
```python
# æ ¼å¼åŒ–æˆ AI æ˜“è¯»çš„å­—ç¬¦ä¸²
themes_str = ", ".join([f"{t[0]}({t[1]}åˆ†)" for t in hot_themes_detailed])
themes_with_focus = f"{themes_str}ï¼ˆ{focus_level}ï¼‰"
```

**æ•ˆæœç¤ºä¾‹ï¼š**
```
åœºæ™¯ Aï¼ˆåˆåŠ›å¼ºï¼‰ï¼š
  ä¸»çº¿ï¼šç™¾å…ƒè‚¡(30åˆ†), æ–°èƒ½æºè½¦(25åˆ†), å°ç±³æ±½è½¦(20åˆ†)
  èšç„¦åº¦ï¼šä¸»çº¿æ˜ç¡®ï¼ŒåˆåŠ›å¼º âœ…
  AI åˆ¤æ–­ï¼šä¸»çº¿æ˜ç¡®ï¼Œå…¨ä»“å‡ºå‡»

åœºæ™¯ Bï¼ˆåˆåŠ›å¼±ï¼‰ï¼š
  ä¸»çº¿ï¼šæˆ¿åœ°äº§(20åˆ†), èŠ¯ç‰‡(18åˆ†), é£Ÿå“(15åˆ†)
  èšç„¦åº¦ï¼šä¸»çº¿åˆ†æ•£ï¼ŒåˆåŠ›å¼± âš ï¸
  AI åˆ¤æ–­ï¼šå¸‚åœºæ··ä¹±ï¼Œå»ºè®®ç©ºä»“
```

### 3. è¿”å›ç»“æ„å‡çº§

**ä¿®æ”¹å‰ï¼š**
```python
def _analyze_hot_themes(self, top_stocks: List[Dict]) -> List[str]:
    # ...
    return [theme for theme, score in sorted_themes[:3]]
```

**ä¿®æ”¹åï¼š**
```python
def _analyze_hot_themes(self, top_stocks: List[Dict]) -> List[Tuple[str, int]]:
    # ...
    return sorted_themes[:3]  # è¿”å› (åå­—, åˆ†æ•°)
```

**å½±å“èŒƒå›´ï¼š**
- `get_market_regime()` - æ·»åŠ  `hot_themes_detailed` å­—æ®µ
- `generate_ai_context()` - æ·»åŠ  `hot_themes_detailed` å­—æ®µ
- UI æ˜¾ç¤º - å¯ä»¥é€‰æ‹©æ˜¾ç¤ºå¸¦åˆ†æ•°çš„ä¸»çº¿

## ğŸ§ª æµ‹è¯•éªŒè¯

**æµ‹è¯•æ–‡ä»¶ï¼š** `test_v10_1_2.py`

**æµ‹è¯•ç»“æœï¼š**
```
âœ… æ¦‚å¿µåº“è¿‡æœŸçŠ¶æ€: æ­£å¸¸

âœ… ä»Šæ—¥ä¸»çº¿ï¼ˆä»…åç§°ï¼‰: ['ç™¾å…ƒè‚¡', 'æ–°èƒ½æºè½¦', 'å°ç±³æ±½è½¦']
âœ… ä»Šæ—¥ä¸»çº¿ï¼ˆå¸¦åˆ†æ•°ï¼‰: [('ç™¾å…ƒè‚¡', 30), ('æ–°èƒ½æºè½¦', 25), ('å°ç±³æ±½è½¦', 20)]

âœ… ä¸»çº¿æ’å:
   1. ç™¾å…ƒè‚¡: 30åˆ†
   2. æ–°èƒ½æºè½¦: 25åˆ†
   3. å°ç±³æ±½è½¦: 20åˆ†

âœ… ä¸»çº¿åˆ†æ:
   ç¬¬ä¸€ååˆ†æ•°: 30åˆ†
   ç¬¬äºŒååˆ†æ•°: 25åˆ†
   åˆ†æ•°å·®è·: 5åˆ†
   èšç„¦åº¦: ä¸»çº¿æ˜ç¡®ï¼ŒåˆåŠ›å¼º âœ…

âœ… AI Context æ ¼å¼åŒ–ç»“æœ: ç™¾å…ƒè‚¡(30åˆ†), æ–°èƒ½æºè½¦(25åˆ†), å°ç±³æ±½è½¦(20åˆ†)ï¼ˆä¸»çº¿æ˜ç¡®ï¼ŒåˆåŠ›å¼ºï¼‰
```

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### æ£€æŸ¥æ¦‚å¿µåº“è¿‡æœŸçŠ¶æ€

```python
from logic.market_sentiment import MarketSentiment

ms = MarketSentiment()

# æ£€æŸ¥æ¦‚å¿µåº“æ˜¯å¦è¿‡æœŸ
if ms.concept_map_expired:
    print("âš ï¸ æ¦‚å¿µåº“å·²è¿‡æœŸï¼Œå»ºè®®æ›´æ–°")
else:
    print("âœ… æ¦‚å¿µåº“æ­£å¸¸")
```

### è·å–ä¸»çº¿èšç„¦åº¦ä¿¡æ¯

```python
from logic.market_sentiment import MarketSentiment

ms = MarketSentiment()

# è·å–å¸‚åœºæƒ…ç»ªï¼ˆåŒ…å«ä¸»çº¿èšç„¦åº¦ï¼‰
regime_info = ms.get_market_regime(top_stocks)

hot_themes = regime_info.get('hot_themes', [])  # ä»…åç§°
hot_themes_detailed = regime_info.get('hot_themes_detailed', [])  # å¸¦åˆ†æ•°

# ç”Ÿæˆ AI Contextï¼ˆåŒ…å«ä¸»çº¿èšç„¦åº¦ï¼‰
context = ms.generate_ai_context(top_stocks)
themes_with_focus = context['hot_themes_detailed']  # å¸¦åˆ†æ•° + èšç„¦åº¦
```

### åœ¨ UI ä¸­æŸ¥çœ‹

1. å¯åŠ¨åº”ç”¨ï¼š`streamlit run main.py`
2. è¿›å…¥"é¾™å¤´æˆ˜æ³•"æ ‡ç­¾é¡µ
3. å¦‚æœæ¦‚å¿µåº“è¿‡æœŸï¼Œä¼šæ˜¾ç¤ºé»„è‰²è­¦å‘Šæ¡
4. æŸ¥çœ‹"ä»Šæ—¥ä¸»çº¿"æ˜¾ç¤ºï¼ˆä»…åç§°ï¼‰

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **æ¦‚å¿µåº“æ›´æ–°**ï¼šå»ºè®®æ¯å‘¨è¿è¡Œä¸€æ¬¡ `python scripts/generate_concept_map.py` æ›´æ–°æ¦‚å¿µåº“
2. **ä¸»çº¿èšç„¦åº¦**ï¼šAI ä¼šæ ¹æ®èšç„¦åº¦è‡ªåŠ¨è°ƒæ•´ç­–ç•¥å»ºè®®
3. **åˆ†æ•°é˜ˆå€¼**ï¼š
   - åˆ†æ•°å·®è· < 10 ä¸”åˆ†æ•° >= 30 â†’ ä¸»çº¿æ˜ç¡®ï¼ŒåˆåŠ›å¼º
   - åˆ†æ•°å·®è· >= 20 â†’ å•ä¸€ä¸»çº¿ï¼Œèšç„¦åº¦é«˜
   - åˆ†æ•° < 20 â†’ ä¸»çº¿åˆ†æ•£ï¼ŒåˆåŠ›å¼±
4. **æ€§èƒ½ä¼˜åŒ–**ï¼šä¸»çº¿èšç„¦åº¦åˆ†æä¸å½±å“æ€§èƒ½ï¼Œåªæ˜¯ç®€å•çš„åˆ†æ•°æ¯”è¾ƒ

## ğŸ”® æœªæ¥æ”¹è¿›æ–¹å‘

1. **æ¦‚å¿µåº“è‡ªåŠ¨æ›´æ–°**ï¼šé›†æˆå®šæ—¶ä»»åŠ¡ï¼Œæ¯å‘¨è‡ªåŠ¨æ›´æ–°æ¦‚å¿µåº“
2. **ä¸»çº¿æŒç»­æ€§åˆ†æ**ï¼šè·Ÿè¸ªä¸»çº¿é¢˜æçš„å†å²è¡¨ç°
3. **æ¦‚å¿µå…³è”å›¾è°±**ï¼šæ„å»ºæ¦‚å¿µä¹‹é—´çš„å…³è”å…³ç³»
4. **AI ç­–ç•¥ä¼˜åŒ–**ï¼šæ ¹æ®ä¸»çº¿èšç„¦åº¦è‡ªåŠ¨è°ƒæ•´ä»“ä½å’Œç­–ç•¥

## ğŸ“¦ ä¿®æ”¹æ–‡ä»¶æ¸…å•

- `logic/market_sentiment.py` - æ·»åŠ æ¦‚å¿µåº“è¿‡æœŸæé†’å’Œä¸»çº¿èšç„¦åº¦åˆ†æ
- `ui/dragon_strategy.py` - æ·»åŠ æ¦‚å¿µåº“è¿‡æœŸè­¦å‘Šæ˜¾ç¤º
- `test_v10_1_2.py` - æ–°å¢ V10.1.2 æµ‹è¯•è„šæœ¬

## âœ… å‡çº§å®Œæˆ

V10.1.2 ç‰ˆæœ¬å·²æˆåŠŸå®Œæˆæ‰€æœ‰é¢„å®šç›®æ ‡ï¼Œè§£å†³äº†æ•°æ®ç»´æŠ¤å’Œ AI åˆ¤æ–­èƒ½åŠ›ä¸¤ä¸ªå…³é”®é—®é¢˜ã€‚

**V10.1.2 ç»ˆæå¾®è°ƒå·²å®Œæˆï¼** ğŸ‰

- âœ… æ¦‚å¿µåº“è¿‡æœŸæé†’ï¼šè¶…è¿‡ 7 å¤©æ˜¾ç¤ºè­¦å‘Š
- âœ… ä¸»çº¿èšç„¦åº¦åˆ†æï¼šåˆ¤æ–­ä¸»çº¿åˆåŠ›å¼ºå¼±
- âœ… AI Context ä¼˜åŒ–ï¼šåŒ…å«å¸¦åˆ†æ•°çš„ä¸»çº¿ä¿¡æ¯
- âœ… è¿”å›ç»“æ„å‡çº§ï¼šè¿”å› (åå­—, åˆ†æ•°) è€Œä¸åªæ˜¯åå­—
- âœ… UI é›†æˆï¼šæ˜¾ç¤ºæ¦‚å¿µåº“è¿‡æœŸè­¦å‘Š

ç³»ç»Ÿç°åœ¨å…·å¤‡äº†å®Œæ•´çš„"ä¸€çœ¼çœ‹ç©¿å¸‚åœºä¸»çº¿"çš„èƒ½åŠ›ï¼ŒAI å¯ä»¥æ ¹æ®ä¸»çº¿èšç„¦åº¦è‡ªåŠ¨åˆ¤æ–­å¸‚åœºåˆåŠ›å¼ºå¼±ï¼