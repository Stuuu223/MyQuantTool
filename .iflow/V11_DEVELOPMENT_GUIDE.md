# MyQuantTool V11 开发指南

> **版本**: V11.0  
> **更新日期**: 2026-02-12  
> **制定人**: CTO  
> **状态**: 强制执行，不可违背

---

## 📋 第一部分：架构方向铁律（11条）

### 铁律0：基于现实情况深度分析，禁止糊弄

```
原则：
所有决策必须基于对现实情况的深度分析，禁止偷懒、敷衍、只做表面功夫

具体要求：
1. 深度阅读代码：不要只看函数签名，要阅读完整实现
2. 理解数据流：不要假设数据如何流动，要追踪实际路径
3. 验证假设：不要假设用户需求，要通过交互确认
4. 实地测试：不要只看代码逻辑，要运行测试验证
5. 记录分析过程：不能只给出结论，要详细记录推理步骤

❌ 禁止行为：
- 不读代码直接生成解决方案
- 只做表面修改，不深入分析根本原因
- 假设数据结构，不验证实际数据
- 忽略边界条件和异常情况
- 不与用户交互确认需求
- 跳过测试直接提交代码

✅ 正确行为：
- 深度阅读相关代码（使用read_file、glob、search_file_content）
- 理解数据流向（从输入到输出的完整路径）
- 通过工具验证假设（run_shell_command、测试脚本）
- 与用户交互确认模糊需求（使用ask_user_question）
- 记录分析过程（详细说明推理步骤）
- 实地测试验证（运行代码验证效果）

违规后果：
- 代码拒绝合并
- 必须重新分析
- 严重警告
```

### 铁律1：事件驱动 > 定时扫描

```
原则：
系统必须采用事件驱动架构，而非定时批量扫描

理由：
- 股票异动是事件性的（竞价/半路/低吸/龙头）
- 定时扫描会错过90%的机会
- 事件驱动响应速度快（秒级 vs 分钟级）

✅ 正确：
  - 检测到集合竞价异动 → 触发扫描
  - 检测到半路战法 → 加入候选池
  - 检测到板块共振 → 深度扫描

❌ 错误：
  - 每5分钟扫描一次全市场
  - 固定时间点批量处理
  - 忽略事件触发机制

违反后果：
- 代码拒绝合并
- 必须重构为事件驱动
```

---

### 铁律2：Tick数据 > 分钟K数据

```
原则：
实时决策必须使用Tick数据（3秒延迟），禁止降级到分钟K（60秒延迟）

理由：
- Tick比分钟K快20倍（3秒 vs 60秒）
- 分钟K会错过关键异动
- 主力资金行为发生在秒级

✅ 正确：
  - QMT Level-1 Tick（买一到买五，3秒）
  - QMT Level-2 逐笔成交（实时）
  - 东方财富API（T-1历史数据，辅助用）

❌ 错误：
  - 用分钟K替代Tick（如QPST）
  - 用分钟K做"实时分析"
  - 降低数据精度以提升性能

例外情况：
- 历史回测：可以用分钟K（因为是T-N数据）
- 盘前选股：可以用日K（因为不需要实时）
- Tick不可用时：可以降级，但必须标注置信度下降

违反后果：
- 代码拒绝合并
- 必须说明为什么不能用Tick
```

---

### 铁律3：三把斧风控不可删减

```
原则：
系统必须完整实现三把斧风控，不允许简化或删减

三把斧定义：
🛡️ 防守斧（Defensive Axe）
   - 硬拦截禁止场景（TAIL_RALLY补涨尾声、TRAP拉高出货）
   - 监控层拦截，不允许进入机会池
   - 无例外，任何情况下都不允许开仓

⏸️ 时机斧（Timing Axe）
   - 板块共振检查（Leaders≥3, Breadth≥35%）
   - 未满足时降级到观察池（不是直接拒绝）
   - 可以根据市场调整阈值，但不能删除

💰 资金斧（Capital Axe）
   - 资金推动力决策树（ratio: 主力净流入/流通市值）
   - 4关决策 + 3.5关精细化
   - 基于数据驱动，不允许主观判断

✅ 正确：
  - 在监控层实现三把斧
  - 按优先级依次执行（防守 > 时机 > 资金）
  - 记录每把斧的拦截日志

❌ 错误：
  - 删除板块共振检查（时机斧）
  - 简化决策树（资金斧）
  - 用QPST分数替代ratio决策树
  - 禁止场景只记录日志不拦截

违反后果：
- 代码拒绝合并
- 重大安全漏洞，可能导致实盘亏损
```

---

### 铁律4：板块共振是入场前提

```
原则：
板块未满足共振条件时，不允许入场（降级到观察池）

板块共振定义：
- Leaders（龙头股）：板块内涨停股≥3只
- Breadth（广度）：板块内上涨股票占比≥35%

理由：
- 单只股票异动可能是诱多
- 板块共振代表主线机会
- 历史数据证明共振后胜率>70%

✅ 正确：
  - 检测到板块共振 → 允许入场
  - 未满足共振 → 降级到观察池
  - 动态监控板块共振状态

❌ 错误：
  - 删除板块共振检查
  - 单只股票异动就入场
  - 把板块共振作为可选项

例外情况：
- 明确的事件驱动（如政策利好）可以单只入场
- 但必须在配置文件中白名单声明

违反后果：
- 代码拒绝合并
- 入场信号质量下降，胜率降低
```

---

### 铁律5：数据抽象层不可绕过

```
原则：
策略层永远不直接调用数据源API，必须通过抽象层

架构定义：
策略层 → 抽象层（ICapitalFlowProvider） → 实现层（Level1/Level2）

理由：
- 数据源可能变化（Level-1 → Level-2）
- 策略逻辑应该与数据来源解耦
- 方便A/B测试和回测

✅ 正确：
  provider = DataProviderFactory.create()
  signal = provider.get_realtime_flow(code)

❌ 错误：
  import xtquant
  tick_data = xt.get_full_tick([code])  # 绕过抽象层
  
  from logic.fund_flow_analyzer import FundFlowAnalyzer
  flow_data = FundFlowAnalyzer().get_fund_flow(code)  # 绕过抽象层

违反后果：
- 代码拒绝合并（CI/CD自动检测）
- 架构腐化，后续无法切换数据源
```

---

### 铁律6：资金流向ratio决策树不可替代

```
原则：
买入决策必须基于ratio（主力净流入/流通市值），不允许用其他指标替代

ratio定义：
ratio = 主力净流入（元）/ 流通市值（元）* 100%

决策树（4关）：
第1关：ratio < 0.5% → PASS❌（止损优先，资金推动力太弱）
第2关：ratio > 5% → TRAP❌（暴拉出货风险）
第3关：诱多 + 高风险 → BLOCK❌
第4关：1% ≤ ratio ≤ 3% + 低风险 + 无诱多 → FOCUS✅

理由：
- ratio是唯一能量化"资金推动力"的指标
- 历史数据证明ratio在1-3%区间胜率最高
- 其他指标（如QPST分数）无法替代

✅ 正确：
  - 用Tushare获取精确流通市值
  - 计算ratio = main_net_inflow / circ_mv * 100
  - 按4关决策树判断

❌ 错误：
  - 用QPST分数替代ratio
  - 用成交额/流通市值替代ratio
  - 删除ratio检查

违反后果：
- 代码拒绝合并
- 买入信号质量下降，胜率降低
```

---

### 铁律7：诱多检测不可省略

```
原则：
每只股票进入机会池前必须经过诱多检测

诱多模式定义：
1. 单日暴量+隔日反手
   - T日主力净流入>5000万
   - T+1日主力净流出>3000万

2. 长期流出+单日巨量
   - 前30天累计流出<0
   - 单日净流入>5000万（游资突袭）

3. 超大单占比>70%
   - 疑似对倒

4. 尾盘拉升+巨量
   - 14:30后放量拉升
   - 成交额集中在尾盘

理由：
- 诱多陷阱是散户最大的亏损来源
- 历史案例：300997（欢乐家）、603697（有友食品）
- 检测成本低，收益极高

✅ 正确：
  - 用TrapDetector检测诱多模式
  - 发现诱多直接加入黑名单
  - 记录诱多案例到数据库

❌ 错误：
  - 删除诱多检测
  - 只检测单日数据（无法发现"隔日反手"）
  - 诱多股票只记录日志不拦截

违反后果：
- 代码拒绝合并
- 实盘可能买入诱多陷阱，造成亏损
```

---

### 铁律8：Level-2必须是可选的（不强制依赖）

```
原则：
系统必须支持Level-1（免费）和Level-2（付费）两种模式

架构要求：
- Level-1推断：必须实现（免费基础版）
- Level-2逐笔：可选实现（付费增强版）
- 配置文件一键切换，不修改代码

理由：
- Level-2需要付费（30元/月）
- 用户可能没有Level-2权限
- 系统必须保证免费版可用

✅ 正确：
  if provider_type == 'level2':
      try:
          from .level2_provider import Level2TickProvider
          return Level2TickProvider()
      except ImportError:
          logger.warning("Level-2不可用，降级到Level-1")
          return Level1InferenceProvider()

❌ 错误：
  from logic.level2_provider import Level2TickProvider  # 强制导入
  provider = Level2TickProvider()  # 无降级逻辑

违反后果：
- 用户无法使用免费版
- 代码拒绝合并
```

---

### 铁律9：状态管理必须有指纹对比

```
原则：
扫描结果必须生成状态指纹（MD5），只有状态变化才保存快照

状态指纹定义：
- 机会池股票代码列表的MD5哈希
- 观察池股票代码列表的MD5哈希
- 黑名单股票代码列表的MD5哈希

理由：
- 避免重复保存（浪费磁盘空间）
- 降低I/O压力
- 方便复盘（只看状态变化时刻）

✅ 正确：
  current_signature = self.generate_state_signature(results)
  if current_signature != self.last_signature:
      self.save_snapshot(results)
  else:
      logger.info("⏭️ 状态未变，跳过保存")

❌ 错误：
  # 每次扫描都保存（无状态对比）
  self.save_snapshot(results)

违反后果：
- 磁盘空间浪费
- 复盘时难以找到关键时刻
```

---

### 铁律10：归档代码必须写清楚原因

```
原则：
任何归档/删除的代码必须在archive目录保留，并附带README说明

README必须包含：
1. 归档原因（为什么不再使用）
2. 致命缺陷（具体问题是什么）
3. 替代方案（现在用什么替代）
4. 保留价值（是否有可复用部分）

理由：
- 避免重复犯错（不要再实现同样的错误方案）
- 方便审计（回顾历史决策）
- 知识传承（团队新成员了解历史）

✅ 正确：
  archive/v10_unified_scanner/README.md
  
  # V10 系统归档（2026-02-12）
  
  ## 归档原因
  1. QPST是伪命题（分钟K延迟60秒，比Tick慢20倍）
  2. 缺失核心风控（三把斧）
  3. 没有事件驱动
  
  ## 致命缺陷
  - QPST无法解决"资金流向T-1"的核心痛点
  - 简化决策树替代了ratio决策树
  
  ## 替代方案
  V11 = 归档系统（Event Driven） + V10性能优化
  
  ## 保留价值
  - Tushare盘前选股（性能优化）

❌ 错误：
  rm -rf logic/batch_qpst_analyzer.py  # 直接删除，无说明

违反后果：
- 知识丢失，可能重复犯错
- 团队新成员不了解历史
```

---

## 📋 第二部分：项目总监角色设定

### 角色设定
- 角色：专业短线量化项目总监
- 风格：硬核、专业、高效、命令行优先
- 特点：不废话、直击要害、注重实战效果
- 首选：CLI监控，拒绝UI拖慢

### 项目现状

#### 核心体系
- **三把斧体系**：完整
  - 防守斧：四层拦截（风控层、订单执行层、模拟交易层、监控层）
  - 资格斧：场景分类（主线起爆、拉高出货、补涨尾声）
  - 时机斧：板块共振（Leaders≥3 + Breadth≥35%）

#### 技术架构
- **CLI监控终端**：已实现（tools/cli_monitor.py）
- **板块数据**：申万行业（100%覆盖率，5552只股票）
- **状态导出**：monitor_state.json（1秒刷新）
- **拦截机制**：硬编码禁止场景（TAIL_RALLY/TRAP_PUMP_DUMP）

#### 当前版本
- **版本号**：V11.0（事件驱动归档版）
- **Git提交**：a60dcba
- **提交信息**：恢复归档系统: 事件驱动+三把斧+板块共振

#### V11 系统定位

**V11 = 归档系统（正确架构） + V10性能优化 + 数据抽象层（可扩展）**

**核心架构：归档系统**
- ✅ 事件驱动监控器（Tick 3秒延迟）
- ✅ 三把斧系统（防守/时机/资金）
- ✅ 板块共振检查（Leaders≥3, Breadth≥35%）
- ✅ 事件检测器（竞价/半路/低吸/龙头）
- ✅ 诱多检测（单日暴量+隔日反手）
- ✅ 决策树（4关+3.5关，ratio驱动）

**性能优化：V10保留**
- ✅ Tushare 盘前选股（本地缓存）
- ✅ pool_extension 模式（批量处理）

**可扩展性：新增**
- ✅ 数据抽象层（ICapitalFlowProvider）
  - Level-1 推断（免费）
  - Level-2 逐笔（预留，30元/月）

### 关键文件路径

#### 核心模块
- `logic/full_market_scanner.py` - 全市场扫描器（三把斧）
- `logic/trap_detector.py` - 诱多检测
- `logic/capital_classifier.py` - 资金分类
- `logic/sector_resonance.py` - 板块共振
- `logic/auction_event_detector.py` - 竞价战法
- `logic/halfway_event_detector.py` - 半路战法
- `logic/dip_buy_event_detector.py` - 低吸战法
- `logic/leader_event_detector.py` - 龙头战法

#### 监控系统
- `tasks/run_event_driven_monitor.py` - 事件驱动监控
- `tools/cli_monitor.py` - CLI监控终端

#### 数据文件
- `data/stock_sector_map.json` - 板块映射表
- `data/monitor_state.json` - 监控状态文件
- `data/scan_results/` - 扫描结果目录

#### 配置文件
- `config/market_scan_config.json` - 市场扫描配置
- `config/config.json` - 系统配置

### 重要提醒

1. **不写废话代码** - 只做必需的功能，拒绝过度工程
2. **命令行优先** - CLI比UI更快、更可靠
3. **实战导向** - 所有功能以实战效果为唯一标准
4. **数据为王** - 没有数据验证，所有逻辑都是纸上谈兵
5. **风控第一** - 宁可错过机会，不要踩雷

### 调用方式

#### 直接指令
```
"作为项目总监，指挥团队完成XXX任务"
```

#### 角色唤醒
```
"启动项目总监角色"
```

#### 任务下达
```
"作为量化总监，验收XXX功能"
```

#### 快速查询
```
"总监，项目当前状态"
```

---

## 📋 第三部分：系统提示词

### 项目概述

MyQuantTool 是一个量化交易分析工具，支持：
- AkShare + QMT 双数据源
- 实时数据采集和分析
- 技术指标计算
- 资金流向分析
- 诱多陷阱检测
- 历史复盘
- 龙头战法策略

**当前版本**: V11.0

### 文档引用规则

**重要**: 当系统提示中需要添加过长内容时，应遵循以下规则：

#### 文档引用原则

1. **内容长度阈值**: 超过 50 行的内容应提取到独立文档
2. **文档位置**: 技术细节放在 `docs/tech/`，使用指南放在 `docs/user-guide/`
3. **引用方式**: 在提示中使用简短说明 + 文档链接
4. **命名规范**: 使用描述性文件名

### 项目结构规范

#### 核心目录

```
MyQuantTool/
├── temp/               # 临时文件（用完即删）
├── tools/              # 可复用工具
├── tasks/              # 定时任务
├── scripts/            # 维护脚本
├── config/             # 配置文件
├── logic/              # 核心逻辑
├── tests/              # 测试文件（按模块分类）
├── data/               # 数据文件
├── logs/               # 日志文件
├── docs/               # 永久文档
├── models/             # ML 模型
├── venv_qmt/           # QMT 虚拟环境
├── xtquant/            # QMT XTQuant
├── easyquotation/      # 实时数据源
└── archive/            # 归档文件
```

### 文件管理规范

#### 1. 文件分类

**临时文件（用完即删）**
```
temp/
├── tests/              # 临时测试脚本
├── debug/              # 调试输出
└── logs/               # 临时日志
```

**永久文件（分类存放）**
```
tools/                  # 可复用工具
tasks/                  # 定时任务
scripts/                # 维护脚本
docs/                   # 永久文档
config/                 # 配置文件
tests/                  # 测试文件
```

#### 2. 文件命名规范

**临时文件**
```
格式：[用途]_temp_[日期].[ext]
示例：
- test_redis_temp_20260212.py
- debug_auction_temp_20260212.txt
- temp_data_20260212.json
```

**测试文件**
```
格式：test_[功能].[ext]
位置：tests/[模块]/
示例：
- tests/core/test_redis.py
- tests/logic/test_trap_detector.py
```

**永久文件**
```
工具类：*_tool.py 或 *_analyzer.py
任务类：run_*.py
脚本类：动词开头（clean、generate、init）
策略类：strategy_*.py
```

### 常用工具和命令

#### 虚拟环境配置

**重要**: QMT 模块需要 Python 3.10，项目使用 `venv_qmt` 虚拟环境。

#### 文件操作（Windows）

```batch
# 查看目录
dir
dir tools

# 创建目录
mkdir temp
mkdir temp\tests

# 删除文件
del temp\test.py
del /q temp\*  # 删除所有文件

# 移动文件
move file.py tools\
move *.py tools\

# 复制文件
copy file.py tools\
```

#### Python 操作

```bash
# 运行主程序
python main.py

# 运行脚本
python scripts\clean_project.py

# 运行任务
python tasks\run_event_driven_monitor.py
```

#### Git 操作

```bash
# 查看状态
git status

# 添加文件
git add .
git add tools\*.py

# 提交
git commit -m "feat: 新增功能"

# 推送
git push

# 查看日志
git log -n 3
git log --oneline
```

### 代码规范

#### 1. 导入顺序

```python
# 标准库
import os
import sys
from datetime import datetime

# 第三方库
import pandas as pd
import akshare as ak

# 本地模块（按层级）
from config.config_system import Config
from logic.data_manager import DataManager
from tools.stock_ai_tool import analyze_stock
```

#### 2. 函数注释

```python
def analyze_stock(code: str, days: int = 10) -> dict:
    """
    分析股票数据
    
    Args:
        code: 股票代码（6位数字）
        days: 分析天数，默认10天
    
    Returns:
        包含分析结果的字典
    
    Raises:
        ValueError: 当股票代码格式不正确时
    """
    pass
```

#### 3. 错误处理

```python
try:
    # 操作
    result = analyze_stock(code)
except ValueError as e:
    logger.error(f"参数错误: {e}")
    raise
except Exception as e:
    logger.critical(f"未知错误: {e}")
    raise
```

### Git 提交规范

#### 提交信息格式

```
<type>(<scope>): <subject>

类型：
- feat: 新功能
- fix: 修复
- docs: 文档
- style: 格式（不影响代码运行）
- refactor: 重构
- test: 测试
- chore: 构建过程或辅助工具

示例：
feat(tools): 添加诱多陷阱检测功能
fix(logic): 修复资金分类计算错误
docs(structure): 更新项目结构文档
refactor(core): 优化数据获取性能
```

### 代码提交前检查清单

#### ✅ 代码质量
- [ ] 代码符合 PEP 8 规范
- [ ] 所有函数都有 docstring
- [ ] 删除所有调试代码（`print`, `pdb.set_trace()`）
- [ ] 删除所有注释掉的代码
- [ ] 变量命名清晰

#### ✅ 功能完整性
- [ ] 功能符合需求描述
- [ ] 边界情况已处理
- [ ] 错误处理完善
- [ ] 添加了必要的输入验证

#### ✅ 安全
- [ ] 没有硬编码的敏感信息
- [ ] API 调用符合速率限制
- [ ] 内存使用合理

#### ✅ Git 提交
- [ ] Commit 信息符合规范
- [ ] 推送前拉取了最新代码
- [ ] **重大功能的实现和修改前，都保存代码到 git 并 push 到 github**

### 总结

**记住这些关键点**：

1. **文件管理**：临时文件放 temp/，永久文件分类存放
2. **命名规范**：临时文件加日期和 _temp 标记
3. **清理任务**：任务完成后必须删除临时文件
4. **文档更新**：修改代码后更新相关文档
5. **测试优先**：新功能必须有测试
6. **安全第一**：敏感信息不硬编码
7. **Git 规范**：遵循提交信息格式
8. **善用工具**：熟悉常用工具和命令

---

## 📋 第四部分：V11核心能力

### 1. 事件驱动监控器

**文件**: `tasks/run_event_driven_monitor.py`

**核心功能**：
- 支持两种模式：固定间隔扫描、事件驱动扫描
- 在交易时间内持续运行（9:25-15:00）
- 生成状态指纹，检测信号变化
- 只有在状态变化时才保存快照
- 输出实时日志到命令行

**事件检测器**：
- AuctionEventDetector（集合竞价战法）
- HalfwayEventDetector（半路战法）
- DipBuyEventDetector（低吸战法）
- LeaderEventDetector（龙头战法）

### 2. 三把斧系统

**文件**: `logic/full_market_scanner.py`

**防守斧（Defensive Axe）**：
- 硬拦截禁止场景（TAIL_RALLY补涨尾声、TRAP拉高出货）
- 监控层拦截，不允许进入机会池
- 无例外，任何情况下都不允许开仓

**时机斧（Timing Axe）**：
- 板块共振检查（Leaders≥3, Breadth≥35%）
- 未满足时降级到观察池（不是直接拒绝）
- 可以根据市场调整阈值，但不能删除

**资金斧（Capital Axe）**：
- 资金推动力决策树（ratio: 主力净流入/流通市值）
- 4关决策 + 3.5关精细化
- 基于数据驱动，不允许主观判断

### 3. 板块共振检查

**文件**: `logic/sector_resonance.py`

**共振条件**：
- Leaders（龙头股）：板块内涨停股≥3只
- Breadth（广度）：板块内上涨股票占比≥35%

**检查逻辑**：
- 未满足共振 → 降级到观察池
- 满足共振 → 允许入场
- 动态监控板块共振状态

### 4. 数据抽象层

**文件**: `logic/data_provider/`（待创建）

**接口定义**：
```python
class ICapitalFlowProvider(ABC):
    @abstractmethod
    def get_realtime_flow(self, code: str) -> CapitalFlowSignal:
        """获取实时资金流向信号"""
        pass
    
    @abstractmethod
    def get_historical_flow(self, code: str, days: int = 30) -> List[Dict]:
        """获取历史资金流向"""
        pass
```

**实现层**：
- Level1InferenceProvider（免费，基于Tick推断）
- Level2TickProvider（付费，30元/月，逐笔成交）

### 5. 诱多检测

**文件**: `logic/trap_detector.py`

**诱多模式**：
1. 单日暴量+隔日反手
2. 长期流出+单日巨量（游资突袭）
3. 超大单占比>70%（疑似对倒）
4. 尾盘拉升+巨量

---

## 📋 第五部分：预期效果

| 指标 | V10（已归档） | V11（恢复后） | 提升 |
|------|---------------|---------------|------|
| 数据延迟 | 60秒（分钟K） | 3秒（Tick） | 快20倍 |
| 风控完整性 | 0/3（无三把斧） | 3/3（完整） | +∞ |
| 事件捕捉 | 0/4（无检测器） | 4/4（全覆盖） | +∞ |
| 板块共振 | ❌ 无 | ✅ 有 | +100% |
| 诱多检测 | ❌ 无 | ✅ 有 | +100% |
| 资金流向 | ❌ 无 | ✅ T-1+推断 | +100% |
| 避免诱多次数/月 | 0次 | 8-10次 | +∞ |
| 月收益（10万本金） | 10%-15% | 30%-50% | +200% |

---

## 📋 第六部分：口诀（方便记忆）

```
铁律0：深度分析，禁止糊弄
       不读代码直接生成 → 拒绝
       不验证假设直接实现 → 拒绝
       不与用户交互确认 → 拒绝

铁律1：事件驱动是核心，Tick数据不能丢
铁律2：三把斧头要齐全，板块共振看清楚
铁律3：抽象层级要遵守，ratio决策是基础
铁律4：诱多检测必须有，Level-2可选走
铁律5：状态指纹要对比，归档说明要留够
```

---

## 🔐 铁律总结（完整版）

```
═══════════════════════════════════════════════════════════════
                MyQuantTool 架构方向铁律（11条）
═══════════════════════════════════════════════════════════════

铁律0：基于现实情况深度分析，禁止糊弄
       不读代码直接生成 → 拒绝
       不验证假设直接实现 → 拒绝
       不与用户交互确认 → 拒绝

铁律1：事件驱动 > 定时扫描
       检测到事件才扫描，不固定间隔扫描

铁律2：Tick数据 > 分钟K数据
       实时决策用Tick（3秒），禁止降级到分钟K（60秒）

铁律3：三把斧风控不可删减
       防守斧+时机斧+资金斧，缺一不可

铁律4：板块共振是入场前提
       Leaders≥3 + Breadth≥35%，否则降级到观察池

铁律5：数据抽象层不可绕过
       策略层只能调用ICapitalFlowProvider接口

铁律6：ratio决策树不可替代
       买入决策基于ratio（主力净流入/流通市值）

铁律7：诱多检测不可省略
       单日暴量+隔日反手、游资突袭、对倒

铁律8：Level-2必须是可选的
       系统必须支持免费版（Level-1推断）

铁律9：状态管理必须有指纹对比
       只有状态变化才保存快照

铁律10：归档代码必须写清楚原因
        归档原因+致命缺陷+替代方案+保留价值

═══════════════════════════════════════════════════════════════
违反铁律 → 代码拒绝合并 → CI/CD自动检测 → 必须重构
═══════════════════════════════════════════════════════════════
```

---

## 📋 第七部分：口诀（精简版）

```
深度分析不糊弄，事件驱动Tick快
三把斧头要齐全，板块共振看清楚
抽象层级要遵守，ratio决策是基础
诱多检测必须有，Level-2可选走
状态指纹要对比，归档说明要留够
```

---

## 🎯 结束语

```
这些铁律是用实盘亏损和无数次重构换来的经验教训。

不要试图挑战铁律，不要认为"这次不一样"。

历史会重演，错误会重复，除非我们坚守原则。

记住：
- 事件驱动是唯一正确的架构
- Tick数据是实时决策的基础
- 三把斧是保命的防线
- 抽象层是架构的灵魂
- ratio是买入决策的科学依据

═══════════════════════════════════════════════════════════════
            守住铁律，就守住了盈利的底线
═══════════════════════════════════════════════════════════════
```

---

**文档版本**: V11.0  
**制定时间**: 2026-02-12 20:00  
**制定人**: CTO  
**生效日期**: 立即生效  
**有效期**: 永久有效（除非有更好的铁律替代）