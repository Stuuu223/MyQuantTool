# V20.0 极致全息架构 - 需求确认与执行计划

## Boss与CTO深度对话核心决策

### 1. 数据分级管理战略（已确认）

| 数据类型 | 策略 | 实现方式 |
|---------|------|---------|
| **日K** | 全市场下载，几年都没问题 | 每天自动检测补全，非交易时间静默补齐 |
| **Tick** | 不能浪费在杂毛上 | 精准靶向下载，每天100-150只 |

### 2. Tick下载标准 - 镜像降维法（关键参数确认）

**来源**：CTO最终提案，Boss认可

| 条件 | 实盘标准 | 下载标准（镜像降维） | 原理 |
|------|---------|-------------------|------|
| **量比** | 0.95分位（前5%） | **0.90分位（前10%）** | 放宽0.05，捕获"准真龙"和"陷阱股" |
| **换手率** | min_active_turnover_rate | **直接使用3.0%** | 与实盘一致，不拍脑袋 |
| **价格** | - | **high > pre_close** | 只要今天最高价红过，包含诱多/真龙 |
| **一字板** | 实盘过滤 | **下载保留** | 作为陷阱样本训练防线 |

**预期结果**：每天100-150只股票，既包含真龙也包含陷阱，作为三道防线的"错题本"

### 3. 日K自动补全机制（待开发）

**触发条件**：
- 非交易时间（当前不在09:30-15:00）
- 系统启动时自动检测
- 发现缺失立即静默补齐

**技术实现**：
```python
# main.py启动时或独立守护任务
def auto_check_and_download_daily_k():
    if not is_trading_time():
        missing_dates = check_missing_daily_k()
        for date in missing_dates:
            download_daily_k(date)  # 静默补全
```

### 4. 严禁Magic Number（CTO铁律）

**必须从ConfigManager读取**：
```python
config = get_config_manager()
live_sniper = config.get('live_sniper', {})

volume_ratio_percentile = live_sniper.get('volume_ratio_percentile', 0.95)  # 实盘0.95
download_volume_ratio = volume_ratio_percentile - 0.05  # 下载0.90

turnover_min = live_sniper.get('min_active_turnover_rate', 3.0)  # 直接使用3.0%
```

### 5. 下载记录生成（高级错题本）

**每次下载生成**：
```json
// data/holographic_target_YYYYMMDD.json
{
  "date": "20260224",
  "filter_criteria": {
    "volume_ratio_percentile": 0.90,
    "min_turnover_rate": 3.0,
    "price_condition": "high > pre_close"
  },
  "target_stocks": [
    {"code": "000001.SZ", "volume_ratio": 2.5, "turnover": 5.2, "max_change": 8.5},
    // ... 约100-150只
  ],
  "statistics": {
    "total_scanned": 5191,
    "selected": 128,
    "limit_up_count": 15,
    "trap_count": 23
  }
}
```

---

## 总监执行计划

### Phase A1 ✅ 已完成
- 肃清true_dictionary.py Tushare残留
- 已验证语法通过

### Phase A2 待启动：重构全息下载器
**任务**：
1. 实现镜像降维过滤算法（0.90分位 + 3%换手 + high>pre_close）
2. 实现上下文切片下载（前30后30天）
3. 生成target_pool_YYYYMMDD.json记录

### Phase A3 待启动：升级三道防线
**任务**：
1. 基于Tick五档数据的微观防线
2. 诱多撤单检测（托单撤走>70%）
3. 散户跟风检测（小单占比>80%）
4. 封单衰减检测（1分钟衰减>50%）

### Phase A4 待启动：重构TimeMachineEngine
**任务**：
1. 两段式混合架构
2. 阶段1：向量化极速定位起爆点
3. 阶段2：事件驱动逐笔模拟

### Phase A5 待启动：测试验证
**任务**：
1. 真实数据验证下载算法
2. 验证微观防线有效性
3. 性能基准测试

---

## 待确认事项（向Boss请示）

### 1. Phase A1提交确认
当前true_dictionary.py已清理Tushare残留，是否立即提交到GitHub？

### 2. 关键参数最终确认
| 参数 | CTO提案 | 请Boss确认/修改 |
|------|---------|----------------|
| 量比降维 | 实盘0.95 → 下载0.90 | ? |
| 换手率 | 直接使用3.0% | ? |
| 价格条件 | high > pre_close | ? |
| 上下文天数 | 前30后30（共60天） | ? |

### 3. 开发节奏
- 方案A：先提交A1，再并行开发A2-A4（推荐，稳扎稳打）
- 方案B：A1-A4全部完成一起提交（风险高，改动大）

---

## 总监意见

**推荐方案A**：
1. 立即提交Phase A1（已验证通过）
2. 派遣Subagent并行开发A2-A4
3. 每完成一个Phase就测试验证
4. 最后统一提交A2-A4

**理由**：
- 降低风险，避免大规模改动
- 每个Phase独立可验证
- 便于Boss和CTO阶段性审查

**等待Boss拍板后开始执行！**
