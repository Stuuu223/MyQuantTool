---
title: MyQuantTool Development Paradigm
version: V1.0.0
updated: 2026-02-19
scope: 全体 AI / 开发参与者
author: CTO
---

# MyQuantTool 开发范式（DEVELOPMENT_PARADIGM）

> 本文是 MyQuantTool 项目的**唯一**开发范式与协作规范文档，约束所有 AI Agent 与人工开发者的行为。  
> 业务 / 策略 / 架构细节仍以 `docs/KNOWLEDGE_BASE_V17.md` 与 `docs/CORE_ARCHITECTURE_V17.md` 为准。

---

## 0. 目标与适用范围

本范式解决的问题：

1. 写完东西**没人自测**。
2. 旧脚本 / 旧模块**无人负责收尾**。
3. 老板已经点名要砍 / 要改的内容，**最后被忽略**。

适用范围：

- 所有对仓库产生**代码 / 配置 / 文档**改动的行为（无论是 AI 还是人类）；
- 尤其是涉及核心模块（资金流抽象、策略服务、Portfolio、知识库与架构文档）的改动。

核心原则只有一句话：**不按本范式走完流程的改动，一律视为"不合格"，即使代码本身看起来没 bug。**

---

## 1. 角色分工与边界

### 1.1 老板（资金所有者）

职责：

- 定义整体战略目标：小资金右侧起爆、账户曲线优先、本地私有化、不服务外部客户。
- 设定非谈判红线：
  - 禁止硬编码绝对阈值（资金强度、比例等）。
  - 禁止用过期数据做盘中决策。
  - 禁止策略绕过 Portfolio / 抽象层直接下单或直接碰 QMT / AkShare。
- 最终拍板重大取舍：
  - 是否引入 / 废弃某类战法或资金路线；
  - 是否接受兼容性破坏以换取架构纯净。

**不负责**：具体实现细节、函数名 / 文件名、代码风格等。

---

### 1.2 CTO

职责：

- 定义并维护系统整体架构、分层与抽象：
  - 资金流抽象：`ICapitalFlowProvider` 及其实现与降级链。
  - 三漏斗扫描架构与事件驱动主线。
  - Portfolio 层（资金调度、仓位管理、换仓决策）。
  - 数据源优先级与使用场景（QMT Tick / AkShare DDE / Tushare 等）。
- 维护权威文档的一致性与正确性：
  - `docs/KNOWLEDGE_BASE_V17.md`：业务 / 策略 / 战法 / 数据源总纲。
  - `docs/CORE_ARCHITECTURE_V17.md`：架构技术总览。
  - `docs/V17_TECH_DEBT.md`：技术债与裁决变更记录。
- 作为 **PR 最终闸门**：
  - 发现违反架构红线 / 抽象层绕过 / 文档不一致等问题，必须打回。

**禁止**下放的权限：

- 任何对核心抽象 / 资金路线 / 战法逻辑的变更，都不能完全交给 AI 自行决定，必须由 CTO 明确在"设计卡"中批准。

---

### 1.3 iFlow 总监（调度 / 节奏 Owner）

职责：

- 将老板与 CTO 的决策转化为**可执行的开发任务**：
  - 维护 PROGRESS.md 中的任务列表与进度状态。
  - 拆分任务为"需求卡 / 设计卡 / 实现任务"。
- 调度各类 Agent 与开发者：
  - 指定某一轮由哪个 AI 项目总监负责哪个子域（如：资金流 Provider 重构、文档精简、回测统一）。
  - 控制节奏和优先级：先清理技术债，再引入新特性。
- 维护对老板 / CTO 的汇报：
  - 哪些红线已落入代码与文档；
  - 哪些仍停留在想法或局部实现。

**禁止**行为：

- 擅自更改战略目标（例如增加"长线低换手主战策略"）；
- 推翻 CTO 已定的架构红线（例如允许新的直连 AkShare 资金流函数出现在生产路径）。

---

### 1.4 AI 项目总监（子任务 Owner）

职责：

- 在给定约束与架构下，负责**某个子任务的端到端交付设计**，例如：
  - "资金流路线 A 落地（QMT Tick 为主，AkShare DDE 为辅）"；
  - "文档精简至 5 份核心文档"；
  - "回测入口统一 + Tick/分 K 回放整理"。
- 为每个子任务产出：
  - 设计卡（目录结构变化、抽象使用方式、要删 / 要迁移的文件）；
  - 实现影响范围说明（哪些模块会变、哪些保持不动）；
  - 需要人工确认的风险点（如：删除脚本是否有外部依赖）。

**不得**：

- 引入新的架构层 / 抽象 / 资金路线而未经 CTO 设计卡批准；
- 修改老板已定的红线（如允许硬编码阈值）。

---

### 1.5 AI 开发专家（实现与自测）

职责：

- 按照设计卡编写代码、单元测试、脚本与文档更新。
- 为每个改动提供：
  - 清晰的代码 diff；
  - 可重复的最小自测记录（命令 + 期望结果）；
  - PROGRESS.md / 技术债文档中的简要更新。

**禁止**行为：

- 在没有设计卡 / 明确任务描述的情况下，擅自对核心模块做结构性变更；
- 不写自测 / 不更新 PROGRESS 就宣称"任务完成"。

---

## 2. 开发流水线（四步必经）

> 任何中等以上（涉及核心文件 / 数据源 / 回测入口 / 文档结构）的改动，**必须**走完以下四步；
> 小改动（纯注释 / 打印 / 临时日志）可酌情缩减，但不得违反红线。

### Step 1：需求卡（由老板 / CTO 发起）

内容要素：

1. 背景与目标：
   - 例："将资金流路线 A 真正接入 FullMarketScanner 的实时决策路径"。
2. 影响范围（初步预估）：
   - 涉及模块：例如 `logic/data_providers/*`, `logic/strategies/full_market_scanner.py`。
3. 红线与约束：
   - 禁止新增直连 AkShare 资金流 API 的生产代码；
   - 必须通过 `ICapitalFlowProvider` 工厂选择 Provider。

落地方式：

- 在 PROGRESS.md 中新增一条任务，标记"[需求]"，简要写明上述三点。

---

### Step 2：设计卡（CTO + AI 项目总监）

内容要素：

1. 目录与模块变化：
   - 哪些文件会被创建 / 修改 / 删除；
   - 哪些旧脚本会被废弃（必须列出完整清单）。
2. 抽象与接口使用方式：
   - 如何使用 / 扩展 `ICapitalFlowProvider` 及其工厂；
   - FullMarketScanner 与回测引擎分别使用哪种 Provider（live / replay）。
3. 数据源与模式：
   - 实时模式：QMT Tick → Level2/Level1/QmtTick Provider；
   - 回放 / 回测模式：QmtTick 历史 → DongCai T-1 Provider。
4. 最小自测计划：
   - 至少 1–2 条命令行，说明要如何验证"新路径真正生效"。

落地方式：

- 在 PROGRESS.md 的该任务下，增加"[设计]"小节，写入上面 4 个要素。
- 设计卡未写明"要删除的脚本清单"时，**不得**声称完成清理类任务。

---

### Step 3：实现 + 自测（AI 开发专家）

要求：

1. 代码实现必须严格遵守设计卡，不得自发扩展任务范围；
2. 必须提供最小自测记录，至少包括：
   - 执行的命令（含参数示例）；
   - 关键日志 / 输出特征（用简短文字描述，不需要整段 log）；
   - 关注点（例如资金流 Provider 实际选用的是 QmtTick 而非 DongCai）。

自测记录的推荐格式（可写在 PROGRESS.md 或 PR 描述中）：

```markdown
### 自测记录

1. 命令：
   - `python backtest/run_hot_cases_suite.py --case wanzhu`
2. 观察：
   - 日志中可见 `QmtTickCapitalFlowProvider` 被选为资金流 Provider；
   - 未出现 AkShare DDE 实时调用。
3. 结果：
   - 运行完成，无异常退出。
```

**没有自测记录的改动，一律视为未完成实现。**

---

### Step 4：CTO 审计与收尾

CTO 审查的 checklist（必须逐项过一遍）：

1. **架构与抽象是否合规**：
   - 资金流调用是否全部通过 ICapitalFlowProvider / 工厂，不再有直连 QMT / AkShare 的生产路径。
   - 是否在错误的层使用了数据源（例如策略层直接调用 Provider）。
2. **设计卡执行情况**：
   - 设计卡中列出的待删除脚本 / 模块是否实际删除；
   - 未列出的删除行为是否有额外说明与老板确认。
3. **自测是否可信**：
   - 命令是否覆盖关键路径；
   - 是否对关键行为（如数据源选择、降级链）做了检查。
4. **文档与 PROGRESS 是否更新**：
   - 知识库 / 架构文档是否需要同步修订；
   - PROGRESS 任务条目标记为"完成"前，这四点必须全部满足。

**若任一项未通过，CTO 必须将任务标为"部分完成"或打回 PR，不得在 PROGRESS 上标记"已完成"。**

---

## 3. 红线与越权判定

### 3.1 涉及 CTO 必须批准的改动

以下任一类改动，若未在设计卡中获得 CTO 明确批准，则视为 AI 越权：

1. **修改 / 新增抽象层接口与数据路由**：
   - `logic/data_providers/base.py`（ICapitalFlowProvider 接口定义）。
   - `logic/data_providers/factory.py`（Provider 工厂与降级链）。
   - 各 Provider 实现文件（Level2 / Level1 / QmtTick / DongCai 等）。
2. **修改 Facade / Service 层**：
   - `logic/services/` 下统一入口（StrategyService / ConfigService / RiskService 等）。
3. **修改 Portfolio 层核心逻辑**：
   - `logic/portfolio/` 下的仓位分配、断层优势、持仓 vs 候选 PK 规则。
4. **修改权威文档**：
   - `docs/KNOWLEDGE_BASE_V17.md`；
   - `docs/CORE_ARCHITECTURE_V17.md`；
   - `docs/V17_TECH_DEBT.md`。

### 3.2 涉及老板必须拍板的改动

以下行为只能在老板决策后执行，否则视为严重越权：

1. **删除任何脚本 / 模块**（包括 tools / tasks / backtest 下的脚本）；
2. **调整资金流路线**：
   - 改变"QMT Tick 为主、AkShare DDE T+1 为辅"的既定路线；
   - 调整 ICapitalFlowProvider 降级链顺序。
3. **引入 / 废弃战法主线或大幅修改战法逻辑**：
   - 半路 / 龙头 / 时机斧的目标标的、涨幅区间、三漏斗条件；
   - 防守斧 / 资金斧 / 时机斧的强制条件与退出规则。

### 3.3 越权的具体现象

满足以下任一条，即可认定为"AI 越权，需要人工介入"：

1. diff 中修改了 3.1 / 3.2 中列出的文件或语义，但：
   - 设计卡中未提及；
   - 或 PR 描述 / commit 模板中勾选了"未涉及核心文件 / 战略"。
2. 自行引入新的数据源路线 / 抽象层 / 战法逻辑，却没有：
   - 在知识库 / 架构文档中挂条目；
   - 在 V17_TECH_DEBT 中记录该裁决。
3. 在未获得老板决策的情况下删除脚本 / 模块，并试图通过"技术清理"名义掩盖。

**一旦判定越权，iflow 总监和 CTO 必须中断当前自动流程，要求人工审查并写入 PROGRESS / V17_TECH_DEBT 说明原因与处置结果。**

---

## 4. 模板附录

### 4.1 需求卡模板（写入 PROGRESS）

```text
## [任务标题] 需求卡

- 背景：
- 目标：
- 影响范围（目录 / 模块）：
- 红线约束：
  - …
  - …
- 发起人：老板 / CTO
- 创建日期：YYYY-MM-DD
```

### 4.2 设计卡模板

```text
## [任务标题] 设计卡

### 1. 目录与模块变更
- 新增：
- 修改：
- 删除（必须列清单）：

### 2. 抽象与接口使用
- ICapitalFlowProvider 使用方式：
- Provider 选择逻辑（live / replay）：

### 3. 数据源与模式
- 实时模式：
- 回放 / 回测模式：

### 4. 最小自测计划
- 命令：
- 关键观察点：
```

### 4.3 自测记录模板

```text
## [任务标题] 自测记录

1. 命令：
   - …
2. 观察：
   - …
3. 结果：
   - …
4. 额外检查：
   - 是否命中核心逻辑（资金流 / Portfolio / 回测路径等）
```

### 4.4 CTO 审计 checklist

```text
## [任务标题] CTO 审计

- [ ] 抽象与架构符合范式（无绕过 ICapitalFlowProvider）
- [ ] 设计卡列出的删除 / 迁移操作全部执行
- [ ] 自测覆盖关键路径，输出合理
- [ ] 知识库 / 架构文档 / 技术债记录已更新（如有需要）
- [ ] PROGRESS 任务状态更新为"完成"/"部分完成"并注明原因

- 审计人：CTO
- 日期：YYYY-MM-DD
```

---

## 5. 版本与维护

本文档由 CTO 负责维护与裁决更新。

任何对本范式的修改，必须：

1. 在 V17_TECH_DEBT.md 中记录"开发范式变更"条目；
2. 在 PROGRESS.md 中新增一次"开发制度更新"任务；
3. 明确说明对现有流程 / 角色分工的影响。

**默认规则**：如果知识库 / 架构文档与本范式在开发流程与角色边界上出现冲突，以本范式的最新版本为准。
