# MyQuantTool é¡¹ç›®ä¼˜åŒ–å»ºè®®

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æ¡£åˆ—å‡ºäº† MyQuantTool é¡¹ç›®çš„ä¼˜åŒ–å»ºè®®ï¼ŒæŒ‰ä¼˜å…ˆçº§åˆ†ä¸ºç«‹å³ã€çŸ­æœŸã€ä¸­æœŸå’Œé•¿æœŸå››ä¸ªé˜¶æ®µã€‚

---

## ğŸ”´ ç«‹å³åšï¼ˆé«˜ä¼˜å…ˆçº§ï¼‰

### 1. æ¸…ç†ä¸´æ—¶æ–‡ä»¶ â­â­â­â­â­
**é—®é¢˜**ï¼š
- é¡¹ç›®æ ¹ç›®å½•æœ‰å¤§é‡ä¸´æ—¶æ–‡ä»¶ï¼ˆfix_*.py, rewrite_*.py, append_*.pyç­‰ï¼‰
- è¿™äº›æ–‡ä»¶ä¸åº”è¯¥æäº¤åˆ°ç‰ˆæœ¬æ§åˆ¶

**å»ºè®®**ï¼š
```gitignore
# Temporary files
fix_*.py
rewrite_*.py
append_*.py
complete_*.py
safe_*.py
simple_*.py
main_backup.py
main_*.py
build_project.py
*.patch
ä¿®å¤æŒ‡å—.md
```

**é¢„æœŸæ”¶ç›Š**ï¼š
- å‡å°‘ä»“åº“ä½“ç§¯
- æé«˜ä»£ç å¯è¯»æ€§
- é¿å…æ··æ·†

---

### 2. ä¿®å¤ Streamlit å¼ƒç”¨è­¦å‘Š â­â­â­â­â­
**é—®é¢˜**ï¼š
- å¤§é‡ä½¿ç”¨ `use_container_width=True`ï¼Œå°†åœ¨ 2025-12-31 åç§»é™¤
- æ¯æ¬¡è¿è¡Œéƒ½ä¼šäº§ç”Ÿè­¦å‘Šä¿¡æ¯

**å»ºè®®**ï¼š
```python
# æ—§ä»£ç 
st.dataframe(df, use_container_width=True)

# æ–°ä»£ç 
st.dataframe(df, width="stretch")

# æˆ–è€…
st.dataframe(df, width="content")  # ä¸æ‹‰ä¼¸
```

**æ‰¹é‡æ›¿æ¢è„šæœ¬**ï¼š
```python
import re

# è¯»å–æ–‡ä»¶
with open('main.py', 'r', encoding='utf-8') as f:
    content = f.read()

# æ›¿æ¢
content = content.replace('use_container_width=True', 'width="stretch"')
content = content.replace('use_container_width=False', 'width="content"')

# å†™å›æ–‡ä»¶
with open('main.py', 'w', encoding='utf-8') as f:
    f.write(content)
```

**é¢„æœŸæ”¶ç›Š**ï¼š
- æ¶ˆé™¤æ§åˆ¶å°è­¦å‘Š
- ç¬¦åˆ Streamlit æœ€æ–°è§„èŒƒ
- ä¸ºæœªæ¥å‡çº§åšå‡†å¤‡

---

## ğŸŸ¡ çŸ­æœŸä¼˜åŒ–ï¼ˆä¸­ä¼˜å…ˆçº§ï¼‰

### 3. æ·»åŠ æ—¥å¿—ç³»ç»Ÿ â­â­â­â­â­
**é—®é¢˜**ï¼š
- ç¼ºå°‘ç»Ÿä¸€çš„æ—¥å¿—ç³»ç»Ÿ
- è°ƒè¯•å›°éš¾ï¼Œé”™è¯¯è¿½è¸ªä¸ä¾¿
- æ— æ³•è®°å½•ç”¨æˆ·æ“ä½œå’Œæ•°æ®è·å–å†å²

**å»ºè®®**ï¼š
```python
# åœ¨ config.py æˆ–æ–°å»º logger.py ä¸­
import logging
import sys
from pathlib import Path

# é…ç½®æ—¥å¿—ç³»ç»Ÿ
log_dir = Path("logs")
log_dir.mkdir(exist_ok=True)

logging.basicConfig(
    level=logging.INFO,
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s',
    handlers=[
        logging.FileHandler(log_dir / 'app.log', encoding='utf-8'),
        logging.StreamHandler(sys.stdout)
    ]
)

logger = logging.getLogger(__name__)

# ä½¿ç”¨ç¤ºä¾‹
logger.info(f"è·å–è‚¡ç¥¨æ•°æ®: {symbol}")
logger.error(f"æ•°æ®è·å–å¤±è´¥: {symbol}", exc_info=True)
logger.warning(f"ç¼“å­˜è¿‡æœŸ: {symbol}")
```

**é¢„æœŸæ”¶ç›Š**ï¼š
- ä¾¿äºé—®é¢˜æ’æŸ¥
- è®°å½•ç”¨æˆ·è¡Œä¸º
- ç›‘æ§ç³»ç»Ÿå¥åº·çŠ¶æ€

---

### 4. å®Œå–„é”™è¯¯å¤„ç† â­â­â­â­
**é—®é¢˜**ï¼š
- å¼‚å¸¸æ•è·ä¸å®Œå–„
- ç”¨æˆ·çœ‹åˆ°çš„æ˜¯æŠ€æœ¯æ€§é”™è¯¯ä¿¡æ¯
- ç¼ºå°‘å‹å¥½çš„é”™è¯¯æç¤º

**å»ºè®®**ï¼š
```python
# ç»Ÿä¸€çš„é”™è¯¯å¤„ç†è£…é¥°å™¨
def handle_errors(func):
    def wrapper(*args, **kwargs):
        try:
            return func(*args, **kwargs)
        except ValueError as e:
            st.error(f"âŒ å‚æ•°é”™è¯¯: {str(e)}")
            logger.error(f"å‚æ•°é”™è¯¯: {e}", exc_info=True)
        except ConnectionError as e:
            st.error("âŒ ç½‘ç»œè¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œ")
            logger.error(f"ç½‘ç»œé”™è¯¯: {e}", exc_info=True)
        except Exception as e:
            st.error(f"âŒ æ“ä½œå¤±è´¥ï¼Œè¯·ç¨åé‡è¯•")
            logger.error(f"æœªçŸ¥é”™è¯¯: {e}", exc_info=True)
    return wrapper

# ä½¿ç”¨ç¤ºä¾‹
@handle_errors
def get_stock_data(symbol):
    # ä¸šåŠ¡é€»è¾‘
    pass
```

**é¢„æœŸæ”¶ç›Š**ï¼š
- æå‡ç”¨æˆ·ä½“éªŒ
- ä¾¿äºé—®é¢˜å®šä½
- å¢å¼ºç³»ç»Ÿç¨³å®šæ€§

---

### 5. æ·»åŠ ç±»å‹æ³¨è§£ â­â­â­â­
**é—®é¢˜**ï¼š
- ç¼ºå°‘ç±»å‹æ³¨è§£
- IDE æ— æ³•æä¾›æ™ºèƒ½æç¤º
- å®¹æ˜“å‡ºç°ç±»å‹ç›¸å…³çš„ bug

**å»ºè®®**ï¼š
```python
from typing import Optional, Dict, List, Any
from datetime import datetime

class DataManager:
    def get_history_data(
        self, 
        symbol: str, 
        start_date: str = "20240101", 
        end_date: str = "20251231"
    ) -> pd.DataFrame:
        """è·å–å†å²æ•°æ®
        
        Args:
            symbol: è‚¡ç¥¨ä»£ç 
            start_date: å¼€å§‹æ—¥æœŸï¼Œæ ¼å¼ YYYYMMDD
            end_date: ç»“æŸæ—¥æœŸï¼Œæ ¼å¼ YYYYMMDD
            
        Returns:
            å†å²æ•°æ® DataFrame
        """
        pass
    
    def get_realtime_data(
        self, 
        symbol: str
    ) -> Optional[Dict[str, Any]]:
        """è·å–å®æ—¶è¡Œæƒ…æ•°æ®
        
        Args:
            symbol: è‚¡ç¥¨ä»£ç 
            
        Returns:
            å®æ—¶æ•°æ®å­—å…¸ï¼Œå¤±è´¥è¿”å› None
        """
        pass
```

**é¢„æœŸæ”¶ç›Š**ï¼š
- æé«˜ä»£ç å¯è¯»æ€§
- IDE æ™ºèƒ½æç¤º
- å‡å°‘ç±»å‹é”™è¯¯

---

### 6. æ·»åŠ æ–‡æ¡£å­—ç¬¦ä¸² â­â­â­â­
**é—®é¢˜**ï¼š
- å¤§éƒ¨åˆ†å‡½æ•°ç¼ºå°‘æ–‡æ¡£å­—ç¬¦ä¸²
- ä¸çŸ¥é“å‡½æ•°çš„ç”¨é€”ã€å‚æ•°å’Œè¿”å›å€¼
- ç»´æŠ¤å›°éš¾

**å»ºè®®**ï¼š
```python
def calculate_atr(df: pd.DataFrame, period: int = 14) -> pd.Series:
    """è®¡ç®—å¹³å‡çœŸå®æ³¢å¹… (ATR)
    
    ATR æ˜¯è¡¡é‡ä»·æ ¼æ³¢åŠ¨æ€§çš„æŒ‡æ ‡ï¼Œå€¼è¶Šå¤§è¡¨ç¤ºæ³¢åŠ¨è¶Šå¤§ã€‚
    
    Args:
        df: åŒ…å« OHLCV æ•°æ®çš„ DataFrame
        period: è®¡ç®—å‘¨æœŸï¼Œé»˜è®¤ 14 å¤©
        
    Returns:
        ATR å€¼çš„ Series
        
    Example:
        >>> df = get_stock_data('600519')
        >>> atr = calculate_atr(df)
        >>> print(atr.iloc[-1])
    """
    high = df['high']
    low = df['low']
    close = df['close']
    
    tr1 = high - low
    tr2 = abs(high - close.shift())
    tr3 = abs(low - close.shift())
    
    tr = pd.concat([tr1, tr2, tr3], axis=1).max(axis=1)
    atr = tr.rolling(period).mean()
    
    return atr
```

**é¢„æœŸæ”¶ç›Š**ï¼š
- æé«˜ä»£ç å¯ç»´æŠ¤æ€§
- ä¾¿äºå›¢é˜Ÿåä½œ
- è‡ªåŠ¨ç”Ÿæˆ API æ–‡æ¡£

---

## ğŸŸ¢ ä¸­æœŸä¼˜åŒ–ï¼ˆä½ä¼˜å…ˆçº§ï¼‰

### 7. ä»£ç ç»“æ„ä¼˜åŒ– â­â­â­â­â­
**é—®é¢˜**ï¼š
- `main.py` æ–‡ä»¶è¿‡å¤§ï¼ˆ4570è¡Œï¼‰
- æ‰€æœ‰ UI é€»è¾‘æ··åœ¨ä¸€èµ·
- éš¾ä»¥ç»´æŠ¤å’Œæ‰©å±•

**å»ºè®®çš„ç›®å½•ç»“æ„**ï¼š
```
MyQuantTool/
â”œâ”€â”€ main.py                    # å…¥å£æ–‡ä»¶ï¼ˆç²¾ç®€åˆ°200è¡Œä»¥å†…ï¼‰
â”œâ”€â”€ config.py                  # é…ç½®ç®¡ç†
â”œâ”€â”€ requirements.txt           # ä¾èµ–ç®¡ç†
â”œâ”€â”€ ui/                        # UI æ¨¡å—
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ single_stock.py        # å•è‚¡åˆ†æ
â”‚   â”œâ”€â”€ multi_compare.py       # å¤šè‚¡å¯¹æ¯”
â”‚   â”œâ”€â”€ backtest.py            # ç­–ç•¥å›æµ‹
â”‚   â”œâ”€â”€ sector_rotation.py     # æ¿å—è½®åŠ¨
â”‚   â”œâ”€â”€ long_hu_bang.py        # é¾™è™æ¦œ
â”‚   â”œâ”€â”€ dragon_strategy.py     # é¾™å¤´æˆ˜æ³•
â”‚   â”œâ”€â”€ auction.py             # é›†åˆç«ä»·
â”‚   â”œâ”€â”€ sentiment.py           # æƒ…ç»ªåˆ†æ
â”‚   â”œâ”€â”€ hot_topics.py          # çƒ­ç‚¹é¢˜æ
â”‚   â”œâ”€â”€ alert.py               # æ™ºèƒ½é¢„è­¦
â”‚   â”œâ”€â”€ volume_price.py        # é‡ä»·å…³ç³»
â”‚   â”œâ”€â”€ ma_strategy.py         # å‡çº¿æˆ˜æ³•
â”‚   â”œâ”€â”€ new_stock.py           # æ¬¡æ–°è‚¡
â”‚   â”œâ”€â”€ capital.py             # æ¸¸èµ„å¸­ä½
â”‚   â”œâ”€â”€ limit_up.py            # æ‰“æ¿é¢„æµ‹
â”‚   â”œâ”€â”€ smart_recommend.py     # æ™ºèƒ½æ¨è
â”‚   â”œâ”€â”€ risk.py                # é£é™©ç®¡ç†
â”‚   â”œâ”€â”€ history.py             # å†å²è®°å½•
â”‚   â””â”€â”€ settings.py            # ç³»ç»Ÿè®¾ç½®
â”œâ”€â”€ logic/                     # ä¸šåŠ¡é€»è¾‘
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ data_manager.py        # æ•°æ®ç®¡ç†
â”‚   â”œâ”€â”€ algo.py                # åŸºç¡€ç®—æ³•
â”‚   â”œâ”€â”€ algo_advanced.py       # é«˜çº§ç®—æ³•
â”‚   â”œâ”€â”€ ai_agent.py            # AI ä»£ç†
â”‚   â”œâ”€â”€ backtest.py            # å›æµ‹å¼•æ“
â”‚   â””â”€â”€ ...
â”œâ”€â”€ utils/                     # å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ logger.py              # æ—¥å¿—å·¥å…·
â”‚   â”œâ”€â”€ validators.py          # éªŒè¯å·¥å…·
â”‚   â”œâ”€â”€ formatters.py          # æ ¼å¼åŒ–å·¥å…·
â”‚   â””â”€â”€ cache.py               # ç¼“å­˜å·¥å…·
â”œâ”€â”€ data/                      # æ•°æ®ç›®å½•
â”œâ”€â”€ logs/                      # æ—¥å¿—ç›®å½•
â””â”€â”€ tests/                     # æµ‹è¯•ç›®å½•
    â”œâ”€â”€ unit/
    â”œâ”€â”€ integration/
    â””â”€â”€ e2e/
```

**é‡æ„æ­¥éª¤**ï¼š
1. åˆ›å»º `ui/` ç›®å½•
2. å°† `main.py` ä¸­çš„å„ä¸ª Tab åŠŸèƒ½æ‹†åˆ†åˆ°ç‹¬ç«‹æ–‡ä»¶
3. åœ¨ `main.py` ä¸­å¯¼å…¥å¹¶æ³¨å†Œ
4. é€æ­¥æµ‹è¯•æ¯ä¸ªæ¨¡å—

**é¢„æœŸæ”¶ç›Š**ï¼š
- ä»£ç ç»“æ„æ¸…æ™°
- æ˜“äºç»´æŠ¤å’Œæ‰©å±•
- ä¾¿äºå›¢é˜Ÿåä½œ

---

### 8. æ€§èƒ½ä¼˜åŒ– â­â­â­â­
**é—®é¢˜**ï¼š
- é‡å¤è®¡ç®—æŠ€æœ¯æŒ‡æ ‡
- ç¼“å­˜æœºåˆ¶ä¸å®Œå–„
- é¦–æ¬¡åŠ è½½æ…¢

**å»ºè®®**ï¼š

#### 8.1 ä½¿ç”¨ Streamlit ç¼“å­˜
```python
import streamlit as st

@st.cache_data(ttl=300)  # ç¼“å­˜ 5 åˆ†é’Ÿ
def calculate_indicators_cached(df: pd.DataFrame) -> Dict[str, Any]:
    """è®¡ç®—æŠ€æœ¯æŒ‡æ ‡ï¼ˆå¸¦ç¼“å­˜ï¼‰"""
    return {
        'atr': QuantAlgo.calculate_atr(df),
        'macd': QuantAlgo.calculate_macd(df),
        'rsi': QuantAlgo.calculate_rsi(df),
        'bollinger': QuantAlgo.calculate_bollinger_bands(df),
        'kdj': QuantAlgo.calculate_kdj(df)
    }
```

#### 8.2 é¢„åŠ è½½å¸¸ç”¨æ•°æ®
```python
# åœ¨åº”ç”¨å¯åŠ¨æ—¶é¢„åŠ è½½
@st.cache_resource
def load_common_data():
    """é¢„åŠ è½½å¸¸ç”¨æ•°æ®"""
    return {
        'watchlist': config.get('watchlist', []),
        'default_symbol': config.get('default_symbol', '600519')
    }
```

#### 8.3 ä¼˜åŒ–æ•°æ®åº“æŸ¥è¯¢
```python
# æ·»åŠ ç´¢å¼•
conn.execute('CREATE INDEX IF NOT EXISTS idx_symbol_date ON daily_bars(symbol, date)')

# æ‰¹é‡æŸ¥è¯¢
def get_multiple_stocks(symbols: List[str]) -> Dict[str, pd.DataFrame]:
    """æ‰¹é‡è·å–å¤šåªè‚¡ç¥¨æ•°æ®"""
    symbols_str = "','".join(symbols)
    query = f"SELECT * FROM daily_bars WHERE symbol IN ('{symbols_str}')"
    df = pd.read_sql(query, conn)
    
    return {symbol: df[df['symbol'] == symbol] for symbol in symbols}
```

**é¢„æœŸæ”¶ç›Š**ï¼š
- æå‡å“åº”é€Ÿåº¦
- å‡å°‘é‡å¤è®¡ç®—
- ä¼˜åŒ–ç”¨æˆ·ä½“éªŒ

---

### 9. ç”¨æˆ·ä½“éªŒä¼˜åŒ– â­â­â­â­â­
**é—®é¢˜**ï¼š
- ç¼ºå°‘åŠ è½½çŠ¶æ€æç¤º
- æ²¡æœ‰æ•°æ®åˆ·æ–°æŒ‰é’®
- è‡ªé€‰è‚¡ç®¡ç†ä¸å‹å¥½

**å»ºè®®**ï¼š

#### 9.1 æ·»åŠ åŠ è½½çŠ¶æ€
```python
# å…¨å±€åŠ è½½çŠ¶æ€
with st.sidebar:
    if st.session_state.get('loading'):
        st.info("â³ æ•°æ®åŠ è½½ä¸­...")
    
    # è¿›åº¦æ¡
    progress_bar = st.progress(0)
    for i, symbol in enumerate(symbols):
        progress_bar.progress((i + 1) / len(symbols))
        get_stock_data(symbol)
    progress_bar.empty()
```

#### 9.2 æ·»åŠ åˆ·æ–°æŒ‰é’®
```python
# æ•°æ®åˆ·æ–°
col_refresh, col_auto = st.columns([1, 3])
with col_refresh:
    if st.button("ğŸ”„ åˆ·æ–°æ•°æ®"):
        st.session_state.cache_clear()
        st.rerun()

with col_auto:
    auto_refresh = st.checkbox("è‡ªåŠ¨åˆ·æ–°ï¼ˆæ¯5åˆ†é’Ÿï¼‰")
    if auto_refresh and st.session_state.get('last_refresh', 0) < time.time() - 300:
        st.session_state.cache_clear()
        st.rerun()
```

#### 9.3 ä¼˜åŒ–è‡ªé€‰è‚¡ç®¡ç†
```python
# æ‹–æ‹½æ’åº
import streamlit_sortables

watchlist = config.get('watchlist', [])
reordered = streamlit_sortables.sort_items(watchlist)
config.set('watchlist', reordered)

# æ‰¹é‡æ“ä½œ
selected = st.multiselect("é€‰æ‹©è‚¡ç¥¨", watchlist)
if st.button("æ‰¹é‡åˆ é™¤"):
    new_watchlist = [s for s in watchlist if s not in selected]
    config.set('watchlist', new_watchlist)
```

**é¢„æœŸæ”¶ç›Š**ï¼š
- æå‡ç”¨æˆ·ä½“éªŒ
- å¢å¼ºäº¤äº’æ€§
- æé«˜ä½¿ç”¨æ•ˆç‡

---

### 10. æ·»åŠ å•å…ƒæµ‹è¯• â­â­â­â­â­
**é—®é¢˜**ï¼š
- å®Œå…¨æ²¡æœ‰æµ‹è¯•
- ä»£ç è´¨é‡éš¾ä»¥ä¿è¯
- é‡æ„é£é™©é«˜

**å»ºè®®**ï¼š

#### 10.1 æµ‹è¯•ç»“æ„
```
tests/
â”œâ”€â”€ __init__.py
â”œâ”€â”€ conftest.py              # pytest é…ç½®
â”œâ”€â”€ unit/                    # å•å…ƒæµ‹è¯•
â”‚   â”œâ”€â”€ test_data_manager.py
â”‚   â”œâ”€â”€ test_algo.py
â”‚   â”œâ”€â”€ test_ai_agent.py
â”‚   â””â”€â”€ test_formatters.py
â”œâ”€â”€ integration/             # é›†æˆæµ‹è¯•
â”‚   â”œâ”€â”€ test_api.py
â”‚   â””â”€â”€ test_database.py
â””â”€â”€ e2e/                     # ç«¯åˆ°ç«¯æµ‹è¯•
    â””â”€â”€ test_user_flow.py
```

#### 10.2 æµ‹è¯•ç¤ºä¾‹
```python
# tests/unit/test_data_manager.py
import pytest
import pandas as pd
from logic.data_manager import DataManager

@pytest.fixture
def db():
    """æµ‹è¯•æ•°æ®åº“å®ä¾‹"""
    return DataManager(':memory:')

def test_get_history_data(db):
    """æµ‹è¯•è·å–å†å²æ•°æ®"""
    df = db.get_history_data('600519')
    assert not df.empty
    assert 'close' in df.columns
    assert len(df) > 0

def test_get_realtime_data(db, mocker):
    """æµ‹è¯•è·å–å®æ—¶æ•°æ®"""
    # Mock akshare æ¥å£
    mocker.patch('akshare.stock_zh_a_spot_em')
    
    data = db.get_realtime_data('600519')
    assert data is not None
    assert 'price' in data
    assert 'change_percent' in data
```

#### 10.3 è¿è¡Œæµ‹è¯•
```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
pytest

# è¿è¡Œç‰¹å®šæµ‹è¯•
pytest tests/unit/test_data_manager.py

# ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
pytest --cov=logic --cov-report=html
```

**é¢„æœŸæ”¶ç›Š**ï¼š
- æé«˜ä»£ç è´¨é‡
- å‡å°‘Bug
- ä¾¿äºé‡æ„

---

## ğŸ”µ é•¿æœŸä¼˜åŒ–ï¼ˆè§„åˆ’ä¸­ï¼‰

### 11. å®Œå–„æ–‡æ¡£ â­â­â­â­
**å»ºè®®**ï¼š
- API æ–‡æ¡£ï¼ˆä½¿ç”¨ Sphinxï¼‰
- æ¶æ„è¯´æ˜æ–‡æ¡£
- éƒ¨ç½²æ–‡æ¡£
- è´¡çŒ®æŒ‡å—
- æ›´æ–°æ—¥å¿—ï¼ˆCHANGELOG.mdï¼‰

**é¢„æœŸæ”¶ç›Š**ï¼š
- ä¾¿äºæ–°æˆå‘˜ä¸Šæ‰‹
- é™ä½ç»´æŠ¤æˆæœ¬
- æé«˜é¡¹ç›®ä¸“ä¸šæ€§

---

### 12. ä¾èµ–ç®¡ç† â­â­â­
**å»ºè®®**ï¼š
```
requirements.txt          # ç”Ÿäº§ç¯å¢ƒ
requirements-dev.txt      # å¼€å‘ç¯å¢ƒ
requirements-test.txt     # æµ‹è¯•ç¯å¢ƒ
```

**requirements-dev.txt**ï¼š
```
pytest>=7.0.0
pytest-cov>=4.0.0
black>=23.0.0
flake8>=6.0.0
mypy>=1.0.0
```

**é¢„æœŸæ”¶ç›Š**ï¼š
- ç¯å¢ƒéš”ç¦»
- ä¾èµ–ç®¡ç†æ¸…æ™°
- ä¾¿äºå›¢é˜Ÿåä½œ

---

### 13. å®‰å…¨æ€§å¢å¼º â­â­â­â­
**å»ºè®®**ï¼š

#### 13.1 API Key ç®¡ç†
```python
# ä½¿ç”¨ç¯å¢ƒå˜é‡
import os
from dotenv import load_dotenv

load_dotenv()
API_KEY = os.getenv('API_KEY')

if not API_KEY:
    raise ValueError("è¯·è®¾ç½® API_KEY ç¯å¢ƒå˜é‡")
```

#### 13.2 è¾“å…¥éªŒè¯
```python
import re

def validate_stock_code(code: str) -> bool:
    """éªŒè¯è‚¡ç¥¨ä»£ç æ ¼å¼"""
    return bool(re.match(r'^\d{6}$', code))

def validate_date(date_str: str) -> bool:
    """éªŒè¯æ—¥æœŸæ ¼å¼"""
    return bool(re.match(r'^\d{8}$', date_str))
```

#### 13.3 SQL æ³¨å…¥é˜²æŠ¤
```python
# ä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢
def get_stock_data_safe(symbol: str):
    query = "SELECT * FROM daily_bars WHERE symbol = ?"
    return pd.read_sql(query, conn, params=(symbol,))
```

**é¢„æœŸæ”¶ç›Š**ï¼š
- æé«˜å®‰å…¨æ€§
- é˜²æ­¢æ³¨å…¥æ”»å‡»
- ä¿æŠ¤ç”¨æˆ·æ•°æ®

---

### 14. é…ç½®ç®¡ç†ä¼˜åŒ– â­â­â­
**å»ºè®®**ï¼š
```python
from pydantic import BaseModel, validator

class AppConfig(BaseModel):
    """åº”ç”¨é…ç½®"""
    api_key: str
    cache_expire_seconds: int = 60
    max_stocks_in_watchlist: int = 50
    default_symbol: str = "600519"
    
    @validator('api_key')
    def validate_api_key(cls, v):
        if not v or len(v) < 10:
            raise ValueError('API Key æ ¼å¼ä¸æ­£ç¡®')
        return v
    
    @validator('default_symbol')
    def validate_symbol(cls, v):
        if not re.match(r'^\d{6}$', v):
            raise ValueError('è‚¡ç¥¨ä»£ç æ ¼å¼ä¸æ­£ç¡®')
        return v

# ä½¿ç”¨
config = AppConfig(**config_data)
```

**é¢„æœŸæ”¶ç›Š**ï¼š
- é…ç½®éªŒè¯
- ç±»å‹å®‰å…¨
- æ–‡æ¡£è‡ªåŠ¨ç”Ÿæˆ

---

### 15. CI/CD æµç¨‹ â­â­â­
**å»ºè®®**ï¼š

#### 15.1 GitHub Actions
```yaml
name: CI

on: [push, pull_request]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Set up Python
        uses: actions/setup-python@v2
        with:
          python-version: '3.10'
      - name: Install dependencies
        run: |
          pip install -r requirements.txt
          pip install -r requirements-dev.txt
      - name: Run tests
        run: pytest
      - name: Code coverage
        run: pytest --cov=logic --cov-report=xml
      - name: Lint
        run: flake8 logic/
```

**é¢„æœŸæ”¶ç›Š**ï¼š
- è‡ªåŠ¨åŒ–æµ‹è¯•
- ä»£ç è´¨é‡æ£€æŸ¥
- å¿«é€Ÿå‘ç°é—®é¢˜

---

## ğŸ“Š ä¼˜å…ˆçº§æ€»ç»“

| ä¼˜å…ˆçº§ | ä¼˜åŒ–é¡¹ | é¢„è®¡å·¥ä½œé‡ | é¢„æœŸæ”¶ç›Š |
|--------|--------|------------|----------|
| ğŸ”´ ç«‹å³ | æ¸…ç†ä¸´æ—¶æ–‡ä»¶ | 0.5h | â­â­â­â­â­ |
| ğŸ”´ ç«‹å³ | ä¿®å¤ Streamlit è­¦å‘Š | 1h | â­â­â­â­â­ |
| ğŸŸ¡ çŸ­æœŸ | æ·»åŠ æ—¥å¿—ç³»ç»Ÿ | 2h | â­â­â­â­â­ |
| ğŸŸ¡ çŸ­æœŸ | å®Œå–„é”™è¯¯å¤„ç† | 3h | â­â­â­â­ |
| ğŸŸ¡ çŸ­æœŸ | æ·»åŠ ç±»å‹æ³¨è§£ | 4h | â­â­â­â­ |
| ğŸŸ¡ çŸ­æœŸ | æ·»åŠ æ–‡æ¡£å­—ç¬¦ä¸² | 4h | â­â­â­â­ |
| ğŸŸ¢ ä¸­æœŸ | ä»£ç ç»“æ„ä¼˜åŒ– | 16h | â­â­â­â­â­ |
| ğŸŸ¢ ä¸­æœŸ | æ€§èƒ½ä¼˜åŒ– | 8h | â­â­â­â­ |
| ğŸŸ¢ ä¸­æœŸ | ç”¨æˆ·ä½“éªŒä¼˜åŒ– | 6h | â­â­â­â­â­ |
| ğŸŸ¢ ä¸­æœŸ | æ·»åŠ å•å…ƒæµ‹è¯• | 20h | â­â­â­â­â­ |
| ğŸ”µ é•¿æœŸ | å®Œå–„æ–‡æ¡£ | 10h | â­â­â­â­ |
| ğŸ”µ é•¿æœŸ | ä¾èµ–ç®¡ç† | 2h | â­â­â­ |
| ğŸ”µ é•¿æœŸ | å®‰å…¨æ€§å¢å¼º | 4h | â­â­â­â­ |
| ğŸ”µ é•¿æœŸ | é…ç½®ç®¡ç†ä¼˜åŒ– | 3h | â­â­â­ |
| ğŸ”µ é•¿æœŸ | CI/CD æµç¨‹ | 8h | â­â­â­ |

---

## ğŸ¯ å®æ–½å»ºè®®

### ç¬¬ä¸€å‘¨ï¼ˆç«‹å³åšï¼‰
1. æ¸…ç†ä¸´æ—¶æ–‡ä»¶ï¼ˆ0.5hï¼‰
2. ä¿®å¤ Streamlit è­¦å‘Šï¼ˆ1hï¼‰

### ç¬¬äºŒå‘¨ï¼ˆçŸ­æœŸï¼‰
1. æ·»åŠ æ—¥å¿—ç³»ç»Ÿï¼ˆ2hï¼‰
2. å®Œå–„é”™è¯¯å¤„ç†ï¼ˆ3hï¼‰

### ç¬¬ä¸‰-å››å‘¨ï¼ˆçŸ­æœŸï¼‰
1. æ·»åŠ ç±»å‹æ³¨è§£ï¼ˆ4hï¼‰
2. æ·»åŠ æ–‡æ¡£å­—ç¬¦ä¸²ï¼ˆ4hï¼‰

### ç¬¬äº”-å…«å‘¨ï¼ˆä¸­æœŸï¼‰
1. ä»£ç ç»“æ„ä¼˜åŒ–ï¼ˆ16hï¼‰
2. æ€§èƒ½ä¼˜åŒ–ï¼ˆ8hï¼‰

### ç¬¬ä¹-åå‘¨ï¼ˆä¸­æœŸï¼‰
1. ç”¨æˆ·ä½“éªŒä¼˜åŒ–ï¼ˆ6hï¼‰
2. æ·»åŠ å•å…ƒæµ‹è¯•ï¼ˆ20hï¼‰

### é•¿æœŸè§„åˆ’
æ ¹æ®é¡¹ç›®å‘å±•éœ€è¦ï¼Œé€æ­¥å®æ–½é•¿æœŸä¼˜åŒ–é¡¹ã€‚

---

## ğŸ“ å¤‡æ³¨

- æ‰€æœ‰ä¼˜åŒ–éƒ½åº”ä¿æŒå‘åå…¼å®¹
- æ¯æ¬¡ä¼˜åŒ–å‰éƒ½åº”è¯¥æœ‰å®Œæ•´çš„æµ‹è¯•
- å»ºè®®ä½¿ç”¨ Git åˆ†æ”¯è¿›è¡Œå¼€å‘
- é‡è¦ä¿®æ”¹åº”è¯¥æœ‰è¯¦ç»†çš„ Commit è®°å½•
- å®šæœŸä»£ç  Review
- ä¿æŒä»£ç é£æ ¼ä¸€è‡´

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**åˆ›å»ºæ—¥æœŸ**: 2026-01-05  
**æœ€åæ›´æ–°**: 2026-01-05  
**ç»´æŠ¤è€…**: MyQuantTool Team