# MyQuantTool Q&A与工程对齐文档

## 📅 版本信息
- **版本号**: V11.0.0
- **创建日期**: 2026-02-12
- **最后更新**: 2026-02-12
- **Git提交**: 待提交

---

## 🎯 开发初衷与目标

### 核心定位
**小资金量化交易系统 - 右侧起爆点捕捉**

### 交易策略
- ✅ **半路战法**（Halfway）- 右侧起爆点
- ✅ **龙头战法**（Leader）- 板块龙头
- ✅ **资金流分析**（Capital Flow）- 主力资金动向
- ✅ **早盘竞价**（Auction）- 竞价异动检测

### 盈利目标
- **单只股票**: 30%-50%（理想目标，非死板止盈）
- **月度账户**: 30%-50%（理想目标）
- **止盈策略**: 根据信号止盈（主力资金大量流出或上涨动力丧失或根据盘中情况学习卖出的硬指标）
- **止损策略**: -5%（硬止损，但实际根据资金流和趋势判断）

### 交易频率
- **无特殊要求**
- **唯一标准**: 赚钱快、小资金效率高
- **持仓时间**: 根据信号动态调整，不设固定周期

### 数据源
- ✅ **QMT券商版**（有权限）
- ✅ **Tushare 8000积分**
- ✅ **AkShare免费复盘**

---

## ❓ 核心Q&A

### Q1: 止盈策略
**问题**: 盈利目标30%-50%，但当前止盈是+30%，是否需要调整？

**回答**: 
- 止盈根据信号去止盈，如主力资金大量流出等，上涨动力已经缺乏
- 不是死板的30-50%
- 30-50%只是每个月的理想账户盈利目标

### Q2: 交易频率
**问题**: 交易频率无特殊要求，那么持仓时间如何控制？

**回答**:
- 无任何特殊要求
- 唯一要求是赚钱快，小资金效率要高

### Q3: QMT Tick推断逻辑
**问题**: 当前代码使用的是AkShare的T+1数据，但要用QMT Tick去保守推断，具体的推断逻辑是什么？

**回答**: 
```python
estimated_main_flow = (
    base_flow * 0.4 +                      # 历史基础 40%
    amount * (bid_pressure - 1.0) * 0.3 +  # 买卖压力 30%
    amount * price_strength * 0.3          # 价格强度 30%
)
```
- 基于买卖盘压力、价格强度、成交量放大系数
- 结合昨日资金流（东方财富T-1）进行修正

### Q4: QMT券商版具体权限
**问题**: QMT券商版具体能获取哪些数据？有Tick数据吗？有资金流数据吗？

**回答**:
- ✅ **Tick数据**: `get_full_tick()` - 免费可用，包含买卖盘信息
- ✅ **Level-2数据**: 需要VIP权限（l2quote, l2order, l2transaction）
- ⚠️ **资金流数据**: QMT没有直接的资金流API，但可以通过Tick推断
- ✅ **龙虎榜数据**: `GETLONGHUBANG` - QMT原生API，但用Tushare拿

**官方文档**: https://dict.thinktrader.net/

### Q5: 当前最大痛点
**问题**: 基于实际交易经验，当前系统最大的痛点是什么？

**回答**:
- **数据源是核心瓶颈**
- 没有Tick/Level-2数据，一切策略都是纸上谈兵
- 盘中运行有问题，改了两个星期

---

## 🎯 三大战法规则明确

### 1️⃣ 半路战法（Halfway）
**目标标的**: 创业板(300) + 科创板(688)的20cm

**涨幅区间**:
- 20cm：10%-19.5%
- 10cm：5%-9.5%

**入场条件**:
- 有平台（过去30分钟振幅 < 3%）
- 突破平台高点 ≥ 1%
- 突破成交量 ≥ 平台期平均量的1.5倍

### 2️⃣ 龙头战法（Leader）
**板块龙头候选**:
- 同板块内涨幅第一名或Top3且差距<1%
- 涨幅≥5%

**竞价弱转强龙头预备**:
- 高开幅度≥5%
- 竞价量比≥1.5
- 昨日收盘涨幅<3%

**日内加速（分时龙头）**:
- 10分钟内加速
- 加速量比≥1.5

### 3️⃣ 时机斧（Timing）
- **板块共振**: 涨停股≥3只 + 板块上涨比例≥35%
- **防守斧**: 禁止TAIL_RALLY/TRAP场景

### 4️⃣ 风控规则
- **风险评分**: ≤0.2
- **止损**: -5%
- **止盈**: +30%（根据信号动态调整）
- **目标**: 每只股票30%-50%

---

## 🏗️ 工程对齐大方向

### 数据抽象层（已完成 ✅）
**核心原则**: 策略层永远不直接连接数据源，必须通过抽象层

**三层架构**:
```
策略层（半路/龙头/时机斧）
    ↓
抽象层（ICapitalFlowProvider）
    ↓
数据源层（Level2 → Level1 → DongCai）
```

**自动降级机制**:
```
Level-2（付费逐笔）→ Level-1（免费推断）→ DongCai（T-1历史）
```

### 信号记录系统（已完成 ✅）
**四大表结构**:
1. `auction_candidates` - 竞价候选池
2. `buy_signals` - 买入信号
3. `trade_results` - 交易结果
4. `daily_statistics` - 每日统计

**用途**:
- 追踪交易绩效
- 计算胜率/盈亏比
- 系统状态评估

### 自动化脚本（已完成 ✅）
- `tasks/auction_scan.py` - 09:20竞价扫描
- `tasks/daily_summary.py` - 14:55每日统计

---

## ⚠️ 已知问题

### 问题1: 缓存数据库字段错误
```
❌ 缓存查询失败: no such column: main_net_inflow
```

**影响**: 资金流数据无法正确缓存，导致每次都调用AkShare API，性能下降

**状态**: 待修复

### 问题2: 盘中运行问题
用户提到"改了两个星期，每次盘中跑基本都有问题"

**可能原因**:
1. QMT连接不稳定（盘中断开）
2. 数据排序问题（之前的price_3d_change bug）
3. 网络超时（AkShare API）

**状态**: 待定位

---

## 📋 已完成功能

### Task 1: 数据抽象层 ✅
- `logic/data_provider/base.py` - 抽象接口
- `logic/data_provider/dongcai_provider.py` - 东方财富T-1数据提供者
- `logic/data_provider/level1_provider.py` - QMT Tick推断提供者
- `logic/data_provider/factory.py` - 数据提供者工厂

### Task 2: 信号记录系统 ✅
- `logic/signal_tracker/signal_recorder.py` - 信号记录系统（4表结构）

### Task 3: 自动化脚本 ✅
- `tasks/auction_scan.py` - 竞价扫描脚本
- `tasks/daily_summary.py` - 每日统计脚本

### 配置文件修改 ✅
- `config/market_scan_config.json` - 添加data_provider配置

### 测试验证 ✅
```
✅ Level-1提供者: 创建成功，可用状态=True
✅ 东方财富T-1提供者: 创建成功，可用状态=True
✅ 自动降级机制: level2 → level1 → dongcai
✅ 数据新鲜度: 3秒（实时数据）
```

---

## 🚀 下一步行动

### 优先级1: 修复盘中运行问题
1. 定位具体错误信息
2. 修复缓存数据库字段错误
3. 验证QMT连接稳定性

### 优先级2: 功能验证
1. 运行全市场扫描测试
2. 验证数据提供者切换功能
3. 确保重构没有破坏现有功能

### 优先级3: 架构扩展
1. 检查其他模块的数据源直连
2. 统一所有模块的数据访问
3. 完善架构文档

---

## 📝 备注

### 铁律5
**策略层必须永远不直接连接数据源，必须通过抽象层**

### 核心文件
- `tasks/run_full_market_scan.py` - 全市场扫描
- `tasks/run_event_driven_monitor.py` - 事件驱动监控
- `tasks/run_triple_funnel_scan.py` - 三漏斗扫描

### Git仓库
- https://github.com/Stuuu223/MyQuantTool/

---

**文档维护**: 此文档应在每次重大更新后同步更新
**策略维护**: 策略根据市场实盘运行数据与效果调整或迭代（持续学习优化大方向）